
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>app: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">fundtx/app/app.go (80.0%)</option>
				
				<option value="file1">fundtx/app/gl.go (81.2%)</option>
				
				<option value="file2">fundtx/app/journal.go (100.0%)</option>
				
				<option value="file3">fundtx/app/kliring.go (100.0%)</option>
				
				<option value="file4">fundtx/app/minio.go (0.0%)</option>
				
				<option value="file5">fundtx/app/overridevalidation.go (25.9%)</option>
				
				<option value="file6">fundtx/app/project.go (100.0%)</option>
				
				<option value="file7">fundtx/app/reversaltoday.go (90.5%)</option>
				
				<option value="file8">fundtx/app/transaksi.go (70.3%)</option>
				
				<option value="file9">fundtx/app/utils.go (71.7%)</option>
				
				<option value="file10">fundtx/app/utilsfile.go (0.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">no coverage</span>
				<span class="cov1">low coverage</span>
				<span class="cov2">*</span>
				<span class="cov3">*</span>
				<span class="cov4">*</span>
				<span class="cov5">*</span>
				<span class="cov6">*</span>
				<span class="cov7">*</span>
				<span class="cov8">*</span>
				<span class="cov9">*</span>
				<span class="cov10">high coverage</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package app

import (
        "fundtx/datastore"
        "fundtx/pkg/logging"

        "go.opentelemetry.io/otel/trace"
)

// Service
type AppSvc interface {
        Create() CreateApp
        Read() ReadApp
        Update() UpdateApp
        Delete() DeleteApp
        Utils() UtilsApp
        Store() datastore.FundDatastorePort
        SetUtils(app UtilsApp)
        ResetUtils()
        SetCreates(app CreateApp)
        SetReads(app ReadApp)
}

var _ AppSvc = (*service)(nil)

type service struct {
        createSvc CreateApp
        readSvc   ReadApp
        updateSvc UpdateApp
        deleteSvc DeleteApp
        utilsSvc  UtilsApp
        storeSvc  datastore.FundDatastorePort
        log       *logging.Logger
        tracer    trace.Tracer
}

func (s *service) Create() CreateApp <span class="cov7" title="157">{
        return s.createSvc
}</span>

func (s *service) Read() ReadApp <span class="cov5" title="48">{
        return s.readSvc
}</span>

func (s *service) Update() UpdateApp <span class="cov0" title="0">{
        return s.updateSvc
}</span>

func (s *service) Delete() DeleteApp <span class="cov0" title="0">{
        return s.deleteSvc
}</span>

func (s *service) Store() datastore.FundDatastorePort <span class="cov10" title="1486">{
        return s.storeSvc
}</span>

func (s *service) Utils() UtilsApp <span class="cov6" title="95">{
        return s.utilsSvc
}</span>

func (s *service) SetUtils(app UtilsApp) <span class="cov7" title="250">{
        s.utilsSvc = app
}</span>

func (s *service) SetCreates(app CreateApp) <span class="cov0" title="0">{
        s.createSvc = app
}</span>

func (s *service) SetReads(app ReadApp) <span class="cov0" title="0">{
        s.readSvc = app
}</span>

func (s *service) ResetUtils() <span class="cov5" title="45">{
        s.utilsSvc = s
}</span>

func NewService(store datastore.FundDatastorePort, log *logging.Logger, tracer trace.Tracer) AppSvc <span class="cov7" title="250">{
        var svc = &amp;service{}
        svc.log = log
        svc.tracer = tracer
        svc.storeSvc = store
        svc.readSvc = svc
        svc.updateSvc = svc
        svc.createSvc = svc
        svc.deleteSvc = svc
        svc.utilsSvc = svc

        return svc
}</span>
</pre>
		
		<pre class="file" id="file1" style="display: none">package app

import (
        "context"
        "database/sql"
        "fmt"
        "fundtx/data"
        "fundtx/datastore"

        "html/template"
        "strings"
        "time"

        otel_code "go.opentelemetry.io/otel/codes"

        "fundtx/pkg/errors"
        "fundtx/pkg/helpers"
        "fundtx/pkg/logging/utils"

        "github.com/sirupsen/logrus"
        "go.opentelemetry.io/otel/attribute"
)

func (f *service) GetGLList(ctx context.Context, params datastore.ReqGetListGL) (respApp []datastore.ResGetListGl, err error) <span class="cov2" title="2">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GetGLList %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov1" title="1">defer f.PanicHandler(tx, &amp;err)

        respApp, err = f.Store().GetGLList(appCtx, tx, params)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "getdeplist": respApp,
                        "error":      err,
                        "params":     params,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov1" title="1">f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")
        return</span>
}

func (f *service) PostTrxJournalSingle(ctx context.Context, params data.ReqPostTrxJournalSingle) (respApp data.ResPostTrxJournalSingle, err error) <span class="cov10" title="24">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("PostTrxJournalSingle %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        params.UserInput = strings.ToUpper(params.UserInput)

        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                err = fmt.Errorf(remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respApp.Status = "02"
                respApp.Msg = remark
                return
        }</span>

        <span class="cov9" title="23">defer f.PanicHandler(tx, &amp;err)

        if params.NomorReferensi == "" </span><span class="cov1" title="1">{
                remark := "field nomor_referensi harus diisi"
                f.log.Warn(logrus.Fields{"nomor_referensi": params.NomorReferensi}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respApp.Status = "02"
                respApp.Msg = remark
                return
        }</span>

        <span class="cov9" title="22">if params.TrxTypeCheck == "" </span><span class="cov1" title="1">{
                remark := "trx type check harus diisi"
                f.log.Warn(logrus.Fields{"kode_transaksi": params.KodeCabangTransaksi}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respApp.Status = "02"
                respApp.Msg = remark
                return
        }</span>

        <span class="cov9" title="21">if params.KodeTransaksi == "" </span><span class="cov1" title="1">{
                remark := "kode transaksi harus diisi"
                f.log.Warn(logrus.Fields{"kode_transaksi": params.KodeCabangTransaksi}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respApp.Status = "02"
                respApp.Msg = remark
                return
        }</span>

        <span class="cov9" title="20">if !(params.KodeTransaksi == "DKU1" || params.KodeTransaksi == "DKU2" || params.KodeTransaksi == "DKU3" || params.KodeTransaksi == "DKU4") </span><span class="cov1" title="1">{
                remark := "kode transaksi tidak valid. Kode transaksi harus diisi DKU1, DKU2, DKU3 atau DKU4"
                f.log.Warn(logrus.Fields{"kode_transaksi": params.KodeCabangTransaksi}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respApp.Status = "02"
                respApp.Msg = remark
                return
        }</span>

        <span class="cov9" title="19">var TrxTypeCheck = params.TrxTypeCheck
        if TrxTypeCheck == "FUNDTM" || TrxTypeCheck == "TMFUND" </span><span class="cov7" title="11">{
                params.Uidkey = fmt.Sprintf("FUND-%v", params.Uidkey)
        }</span>

        <span class="cov9" title="19">actionType := "POST_TRX_JOURNAL_SINGLE"
        uidkeycek := datastore.ReqGetInfoUid{
                Uidkey:        params.Uidkey,
                ActionTypeCek: actionType,
        }
        resUID, err := f.Store().GetInfoUid(appCtx, tx, uidkeycek)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "resUID": resUID,
                        "error":  err,
                        "params": uidkeycek,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respApp.Status = "02"
                respApp.Msg = remark
                return
        }</span>

        <span class="cov9" title="18">var infoUid datastore.InfoUid
        if resUID != infoUid </span><span class="cov1" title="1">{
                remark := "Transaksi sudah diproses"
                f.log.Warn(logrus.Fields{"resUID": resUID}, nil, remark)
                respApp.Data.IdTransaksi = resUID.Keyint.Int64
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                err = nil
                respApp.Status = "00"
                respApp.Msg = remark
                return
        }</span>

        <span class="cov9" title="17">var IdTransaksi int64
        var kodeAccount string
        var kodeAccount2 string

        DataTrx := data.DataTrx{
                NomorReferensi:      params.NomorReferensi,
                Keterangan:          params.Keterangan,
                JenisAplikasi:       "A",
                KodeValutaTransaksi: "IDR",
                KursManual:          1,
                NilaiTransaksi:      float64(params.NilaiTransaksi),
                Biaya:               0,
                KodeCabangTransaksi: params.KodeCabangTransaksi,
                IsSudahDijurnal:     "F",
                KodeTransaksi:       params.KodeTransaksi,
                UserInput:           params.UserInput,
                UserOtorisasi:       params.UserOtorisasi,
                IsReverseAllowed:    "T",
        }

        ListDetilTrx := []datastore.DetilTrx{}

        var KodeTransaksi = params.KodeTransaksi
        var RekKodeInterfaceTrx datastore.RekKodeInterfaceTrx
        var RekeningTransaksi datastore.RekeningTransaksi
        var RekeningTransaksi2 datastore.RekeningTransaksi

        var JenisDetilTransaksiDb string
        var NomorRekeningDebet string
        var NamaRekeningDebet string
        var KodeCabangTransaksiDb string

        var JenisDetilTransaksiCr string
        var NomorRekeningKredit string
        var NamaRekeningKredit string
        var KodeCabangTransaksiCr string

        if TrxTypeCheck == "FUNDTM" || TrxTypeCheck == "TMFUND" </span><span class="cov7" title="11">{
                RekKodeInterfaceTrx, err = f.Store().ValidasiRekKodeInterfaceTrx(appCtx, tx, params.KodeCabangTransaksi, "TTP_TMCORE")
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        f.log.Error(logrus.Fields{
                                "redult": fmt.Sprintf("%+v", RekKodeInterfaceTrx),
                                "error":  err,
                                "params": map[string]interface{}{
                                        "KodeCabang":     params.KodeCabangTransaksi,
                                        "kode_interface": "TTP_TMCORE",
                                },
                        }, nil, err.Error())
                        err = errors.SystemError.Database
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        respApp.Status = "02"
                        respApp.Msg = err.Error()
                        return
                }</span>

                <span class="cov7" title="10">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := fmt.Sprintf("kode interface TTP_TMCORE dengan kode cabang %s tidak valid", params.KodeCabangTransaksi)
                        f.log.Warn(logrus.Fields{
                                "err": err,
                        }, nil, "log info")
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        respApp.Status = "02"
                        respApp.Msg = remark
                        return
                }</span>
        }

        <span class="cov8" title="15">switch </span>{
        case TrxTypeCheck == "FUND" &amp;&amp; KodeTransaksi == "DKU1":<span class="cov1" title="1">
                JenisDetilTransaksiDb = "002"
                NomorRekeningDebet = params.Dku1.NomorRekeningDebet
                NamaRekeningDebet = params.Dku1.NamaNasabahDebet
                KodeCabangTransaksiDb = params.KodeCabangTransaksi

                JenisDetilTransaksiCr = "002"
                NomorRekeningKredit = params.Dku1.NomorRekeningKredit
                NamaRekeningKredit = params.Dku1.NamaNasabahKredit
                KodeCabangTransaksiCr = params.KodeCabangTransaksi</span>

        case TrxTypeCheck == "FUNDTM" &amp;&amp; KodeTransaksi == "DKU1":<span class="cov5" title="5">
                JenisDetilTransaksiDb = "002"
                NomorRekeningDebet = params.Dku1.NomorRekeningDebet
                NamaRekeningDebet = params.Dku1.NamaNasabahDebet
                KodeCabangTransaksiDb = params.KodeCabangTransaksi

                JenisDetilTransaksiCr = "006"
                NomorRekeningKredit = "TTP_TMCORE"
                NamaRekeningKredit = RekKodeInterfaceTrx.NamaRekening.String
                KodeCabangTransaksiCr = "888"</span>

        case TrxTypeCheck == "TMFUND" &amp;&amp; KodeTransaksi == "DKU1":<span class="cov1" title="1">
                JenisDetilTransaksiDb = "006"
                NomorRekeningDebet = "TTP_TMCORE"
                NamaRekeningDebet = RekKodeInterfaceTrx.NamaRekening.String
                KodeCabangTransaksiDb = "888"

                JenisDetilTransaksiCr = "002"
                NomorRekeningKredit = params.Dku1.NomorRekeningKredit
                NamaRekeningKredit = params.Dku1.NamaNasabahKredit
                KodeCabangTransaksiCr = params.KodeCabangTransaksi</span>

        case TrxTypeCheck == "FUND" &amp;&amp; KodeTransaksi == "DKU2":<span class="cov2" title="2">
                kodeAccount = fmt.Sprintf("%s-%s-%s", params.Dku2.KodeGlKredit, params.Dku2.CabangGlKredit, "IDR")
                RekeningTransaksi, err = f.Store().GetRekeningTransaksi(appCtx, tx, kodeAccount)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                        f.log.Error(logrus.Fields{
                                "err":    err,
                                "result": fmt.Sprintf("%+v", RekeningTransaksi),
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        err = errors.SystemError.Database
                        respApp.Status = "02"
                        respApp.Msg = err.Error()
                        return
                }</span>

                <span class="cov2" title="2">JenisDetilTransaksiDb = "002"
                NomorRekeningDebet = params.Dku2.NomorRekeningDebet
                NamaRekeningDebet = params.Dku2.NamaNasabahDebet
                KodeCabangTransaksiDb = params.KodeCabangTransaksi

                JenisDetilTransaksiCr = "001"
                NomorRekeningKredit = kodeAccount
                NamaRekeningKredit = RekeningTransaksi.NamaRekening.String
                KodeCabangTransaksiCr = params.Dku2.CabangGlKredit</span>

        case TrxTypeCheck == "TMFUND" &amp;&amp; KodeTransaksi == "DKU2":<span class="cov2" title="2">
                kodeAccount = fmt.Sprintf("%s-%s-%s", params.Dku2.KodeGlKredit, params.Dku2.CabangGlKredit, "IDR")
                RekeningTransaksi, err = f.Store().GetRekeningTransaksi(appCtx, tx, kodeAccount)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov2" title="2">{
                        f.log.Error(logrus.Fields{
                                "err":    err,
                                "result": fmt.Sprintf("%+v", RekeningTransaksi),
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        err = errors.SystemError.Database
                        respApp.Status = "02"
                        respApp.Msg = err.Error()
                        return
                }</span>

                <span class="cov0" title="0">JenisDetilTransaksiDb = "006"
                NomorRekeningDebet = "TTP_TMCORE"
                NamaRekeningDebet = RekKodeInterfaceTrx.NamaRekening.String
                KodeCabangTransaksiDb = "888"

                JenisDetilTransaksiCr = "001"
                NomorRekeningKredit = kodeAccount
                NamaRekeningKredit = RekeningTransaksi.NamaRekening.String
                KodeCabangTransaksiCr = params.Dku2.CabangGlKredit</span>

        case TrxTypeCheck == "FUND" &amp;&amp; KodeTransaksi == "DKU3":<span class="cov1" title="1">
                kodeAccount = fmt.Sprintf("%s-%s-%s", params.Dku3.KodeGlDebet, params.Dku3.CabangGlDebet, "IDR")
                RekeningTransaksi, err = f.Store().GetRekeningTransaksi(appCtx, tx, kodeAccount)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        f.log.Error(logrus.Fields{
                                "err":    err,
                                "result": fmt.Sprintf("%+v", RekeningTransaksi),
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        err = errors.SystemError.Database
                        respApp.Status = "02"
                        respApp.Msg = err.Error()
                        return
                }</span>

                <span class="cov0" title="0">JenisDetilTransaksiDb = "001"
                NomorRekeningDebet = kodeAccount
                NamaRekeningDebet = RekeningTransaksi.NamaRekening.String
                KodeCabangTransaksiDb = params.Dku3.CabangGlDebet

                JenisDetilTransaksiCr = "002"
                NomorRekeningKredit = params.Dku3.NomorRekeningKredit
                NamaRekeningKredit = params.Dku3.NamaNasabahKredit
                KodeCabangTransaksiCr = params.KodeCabangTransaksi</span>

        case TrxTypeCheck == "FUNDTM" &amp;&amp; KodeTransaksi == "DKU3":<span class="cov1" title="1">
                kodeAccount = fmt.Sprintf("%s-%s-%s", params.Dku3.KodeGlDebet, params.Dku3.CabangGlDebet, "IDR")
                RekeningTransaksi, err = f.Store().GetRekeningTransaksi(appCtx, tx, kodeAccount)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        f.log.Error(logrus.Fields{
                                "err":    err,
                                "result": fmt.Sprintf("%+v", RekeningTransaksi),
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        err = errors.SystemError.Database
                        respApp.Status = "02"
                        respApp.Msg = err.Error()
                        return
                }</span>

                <span class="cov0" title="0">JenisDetilTransaksiDb = "001"
                NomorRekeningDebet = kodeAccount
                NamaRekeningDebet = RekeningTransaksi.NamaRekening.String
                KodeCabangTransaksiDb = params.Dku3.CabangGlDebet

                JenisDetilTransaksiCr = "006"
                NomorRekeningKredit = "TTP_TMCORE"
                NamaRekeningKredit = RekKodeInterfaceTrx.NamaRekening.String
                KodeCabangTransaksiCr = "888"</span>

        case TrxTypeCheck == "FUND" &amp;&amp; KodeTransaksi == "DKU4":<span class="cov2" title="2">
                kodeAccount = fmt.Sprintf("%s-%s-%s", params.Dku4.KodeGlDebet, params.Dku4.CabangGlDebet, "IDR")
                RekeningTransaksi, err = f.Store().GetRekeningTransaksi(appCtx, tx, kodeAccount)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        f.log.Error(logrus.Fields{
                                "err":    err,
                                "result": fmt.Sprintf("%+v", RekeningTransaksi),
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        err = errors.SystemError.Database
                        respApp.Status = "02"
                        respApp.Msg = err.Error()
                        return
                }</span>

                <span class="cov1" title="1">kodeAccount2 = fmt.Sprintf("%s-%s-%s", params.Dku4.KodeGlKredit, params.Dku4.CabangGlKredit, "IDR")
                RekeningTransaksi2, err = f.Store().GetRekeningTransaksi(appCtx, tx, kodeAccount2)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        f.log.Error(logrus.Fields{
                                "err":    err,
                                "result": fmt.Sprintf("%+v", RekeningTransaksi2),
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        err = errors.SystemError.Database
                        respApp.Status = "02"
                        respApp.Msg = err.Error()
                        return
                }</span>

                <span class="cov0" title="0">JenisDetilTransaksiDb = "001"
                NomorRekeningDebet = kodeAccount
                NamaRekeningDebet = RekeningTransaksi.NamaRekening.String
                KodeCabangTransaksiDb = params.Dku4.CabangGlDebet

                JenisDetilTransaksiCr = "001"
                NomorRekeningKredit = kodeAccount2
                NamaRekeningKredit = RekeningTransaksi2.NamaRekening.String
                KodeCabangTransaksiCr = params.Dku4.CabangGlKredit</span>

        }

        <span class="cov7" title="9">DetilTrxDb := datastore.DetilTrx{
                JenisDetilTransaksi: JenisDetilTransaksiDb,
                NomorRekening:       NomorRekeningDebet,
                JenisMutasi:         "D",
                NilaiMutasi:         float64(params.NilaiTransaksi),
                KodeCabang:          KodeCabangTransaksiDb,
                Keterangan:          params.Keterangan,
                NilaiKursManual:     1,
                NilaiEkuivalen:      float64(params.NilaiTransaksi),
                NomorReferensi:      params.NomorReferensi,
                FlagProses:          "F",
                KodeJurnal:          "11",
                KodeValutaRak:       "IDR",
        }
        ListDetilTrx = append(ListDetilTrx, DetilTrxDb)

        DetilTrxCr := datastore.DetilTrx{
                JenisDetilTransaksi: JenisDetilTransaksiCr,
                NomorRekening:       NomorRekeningKredit,
                JenisMutasi:         "C",
                NilaiMutasi:         float64(params.NilaiTransaksi),
                KodeCabang:          KodeCabangTransaksiCr,
                Keterangan:          params.Keterangan,
                NilaiKursManual:     1,
                NilaiEkuivalen:      float64(params.NilaiTransaksi),
                NomorReferensi:      params.NomorReferensi,
                FlagProses:          "F",
                KodeJurnal:          "11",
                KodeValutaRak:       "IDR",
        }
        ListDetilTrx = append(ListDetilTrx, DetilTrxCr)

        PostTrx := data.PostTrx{
                DataTrx:  DataTrx,
                DetilTrx: ListDetilTrx,
        }

        RespTrx, err := f.Utils().GenericTrx(appCtx, tx, PostTrx)
        if (err != nil &amp;&amp; err != sql.ErrNoRows) || RespTrx.Status == "02" </span><span class="cov6" title="6">{
                remark := RespTrx.Msg
                f.log.Error(logrus.Fields{
                        "err":     err,
                        "RespTrx": RespTrx,
                        "Status":  RespTrx.Status,
                        "Msg":     RespTrx.Msg,
                }, nil, remark)
                //f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respApp.Status = "02"
                respApp.Msg = remark
                return respApp, err
        }</span>

        <span class="cov4" title="3">IdTransaksi = RespTrx.Data.IdTransaksiFund

        infoTransaksi := datastore.InsertInfoTransaksi{
                IdTransaksi:            IdTransaksi,
                NomorRekeningDebet:     NomorRekeningDebet,
                NomorRekeningKredit:    NomorRekeningKredit,
                NamaRekeningDebet:      NamaRekeningDebet,
                NamaRekeningKredit:     NamaRekeningKredit,
                IsTunai:                "F",
                NominalTransaksi:       float64(params.NilaiTransaksi),
                NomorRekeningTransaksi: NomorRekeningDebet,
                NamaRekeningTransaksi:  NamaRekeningDebet,
                NomorRekeningPair:      NomorRekeningKredit,
                NamaRekeningPair:       NamaRekeningKredit,
                JenisMutasiTransaksi:   "D",
                JenisMutasiPair:        "K",
        }

        err = f.Store().InsertInfoTransaksi(appCtx, tx, infoTransaksi)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "error":  err,
                        "params": infoTransaksi,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                respApp.Status = "02"
                respApp.Msg = err.Error()
                return
        }</span>

        <span class="cov2" title="2">InfoUidReq := datastore.InfoUidReq{
                Uidkey:     params.Uidkey,
                ActionType: "POST_TRX_JOURNAL_SINGLE",
                UserInput:  params.UserInput,
                UserOtor:   params.UserOtorisasi,
                Keterangan: params.Keterangan,
                Info1:      NomorRekeningDebet,
                Info2:      NomorRekeningDebet,
                KodeCabang: params.KodeCabangTransaksi,
                Keyint:     IdTransaksi,
        }
        err = f.Store().InsertInfoUid(appCtx, tx, InfoUidReq)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                err = errors.SystemError.Database
                respApp.Status = "02"
                respApp.Msg = err.Error()
                return
        }</span>

        <span class="cov1" title="1">respApp.Status = "00"
        respApp.Msg = "Transaksi Umum Single Berhasil"
        respApp.Data.IdTransaksi = IdTransaksi
        respApp.Data.KodeTransaksi = params.KodeTransaksi
        respApp.Data.NomorReferensi = params.NomorReferensi
        respApp.Data.NilaiTransaksi = params.NilaiTransaksi
        respApp.Data.Keterangan = params.Keterangan

        f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}

func (f *service) GetGLJurnalList(ctx context.Context, params datastore.GLJurnalGetRequest) (respApp []datastore.GLJurnalGetData, err error) <span class="cov4" title="4">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GetGLJurnalList %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov4" title="3">defer f.PanicHandler(tx, &amp;err)

        if params.AllCabang != "1" &amp;&amp; params.KodeCabang == "" </span><span class="cov1" title="1">{
                remark := "Mohon lengkapi isi pada Filter Cabang terlebih dahulu!"
                f.log.Warn(logrus.Fields{"kode_cabang": params.KodeCabang}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov2" title="2">if params.TglAwal == "" || params.TglAkhir == "" </span><span class="cov1" title="1">{
                remark := "Mohon lengkapi isi pada Filter tanggal terlebih dahulu!"
                f.log.Warn(logrus.Fields{"tgl_awal": params.TglAwal, "tgl_akhir": params.TglAkhir}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov1" title="1">respApp, err = f.Store().GetGLJurnal(appCtx, tx, params)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "result": respApp,
                        "error":  err,
                        "params": params,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov1" title="1">f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")
        return</span>
}

func (f *service) GetGLJurnalDetail(ctx context.Context, params datastore.GLJurnalDetailRequest) (journalData datastore.GLJurnalDetailData, journalItem []datastore.GLJurnalItem, journalBlock []datastore.GLJurnalBlock, err error) <span class="cov6" title="7">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GetGLJurnalDetail %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov6" title="6">defer f.PanicHandler(tx, &amp;err)

        if params.JournalNo == "" </span><span class="cov1" title="1">{
                remark := "Mohon lengkapi Nomor Jurnal terlebih dahulu!"
                f.log.Warn(logrus.Fields{}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov5" title="5">journalData, err = f.Store().DetailGLJurnal(appCtx, tx, params)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "journalData": journalData,
                        "error":       err,
                        "params":      params,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov4" title="4">journalItem, err = f.Store().DetailGLJurnalItem(appCtx, tx, params)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "journalItem": journalItem,
                        "error":       err,
                        "params":      params,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov4" title="3">journalBlock, err = f.Store().DetailGLJurnalBlock(appCtx, tx, params)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "journalBlock": journalBlock,
                        "error":        err,
                        "params":       params,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov2" title="2">if journalData.JournalNo.String == "" &amp;&amp; len(journalItem) == 0 &amp;&amp; len(journalBlock) == 0 </span><span class="cov1" title="1">{
                remark := fmt.Sprintf("Jurnal dengan nomor %s tidak ditemukan", params.JournalNo)
                f.log.Warn(logrus.Fields{}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov1" title="1">f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")
        return</span>
}

func (f *service) GetGLJurnalSlip(ctx context.Context, params datastore.GLJurnalDetailRequest) (respApp data.GLJurnalSlipResponse, err error) <span class="cov6" title="6">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GetGLJurnalSlip %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov5" title="5">defer f.PanicHandler(tx, &amp;err)

        if params.JournalNo == "" </span><span class="cov1" title="1">{
                remark := "Mohon lengkapi Nomor Jurnal terlebih dahulu!"
                f.log.Warn(logrus.Fields{}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov4" title="4">journalData, err := f.Store().DetailGLJurnal(appCtx, tx, params)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "journalData": journalData,
                        "error":       err,
                        "params":      params,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov4" title="3">journalItem, err := f.Store().DetailGLJurnalItem(appCtx, tx, params)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "journalItem": journalItem,
                        "error":       err,
                        "params":      params,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov2" title="2">journalBlock, err := f.Store().DetailGLJurnalBlock(appCtx, tx, params)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "journalBlock": journalBlock,
                        "error":        err,
                        "params":       params,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov1" title="1">if journalData.JournalNo.String == "" &amp;&amp; len(journalItem) == 0 &amp;&amp; len(journalBlock) == 0 </span><span class="cov1" title="1">{
                remark := fmt.Sprintf("Jurnal dengan nomor %s tidak ditemukan", params.JournalNo)
                f.log.Warn(logrus.Fields{}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        // Generate PDF
        <span class="cov0" title="0">r := helpers.NewRequestPdf("")
        r.LocalFileAccess(true)

        templatePath := "templates/slip_jurnal.html"
        timestamp := time.Now().Format("20060102150405")
        fileName := fmt.Sprintf("slip_jurnal_%s_%s.pdf", journalData.JournalNo.String, timestamp)
        outputPath := fmt.Sprintf("%v", fileName)

        OtorStatus := "Belum otorisasi"
        if journalData.JournalState.String == "C" </span><span class="cov0" title="0">{
                OtorStatus = "Sudah terotorisasi"
        }</span>

        <span class="cov0" title="0">var contentDetailHtml string
        var totalDebet float64
        var totalKredit float64

        for i := 0; i &lt; len(journalItem); i++ </span><span class="cov0" title="0">{
                contentDetailHtml += fmt.Sprintf(`
                &lt;tr&gt;
                        &lt;td&gt;%s&lt;/td&gt;
                        &lt;td&gt;%s&lt;/td&gt;
                        &lt;td&gt;%s&lt;/td&gt;
                        &lt;td&gt;%s&lt;/td&gt;
                        &lt;td&gt;%v&lt;/td&gt;
                        &lt;td&gt;%v&lt;/td&gt;
                        &lt;td&gt;%v&lt;/td&gt;
                        &lt;td&gt;%v&lt;/td&gt;
                        &lt;td&gt;%v&lt;/td&gt;
                        &lt;td&gt;%s&lt;/td&gt;
                &lt;/tr&gt;`,
                        journalItem[i].KodeRekening.String,
                        journalItem[i].NamaRekening.String,
                        journalItem[i].KodeKantor.String,
                        journalItem[i].Valuta.String,
                        *journalItem[i].NilaiKurs,
                        *journalItem[i].Debet,
                        *journalItem[i].Debet,
                        *journalItem[i].Kredit,
                        *journalItem[i].Kredit,
                        journalItem[i].Keterangan.String,
                )

                totalDebet += *journalItem[i].Debet
                totalKredit += *journalItem[i].Kredit
        }</span>

        <span class="cov0" title="0">templateData := struct {
                JournalNo               string
                TransactionDate         string
                JournalDate             string
                JournalDateLastModified string
                JournalDatePosting      string
                BranchCode              string
                Description             string
                TrxStatus               string
                UserIdCreate            string
                JournalItemHtml         template.HTML
                TotalDebet              float64
                TotalDebetEkuivalen     float64
                TotalKredit             float64
                TotalKreditEkuivalen    float64
        }{
                JournalNo:               journalData.JournalNo.String,
                TransactionDate:         journalData.TransactionDate.String,
                JournalDate:             journalData.JournalDate.String,
                JournalDateLastModified: journalData.JournalDateLastModified.String,
                JournalDatePosting:      journalData.JournalDatePosting.String,
                BranchCode:              journalData.BranchCode.String,
                Description:             journalData.Description.String,
                TrxStatus:               OtorStatus,
                UserIdCreate:            journalData.UseridCreate.String,
                JournalItemHtml:         template.HTML(contentDetailHtml),
                TotalDebet:              totalDebet,
                TotalDebetEkuivalen:     totalDebet,
                TotalKredit:             totalKredit,
                TotalKreditEkuivalen:    totalKredit,
        }

        if err = r.ParseTemplateFile(templatePath, templateData); err != nil </span><span class="cov0" title="0">{
                remark := "failed to parse template"
                f.log.Error(logrus.Fields{
                        "templatePath": templatePath,
                        "outputPath":   outputPath,
                        "templateData": templateData,
                        "error":        err,
                        "params":       params,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov0" title="0">if err = r.GeneratePDF(outputPath); err != nil </span><span class="cov0" title="0">{
                remark := "failed to generate PFD"
                f.log.Error(logrus.Fields{
                        "templatePath": templatePath,
                        "outputPath":   outputPath,
                        "templateData": templateData,
                        "error":        err,
                        "params":       params,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        // upload to cloud
        <span class="cov0" title="0">uploadMinio, err := f.uploadToCloud(ctx, outputPath, "/"+utils.MINIO_SLIP_JURNAL_DIR, fileName, utils.PDF_EXTENSION)
        if err != nil </span><span class="cov0" title="0">{
                f.removeFile(outputPath)
                f.log.Error(logrus.Fields{"error": err.Error(), "params": outputPath}, nil, err.Error())
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov0" title="0">f.removeFile(outputPath)

        respApp = data.GLJurnalSlipResponse{
                Filename: outputPath,
                Bucket:   uploadMinio.Bucket,
                Path:     uploadMinio.Path,
                FileUrl:  uploadMinio.Url,
        }

        f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")
        return</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package app

import (
        "context"
        "database/sql"
        "fmt"
        "fundtx/data"
        "fundtx/datastore"
        "fundtx/pkg/errors"

        otel_code "go.opentelemetry.io/otel/codes"

        "github.com/jmoiron/sqlx"
        "github.com/sirupsen/logrus"
        "go.opentelemetry.io/otel/attribute"
)

func (f *service) CreateJournal(ctx context.Context, tx *sqlx.Tx, params data.CreateJournalReq) (err error) <span class="cov10" title="23">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("CreateJournal %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        nilaiValuta, err := f.Store().GetGlobalParam(appCtx, tx, "KVD")
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "result": nilaiValuta,
                        "error":  err,
                        "params": "KVD",
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov9" title="22">defaultValuta := nilaiValuta.NilaiParameterString.String

        nilaiRAK, err := f.Store().GetGlobalGlInterface(appCtx, tx, "RAK_OTO")
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "result": nilaiRAK,
                        "error":  err,
                        "params": "RAK_OTO",
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov9" title="21">defaultRAK := nilaiRAK.KodeAccount
        namaRAKOTO := nilaiRAK.NamaAccount

        ParUpdateNilaiKurs := datastore.ParUpdateNilaiKurs{
                IdTransaksi:   params.IdTransaksi,
                DefaultValuta: defaultValuta,
        }
        err = f.Store().UpdateNilaiKurs(appCtx, tx, ParUpdateNilaiKurs)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "params": fmt.Sprintf("%+v", ParUpdateNilaiKurs),
                        "error":  err,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov9" title="20">ParUpdateNilaiEkuivalen := datastore.ParUpdateNilaiEkuivalen{
                IdTransaksi:   params.IdTransaksi,
                DefaultValuta: defaultValuta,
        }
        err = f.Store().UpdateNilaiEkuivalen(appCtx, tx, ParUpdateNilaiEkuivalen)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "params": fmt.Sprintf("%+v", ParUpdateNilaiEkuivalen),
                        "error":  err,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov9" title="19">checkData, err := f.Store().AccountingDayAvability(appCtx, tx, params.Date)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "result": checkData,
                        "error":  err,
                        "params": params.Date,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov9" title="18">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := fmt.Sprintf(`Accounting day %s not found`, params.Date)
                err = fmt.Errorf(remark)
                f.log.Error(logrus.Fields{
                        "result": checkData,
                        "error":  err,
                        "params": params.Date,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov9" title="17">ParValiditasDataJournal := datastore.ParValiditasDataJournal{
                IdTransaksi:   params.IdTransaksi,
                DefaultValuta: defaultValuta,
        }
        validitasData, err := f.Store().CheckValiditasDataJournal(appCtx, tx, ParValiditasDataJournal)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "result": fmt.Sprintf("%+v", validitasData),
                        "error":  err,
                        "params": fmt.Sprintf("%+v", ParValiditasDataJournal),
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov8" title="16">if validitasData.IdDetilTransaksi.Valid </span><span class="cov1" title="1">{
                remark := fmt.Sprintf(`Ada data transaksi tidak lengkap. ID Transaksi = %v`, params.IdTransaksi)
                err = fmt.Errorf(remark)
                f.log.Error(logrus.Fields{
                        "result": fmt.Sprintf("%+v", validitasData),
                        "error":  err,
                        "params": fmt.Sprintf("%+v", ParValiditasDataJournal),
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov8" title="15">accountInstance, err := f.Store().CheckAccountInstanceJournal(appCtx, tx, params.IdTransaksi)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "result": fmt.Sprintf("%+v", accountInstance),
                        "error":  err,
                        "params": params.IdTransaksi,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov8" title="14">if accountInstance.IdDetilTransaksi.Valid </span><span class="cov1" title="1">{
                remark := fmt.Sprintf("Account instance pada id transaksi = %v tidak ada", params.IdTransaksi)
                err = fmt.Errorf(remark)
                f.log.Error(logrus.Fields{
                        "result": fmt.Sprintf("%+v", accountInstance),
                        "error":  err,
                        "params": params.IdTransaksi,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov8" title="13">checkBalance, err := f.Store().CheckBalanceJournal(appCtx, tx, params.IdTransaksi)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "result": fmt.Sprintf("%+v", checkBalance),
                        "error":  err,
                        "params": params.IdTransaksi,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov8" title="12">if checkBalance.IdTransaksi.Valid </span><span class="cov1" title="1">{
                remark := fmt.Sprintf(`Transaksi dengan id %d tidak balanced di valuta %s`, params.IdTransaksi, defaultValuta)
                err = fmt.Errorf(remark)
                f.log.Error(logrus.Fields{
                        "result": fmt.Sprintf("%+v", checkBalance),
                        "error":  err,
                        "params": params.IdTransaksi,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov7" title="11">ParMergeJournalNumber := datastore.ParMergeJournalNumber{
                IdTransaksi: params.IdTransaksi,
        }

        err = f.Store().MergeJournalNumber(appCtx, tx, ParMergeJournalNumber)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "error":  err,
                        "params": fmt.Sprintf("%+v", ParMergeJournalNumber),
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov7" title="10">ParInsertSelectJournal := datastore.ParInsertSelectJournal{
                IdTransaksi: params.IdTransaksi,
                DateValue:   params.Date,
        }
        err = f.Store().InsertSelectJournal(appCtx, tx, ParInsertSelectJournal)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "error":  err,
                        "params": fmt.Sprintf("%+v", ParInsertSelectJournal),
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov7" title="9">ParInsertSelectJournalItem := datastore.ParInsertSelectJournalItem{
                IdTransaksi: params.IdTransaksi,
        }
        err = f.Store().InsertSelectJournalItem(appCtx, tx, ParInsertSelectJournalItem)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "error":  err,
                        "params": fmt.Sprintf("%+v", ParInsertSelectJournalItem),
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov6" title="8">RAKOtomatis := datastore.BalancingRAKOtotmatisJournalReq{
                IdTransaksi: params.IdTransaksi,
                AccCodeRAK1: defaultRAK,
                AccCodeRAK2: defaultRAK,
                AccCodeRAK3: defaultRAK,
                NamaRak:     namaRAKOTO,
        }
        err = f.Store().BalancingRAKOtomatisJournal(appCtx, tx, RAKOtomatis)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "params": fmt.Sprintf("%+v", RAKOtomatis),
                        "error":  err,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov6" title="7">err = f.Store().UpdateTrxStatusJournal(appCtx, tx, params.IdTransaksi)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "error":  err,
                        "params": params.IdTransaksi,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov6" title="6">err = f.Store().InsertCompletedJournal(appCtx, tx, params.IdTransaksi)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "error": err,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov5" title="5">err = f.Store().DeletePendingJournal(appCtx, tx, params.IdTransaksi)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "error": err,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = errors.SystemError.Database

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov4" title="4">appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}
</pre>
		
		<pre class="file" id="file3" style="display: none">package app

import (
        "context"
        "database/sql"
        "fmt"
        "fundtx/datastore"

        otel_code "go.opentelemetry.io/otel/codes"

        "github.com/sirupsen/logrus"
        "go.opentelemetry.io/otel/attribute"
)

func (f *service) POST_PENDING_CLRDEPOSIT_DEL(ctx context.Context, reqPayload datastore.GetPostPendingCLRDepositDelReq) (responseApp datastore.PostNotaDebetOutwardDeleted, respCode string, respMsg string, err error) <span class="cov10" title="7">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("POST_PENDING_CLRDEPOSIT_DEL %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(
                        logrus.Fields{"error": err}, nil, remark,
                )
                f.Store().Rollback(tx)

                respCode = "02"
                respMsg = remark

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov9" title="6">defer f.PanicHandler(tx, &amp;err)

        if reqPayload.IdGroup == "" </span><span class="cov1" title="1">{
                respCode = "02"
                respMsg = "id_group harus di isi"
                remark := "The request payload 'id_group' is an empty string"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov8" title="5">responseApp, err = f.Store().GetNotaDebitOutwardDelList(appCtx, tx, reqPayload)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)

                respCode = "02"
                respMsg = remark

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov7" title="4">if responseApp.JumlahTerhapus &lt;= 0 </span><span class="cov1" title="1">{
                respCode = "02"
                respMsg = "Data untuk dihapus tidak ditemukan"
                remark := "no row with given id_group is found"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov6" title="3">err = f.Store().DelNotaDebitOutward(appCtx, tx, reqPayload)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)

                respCode = "02"
                respMsg = remark

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov4" title="2">err = f.Store().DelNotaDebitOutwardGroup(appCtx, tx, reqPayload)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)

                respCode = "02"
                respMsg = remark

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov1" title="1">respCode = "00"
        respMsg = "Berhasil"
        f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package app

import (
        "context"
        "fmt"
        "fundtx/data"
        "io"
        "os"
        "time"

        "github.com/minio/minio-go/v7"
        "github.com/minio/minio-go/v7/pkg/credentials"
        "github.com/sirupsen/logrus"
        "github.com/spf13/viper"
        "go.opentelemetry.io/otel/attribute"
        otel_code "go.opentelemetry.io/otel/codes"
)

func (f *service) uploadToCloud(ctx context.Context, tmpDir, folder, filename, extension string) (result data.UploadToCloudResult, err error) <span class="cov0" title="0">{
        _, appSpan := f.tracer.Start(ctx, fmt.Sprintf("uploadToCloud %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        startTime := time.Now()

        contentTypeMap := map[string]string{
                "xlsx": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                "jpg":  "image/jpeg",
        }

        var (
                MINIO_API_PORT     = viper.GetString("MINIO_API_PORT")
                MINIO_ENDPOINT     = viper.GetString("MINIO_ENDPOINT")
                MINIO_SECURE       = viper.GetBool("MINIO_SECURE")
                MINIO_BUCKET       = viper.GetString("MINIO_BUCKET")
                MINIO_URL_PATH     = viper.GetString("MINIO_URL_PATH")
                MINIO_ACCESS_KEY   = viper.GetString("MINIO_ACCESS_KEY")
                MINIO_SECRET_KEY   = viper.GetString("MINIO_SECRET_KEY")
                MINIO_API_ENDPOINT = fmt.Sprintf("%s:%s", MINIO_ENDPOINT, MINIO_API_PORT)
                objectName         = fmt.Sprintf("%s/%s", folder, filename)
                contentType        = contentTypeMap[extension]
        )

        // Initialize minio client object.
        minioClient, err := minio.New(MINIO_API_ENDPOINT, &amp;minio.Options{
                Creds:  credentials.NewStaticV4(MINIO_ACCESS_KEY, MINIO_SECRET_KEY, ""),
                Region: "eu-west-1", //bcas ap-southeast-3, isi ap-southeast-1, cgs eu-west-1
                Secure: MINIO_SECURE,
        })
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{"error": err.Error()}, nil, err.Error())
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov0" title="0">uploadInfo, err := minioClient.FPutObject(ctx, MINIO_BUCKET, objectName, tmpDir, minio.PutObjectOptions{ContentType: contentType})
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{"error": err.Error()}, nil, err.Error())
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov0" title="0">result = data.UploadToCloudResult{
                Path:   fmt.Sprintf("%s/%s", folder, filename),
                Bucket: MINIO_BUCKET,
                Url:    MINIO_URL_PATH + objectName,
        }

        f.log.Info(logrus.Fields{"uploadInfo": uploadInfo}, nil, "file uccessfully uploaded")

        elapsedTime := time.Since(startTime)
        f.log.Info(logrus.Fields{"elapsedTime": elapsedTime}, nil, "log info: uploadToCloud")

        appSpan.SetStatus(otel_code.Ok, "api successes")
        return</span>
}

func (f *service) downloadFromCloud(ctx context.Context, tmpFile string, objectName string, bucket string) (result data.DownloadFromCloudResult, err error) <span class="cov0" title="0">{
        _, appSpan := f.tracer.Start(ctx, fmt.Sprintf("downloadFromCloud %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        startTime := time.Now()

        var (
                MINIO_API_PORT     = viper.GetString("MINIO_API_PORT")
                MINIO_ENDPOINT     = viper.GetString("MINIO_ENDPOINT")
                MINIO_SECURE       = viper.GetBool("MINIO_SECURE")
                MINIO_URL_PATH     = viper.GetString("MINIO_URL_PATH")
                MINIO_ACCESS_KEY   = viper.GetString("MINIO_ACCESS_KEY")
                MINIO_SECRET_KEY   = viper.GetString("MINIO_SECRET_KEY")
                MINIO_API_ENDPOINT = fmt.Sprintf("%s:%s", MINIO_ENDPOINT, MINIO_API_PORT)
        )

        // Initialize minio client object.
        minioClient, err := minio.New(MINIO_API_ENDPOINT, &amp;minio.Options{
                Creds:  credentials.NewStaticV4(MINIO_ACCESS_KEY, MINIO_SECRET_KEY, ""),
                Region: "eu-west-1", //bcas ap-southeast-3, isi ap-southeast-1, cgs eu-west-1
                Secure: MINIO_SECURE,
        })
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{"error": err.Error()}, nil, err.Error())
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov0" title="0">f.log.Info(logrus.Fields{
                "bucket":           bucket,
                "objectName":       objectName,
                "tmpFile":          tmpFile,
                "MINIO_ENDPOINT":   MINIO_ENDPOINT,
                "MINIO_SECURE":     MINIO_SECURE,
                "MINIO_URL_PATH":   MINIO_URL_PATH,
                "MINIO_ACCESS_KEY": MINIO_ACCESS_KEY,
                "MINIO_SECRET_KEY": MINIO_SECRET_KEY,
        }, nil, "Minio download OBJ")

        object, err := minioClient.GetObject(ctx, bucket, objectName, minio.GetObjectOptions{})
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{"error": err.Error()}, nil, err.Error())
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov0" title="0">defer object.Close()

        file, err := os.Create(tmpFile)
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{"error": err.Error()}, nil, err.Error())
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov0" title="0">_, err = io.Copy(file, object)
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{"error": err.Error()}, nil, err.Error())
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov0" title="0">file.Close()

        result = data.DownloadFromCloudResult{
                FilePath: tmpFile,
                Bucket:   bucket,
                Url:      MINIO_URL_PATH + objectName,
        }

        f.log.Info(logrus.Fields{"downloadInfo": result}, nil, "file successfully downloaded")

        elapsedTime := time.Since(startTime)
        f.log.Info(logrus.Fields{"elapsedTime": elapsedTime}, nil, "log info: downloadFromCloud")

        appSpan.SetStatus(otel_code.Ok, "api successes")
        return</span>
}
</pre>
		
		<pre class="file" id="file5" style="display: none">package app

import (
        "context"
        "database/sql"
        "fmt"
        "fundtx/data"
        "fundtx/datastore"
        "strings"

        "fundtx/pkg/logging/utils"

        "github.com/sirupsen/logrus"
        "go.opentelemetry.io/otel/attribute"
        otel_code "go.opentelemetry.io/otel/codes"
)

func (f *service) GetOverrideValidation(ctx context.Context, params data.GetOverrideValidationReq) (result []data.OverrideValidationData, err error) <span class="cov10" title="4">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GetOverrideValidation %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        params.UserId = strings.ToUpper(params.UserId)

        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov0" title="0">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov10" title="4">defer f.PanicHandler(tx, &amp;err)

        // validasi field wajib (KodeTransaksi)
        if params.KodeTransaksi == "" </span><span class="cov1" title="1">{
                remark := "field kode_transaksi harus diisi"
                f.log.Warn(logrus.Fields{
                        "kode_transaksi": params.KodeTransaksi,
                }, nil, "field mandatori")
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        // Notes : SKNT dan RTGST untuk membaca transaksi skn atau rtgs tunai
        // 02 : Validasi Limit Trx
        // validasi field wajib (UserId)
        <span class="cov8" title="3">if params.UserId == "" </span><span class="cov1" title="1">{
                remark := "field user_id harus diisi"
                f.log.Warn(logrus.Fields{
                        "user_id": params.UserId,
                }, nil, "field mandatori")
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov5" title="2">KodeTransaksi := params.KodeTransaksi
        if params.KodeTransaksi == "SKNT" </span><span class="cov0" title="0">{
                KodeTransaksi = "SKN"
        }</span>

        <span class="cov5" title="2">if params.KodeTransaksi == "RTGST" </span><span class="cov0" title="0">{
                KodeTransaksi = "RTGS"
        }</span>

        <span class="cov5" title="2">ValidationLimitTrxReq := datastore.ValidationLimitTrxReq{
                KodeTransaksi: KodeTransaksi,
                UserId:        params.UserId,
        }
        var LimitTrx datastore.DsLimitTrx
        LimitTrx, err = f.Store().GetValidationLimitTrx(appCtx, tx, ValidationLimitTrxReq)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "result": fmt.Sprintf("%+v", LimitTrx),
                        "error":  err,
                        "params": fmt.Sprintf("%+v", ValidationLimitTrxReq),
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov5" title="2">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := fmt.Sprintf("Limit transaksi %v untuk user ID %v belum disetting. Silahkan hubungi costomer suport untuk melakukan setting limit transaksi", LimitTrx.Keterangan.String, params.UserId)
                f.log.Warn(logrus.Fields{
                        "result": fmt.Sprintf("%+v", LimitTrx),
                        "error":  err,
                        "params": fmt.Sprintf("%+v", ValidationLimitTrxReq),
                }, nil, err.Error())
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov1" title="1">NilaiLimit1 := f.CurrencyFormatStr(float64(LimitTrx.NilaiLimit.Float64), "D", 2, "Rp")
        NilaiTransaksi1 := f.CurrencyFormatStr(float64(params.NilaiTransaksi), "D", 2, "Rp")

        if params.NilaiTransaksi &gt; LimitTrx.NilaiLimit.Float64 </span><span class="cov1" title="1">{
                OverrideLimitTrx := data.OverrideValidationData{
                        KodeValidasi:       "02",
                        KeteranganValidasi: fmt.Sprintf("Nilai transaksi sebesar %v melebihi limit transaksi %v-%v untuk user id %v sebesar %v", NilaiTransaksi1, params.KodeTransaksi, LimitTrx.Keterangan.String, params.UserId, NilaiLimit1),
                }

                result = append(result, OverrideLimitTrx)
        }</span>

        // 03a : Validasi status rekening tidak aktif
        <span class="cov1" title="1">if utils.Contains([]interface{}{"ST", "TT", "PB", "SKN", "RTGS", "TDN", "SDN"}, params.KodeTransaksi) &amp;&amp; params.IsTm != "T" </span><span class="cov1" title="1">{
                // validasi field wajib (NomorRekeningDebet)
                if utils.Contains([]interface{}{"TT", "PB", "SKN", "RTGS"}, params.KodeTransaksi) </span><span class="cov1" title="1">{
                        if params.NomorRekeningDebet == "" </span><span class="cov0" title="0">{
                                remark := "field nomor_rekening_debet harus diisi"
                                f.log.Warn(logrus.Fields{
                                        "nomor_rekening_debet": params.NomorRekeningDebet,
                                }, nil, "field mandatori")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov1" title="1">var AccountLiabilitasDb datastore.RekeningLiabDetail
                        AccountLiabilitasDb, err = f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningDebet)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasDb),
                                        "error":  err,
                                        "params": params.NomorRekeningDebet,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov1" title="1">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := fmt.Sprintf("Nomor rekening %v tidak terdaftar sebagai rekeningliabilitas", params.NomorRekeningDebet)
                                f.log.Warn(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasDb),
                                        "error":  err,
                                        "params": params.NomorRekeningDebet,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov1" title="1">if utils.ContainsInteger([]interface{}{int64(2)}, int64(AccountLiabilitasDb.StatusRekening.Int32)) </span><span class="cov0" title="0">{
                                OverrideStatusRekening := data.OverrideValidationData{
                                        KodeValidasi:       "03a",
                                        KeteranganValidasi: fmt.Sprintf("Status rekening %v %v", params.NomorRekeningDebet, AccountLiabilitasDb.StatusRekeningDesc.String),
                                }
                                result = append(result, OverrideStatusRekening)
                        }</span>
                }

                // validasi field wajib (NomorRekeningKredit)
                <span class="cov1" title="1">if utils.Contains([]interface{}{"ST", "PB", "TDN", "SDN"}, params.KodeTransaksi) </span><span class="cov0" title="0">{
                        if params.NomorRekeningKredit == "" </span><span class="cov0" title="0">{
                                remark := "field nomor_rekening_kredit harus diisi"
                                f.log.Warn(logrus.Fields{
                                        "nomor_rekening_kredit": params.NomorRekeningKredit,
                                }, nil, "field mandatori")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">var AccountLiabilitasCr datastore.RekeningLiabDetail
                        AccountLiabilitasCr, err = f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningKredit)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasCr),
                                        "error":  err,
                                        "params": params.NomorRekeningKredit,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := fmt.Sprintf("Nomor rekening %v tidak terdaftar sebagai rekeningliabilitas", params.NomorRekeningKredit)
                                f.log.Warn(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasCr),
                                        "error":  err,
                                        "params": params.NomorRekeningKredit,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">if utils.ContainsInteger([]interface{}{int64(2)}, int64(AccountLiabilitasCr.StatusRekening.Int32)) </span><span class="cov0" title="0">{
                                OverrideStatusRekening := data.OverrideValidationData{
                                        KodeValidasi:       "03a",
                                        KeteranganValidasi: fmt.Sprintf("Status rekening %v %v", params.NomorRekeningKredit, AccountLiabilitasCr.StatusRekeningDesc.String),
                                }
                                result = append(result, OverrideStatusRekening)
                        }</span>
                }
        }

        // 03b : Rekening di blokir
        <span class="cov1" title="1">if utils.Contains([]interface{}{"ST", "TT", "PB", "SKN", "RTGS", "TDN", "SDN"}, params.KodeTransaksi) &amp;&amp; params.IsTm != "T" </span><span class="cov1" title="1">{
                // validasi field wajib (NomorRekeningDebet)
                if utils.Contains([]interface{}{"TT", "PB", "SKN", "RTGS"}, params.KodeTransaksi) </span><span class="cov1" title="1">{
                        if params.NomorRekeningDebet == "" </span><span class="cov0" title="0">{
                                remark := "field nomor_rekening_debet harus diisi"
                                f.log.Warn(logrus.Fields{
                                        "nomor_rekening_debet": params.NomorRekeningDebet,
                                }, nil, "field mandatori")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov1" title="1">var AccountLiabilitasDb datastore.RekeningLiabDetail
                        AccountLiabilitasDb, err = f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningDebet)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasDb),
                                        "error":  err,
                                        "params": params.NomorRekeningDebet,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov1" title="1">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := fmt.Sprintf("Nomor rekening %v tidak terdaftar sebagai rekeningliabilitas", params.NomorRekeningDebet)
                                f.log.Warn(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasDb),
                                        "error":  err,
                                        "params": params.NomorRekeningDebet,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov1" title="1">if AccountLiabilitasDb.IsBlokir.String == "T" </span><span class="cov0" title="0">{
                                OverrideStatusRekening := data.OverrideValidationData{
                                        KodeValidasi:       "03b",
                                        KeteranganValidasi: fmt.Sprintf("Rekening %v sedang diblokir", params.NomorRekeningDebet),
                                }
                                result = append(result, OverrideStatusRekening)
                        }</span>
                }

                // validasi field wajib (NomorRekeningKredit)
                <span class="cov1" title="1">if utils.Contains([]interface{}{"ST", "PB", "TDN", "SDN"}, params.KodeTransaksi) </span><span class="cov0" title="0">{
                        if params.NomorRekeningKredit == "" </span><span class="cov0" title="0">{
                                remark := "field nomor_rekening_kredit harus diisi"
                                f.log.Warn(logrus.Fields{
                                        "nomor_rekening_kredit": params.NomorRekeningKredit,
                                }, nil, "field mandatori")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">var AccountLiabilitasCr datastore.RekeningLiabDetail
                        AccountLiabilitasCr, err = f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningKredit)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasCr),
                                        "error":  err,
                                        "params": params.NomorRekeningKredit,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := fmt.Sprintf("Nomor rekening %v tidak terdaftar sebagai rekeningliabilitas", params.NomorRekeningKredit)
                                f.log.Warn(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasCr),
                                        "error":  err,
                                        "params": params.NomorRekeningKredit,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">if AccountLiabilitasCr.IsBlokir.String == "T" </span><span class="cov0" title="0">{
                                OverrideStatusRekening := data.OverrideValidationData{
                                        KodeValidasi:       "03b",
                                        KeteranganValidasi: fmt.Sprintf("Rekening %v sedang diblokir", params.NomorRekeningKredit),
                                }
                                result = append(result, OverrideStatusRekening)
                        }</span>
                }
        }

        // 03c : Rekening tidak boleh didebet
        <span class="cov1" title="1">if utils.Contains([]interface{}{"TT", "PB", "SKN", "RTGS"}, params.KodeTransaksi) &amp;&amp; params.IsTm != "T" </span><span class="cov1" title="1">{
                // validasi field wajib (NomorRekeningDebet)
                if params.NomorRekeningDebet == "" </span><span class="cov0" title="0">{
                        remark := "field nomor_rekening_debet harus diisi"
                        f.log.Warn(logrus.Fields{
                                "nomor_rekening_debet": params.NomorRekeningDebet,
                        }, nil, "field mandatori")
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                <span class="cov1" title="1">var AccountLiabilitasDb datastore.RekeningLiabDetail
                AccountLiabilitasDb, err = f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningDebet)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "result": fmt.Sprintf("%+v", AccountLiabilitasDb),
                                "error":  err,
                                "params": params.NomorRekeningDebet,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                <span class="cov1" title="1">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := fmt.Sprintf("Nomor rekening %v tidak terdaftar sebagai rekeningliabilitas", params.NomorRekeningDebet)
                        f.log.Warn(logrus.Fields{
                                "result": fmt.Sprintf("%+v", AccountLiabilitasDb),
                                "error":  err,
                                "params": params.NomorRekeningDebet,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                <span class="cov1" title="1">if AccountLiabilitasDb.IsBolehDebet.String != "T" </span><span class="cov1" title="1">{
                        OverrideStatusRekening := data.OverrideValidationData{
                                KodeValidasi:       "03c",
                                KeteranganValidasi: fmt.Sprintf("Rekening %v tidak boleh didebet", params.NomorRekeningDebet),
                        }
                        result = append(result, OverrideStatusRekening)
                }</span>
        }

        // 03d : Rekening tidak boleh dikredit
        <span class="cov1" title="1">if utils.Contains([]interface{}{"ST", "PB", "TDN", "SDN"}, params.KodeTransaksi) &amp;&amp; params.IsTm != "T" </span><span class="cov0" title="0">{
                // validasi field wajib (NomorRekeningKredit)
                if params.NomorRekeningKredit == "" </span><span class="cov0" title="0">{
                        remark := "field nomor_rekening_kredit harus diisi"
                        f.log.Warn(logrus.Fields{
                                "nomor_rekening_kredit": params.NomorRekeningKredit,
                        }, nil, "field mandatori")
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                <span class="cov0" title="0">var AccountLiabilitasCr datastore.RekeningLiabDetail
                AccountLiabilitasCr, err = f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningKredit)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "result": fmt.Sprintf("%+v", AccountLiabilitasCr),
                                "error":  err,
                                "params": params.NomorRekeningKredit,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                <span class="cov0" title="0">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := fmt.Sprintf("Nomor rekening %v tidak terdaftar sebagai rekeningliabilitas", params.NomorRekeningKredit)
                        f.log.Warn(logrus.Fields{
                                "result": fmt.Sprintf("%+v", AccountLiabilitasCr),
                                "error":  err,
                                "params": params.NomorRekeningKredit,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                <span class="cov0" title="0">if AccountLiabilitasCr.IsBolehKredit.String != "T" </span><span class="cov0" title="0">{
                        OverrideStatusRekening := data.OverrideValidationData{
                                KodeValidasi:       "03d",
                                KeteranganValidasi: fmt.Sprintf("Rekening %v tidak boleh dikredit", params.NomorRekeningKredit),
                        }
                        result = append(result, OverrideStatusRekening)
                }</span>
        }

        // 04 : Melebihi saldo minimum
        <span class="cov1" title="1">if utils.Contains([]interface{}{"ST", "TT", "PB", "SKN", "RTGS", "TDN", "SDN"}, params.KodeTransaksi) &amp;&amp; params.IsTm != "T" </span><span class="cov1" title="1">{
                // validasi field wajib (NilaiTransaksi)
                // if params.NilaiTransaksi == 0 {
                //         remark := "field nilai_transaksi harus diisi"
                //         f.log.Warn(logrus.Fields{
                //                 "nilai_transaksi": params.NilaiTransaksi,
                //         }, nil, "field mandatori")
                //         f.Store().Rollback(tx)

                //         err = fmt.Errorf(remark)
                //         return
                // }

                // validasi field wajib (NomorRekeningDebet)
                if utils.Contains([]interface{}{"TT", "PB", "SKN", "RTGS"}, params.KodeTransaksi) </span><span class="cov1" title="1">{
                        if params.NomorRekeningDebet == "" </span><span class="cov0" title="0">{
                                remark := "field nomor_rekening_debet harus diisi"
                                f.log.Warn(logrus.Fields{
                                        "nomor_rekening_debet": params.NomorRekeningDebet,
                                }, nil, "field mandatori")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov1" title="1">var AccountLiabilitasDb datastore.RekeningLiabDetail
                        AccountLiabilitasDb, err = f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningDebet)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasDb),
                                        "error":  err,
                                        "params": params.NomorRekeningDebet,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov1" title="1">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := fmt.Sprintf("Nomor rekening %v tidak terdaftar sebagai rekeningliabilitas", params.NomorRekeningDebet)
                                f.log.Warn(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasDb),
                                        "error":  err,
                                        "params": params.NomorRekeningDebet,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov1" title="1">NilaiTransaksi := params.NilaiTransaksi
                        SaldoEfektif := AccountLiabilitasDb.SaldoEfektif.Float64
                        SaldoMinimum := AccountLiabilitasDb.SaldoMinimum.Float64
                        NilaiTransaksi1 := f.CurrencyFormatStr(float64(params.NilaiTransaksi), "D", 2, "Rp")
                        SaldoMinimum1 := f.CurrencyFormatStr(float64(SaldoMinimum), "D", 2, "Rp")

                        if (SaldoEfektif &lt; NilaiTransaksi) &amp;&amp; (NilaiTransaksi &lt;= (SaldoEfektif + SaldoMinimum)) </span><span class="cov0" title="0">{
                                OverrideStatusRekening := data.OverrideValidationData{
                                        KodeValidasi:       "04",
                                        KeteranganValidasi: fmt.Sprintf("Nilai transaksi %v melebihi saldo minimum %v rekening %v", NilaiTransaksi1, SaldoMinimum1, params.NomorRekeningDebet),
                                }
                                result = append(result, OverrideStatusRekening)
                        }</span>
                }

                // validasi field wajib (NomorRekeningKredit)
                <span class="cov1" title="1">if utils.Contains([]interface{}{"ST", "TDN", "SDN"}, params.KodeTransaksi) </span><span class="cov0" title="0">{
                        if params.NomorRekeningKredit == "" </span><span class="cov0" title="0">{
                                remark := "field nomor_rekening_kredit harus diisi"
                                f.log.Warn(logrus.Fields{
                                        "nomor_rekening_kredit": params.NomorRekeningKredit,
                                }, nil, "field mandatori")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">var AccountLiabilitasCr datastore.RekeningLiabDetail
                        AccountLiabilitasCr, err = f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningKredit)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasCr),
                                        "error":  err,
                                        "params": params.NomorRekeningKredit,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := fmt.Sprintf("Nomor rekening %v tidak terdaftar sebagai rekeningliabilitas", params.NomorRekeningKredit)
                                f.log.Warn(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", AccountLiabilitasCr),
                                        "error":  err,
                                        "params": params.NomorRekeningKredit,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">NilaiTransaksi := params.NilaiTransaksi
                        SaldoEfektif := AccountLiabilitasCr.SaldoEfektif.Float64
                        SaldoMinimum := AccountLiabilitasCr.SaldoMinimum.Float64
                        NilaiTransaksi1 := f.CurrencyFormatStr(float64(params.NilaiTransaksi), "D", 2, "Rp")
                        SaldoMinimum1 := f.CurrencyFormatStr(float64(SaldoMinimum), "D", 2, "Rp")

                        if (SaldoEfektif &lt; NilaiTransaksi) &amp;&amp; (NilaiTransaksi &lt;= (SaldoEfektif + SaldoMinimum)) </span><span class="cov0" title="0">{
                                OverrideStatusRekening := data.OverrideValidationData{
                                        KodeValidasi:       "04",
                                        KeteranganValidasi: fmt.Sprintf("Nilai transaksi %v melebihi saldo minimum %v rekening %v", NilaiTransaksi1, SaldoMinimum1, params.NomorRekeningKredit),
                                }
                                result = append(result, OverrideStatusRekening)
                        }</span>
                }
        }

        // 05a : Melebihi batas maksimum debet rekening per hari
        <span class="cov1" title="1">if utils.Contains([]interface{}{"TT", "PB", "SKN", "RTGS"}, params.KodeTransaksi) &amp;&amp; params.IsTm != "T" </span><span class="cov1" title="1">{
                // validasi field wajib (NilaiTransaksi)
                // if params.NilaiTransaksi == 0 {
                //         remark := "field nilai_transaksi harus diisi"
                //         f.log.Warn(logrus.Fields{
                //                 "nilai_transaksi": params.NilaiTransaksi,
                //         }, nil, "field mandatori")
                //         f.Store().Rollback(tx)

                //         err = fmt.Errorf(remark)
                //         return
                // }

                // validasi field wajib (NomorRekeningDebet)
                if params.NomorRekeningDebet == "" </span><span class="cov0" title="0">{
                        remark := "field nomor_rekening_debet harus diisi"
                        f.log.Warn(logrus.Fields{
                                "nomor_rekening_debet": params.NomorRekeningDebet,
                        }, nil, "field mandatori")
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                <span class="cov1" title="1">var AccountLiabilitasDb datastore.RekeningLiabDetail
                AccountLiabilitasDb, err = f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningDebet)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "result": fmt.Sprintf("%+v", AccountLiabilitasDb),
                                "error":  err,
                                "params": params.NomorRekeningDebet,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                <span class="cov1" title="1">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := fmt.Sprintf("Nomor rekening %v tidak terdaftar sebagai rekeningliabilitas", params.NomorRekeningDebet)
                        f.log.Warn(logrus.Fields{
                                "result": fmt.Sprintf("%+v", AccountLiabilitasDb),
                                "error":  err,
                                "params": params.NomorRekeningDebet,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                <span class="cov1" title="1">MaxDbHarian := datastore.MaxDbHarian{
                        NomorRekening: params.NomorRekeningDebet,
                }
                var DsMaxDbHarian datastore.DsMaxDbHarian
                DsMaxDbHarian, err = f.Store().GetMaxDbHarian(appCtx, tx, MaxDbHarian)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "result": fmt.Sprintf("%+v", DsMaxDbHarian),
                                "error":  err,
                                "params": MaxDbHarian,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                <span class="cov1" title="1">if DsMaxDbHarian.TotalLimit.Int64 &gt; 0 </span><span class="cov0" title="0">{
                        LimitDbHarian := datastore.LimitDbHarian{
                                NomorRekening: params.NomorRekeningDebet,
                        }
                        var DsLimitDbHarian datastore.DsLimitDbHarian
                        DsLimitDbHarian, err = f.Store().GetLimitDebetHarian(appCtx, tx, LimitDbHarian)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", DsLimitDbHarian),
                                        "error":  err,
                                        "params": LimitDbHarian,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">Limit := DsLimitDbHarian.TotalNilaiTransaksi.Float64

                        CounterDbHarian := datastore.CounterDbHarian{
                                NomorRekening: params.NomorRekeningDebet,
                        }
                        var DsCounterDbHarian datastore.DsCounterDbHarian
                        DsCounterDbHarian, err = f.Store().GetCounterDebetHarian(appCtx, tx, CounterDbHarian)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "result": fmt.Sprintf("%+v", DsCounterDbHarian),
                                        "error":  err,
                                        "params": CounterDbHarian,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())
                                return
                        }</span>

                        <span class="cov0" title="0">counter := DsCounterDbHarian.TotalNilaiTransaksi.Float64
                        NilaiTransaksi := params.NilaiTransaksi

                        if Limit &lt; (counter + NilaiTransaksi) </span><span class="cov0" title="0">{
                                OverrideStatusRekening := data.OverrideValidationData{
                                        KodeValidasi:       "05a",
                                        KeteranganValidasi: "Transaksi melebihi batas maksimum debet rekening per hari",
                                }
                                result = append(result, OverrideStatusRekening)
                        }</span>
                }
        }

        <span class="cov1" title="1">f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}
</pre>
		
		<pre class="file" id="file6" style="display: none">package app

import (
        "context"
        "database/sql"
        "fmt"
        "fundtx/datastore"

        "go.opentelemetry.io/otel/attribute"
        otel_code "go.opentelemetry.io/otel/codes"

        "github.com/sirupsen/logrus"
)

func (f *service) GetRcCodeList(ctx context.Context) (respApp []datastore.ResGetRcCodeList, err error) <span class="cov10" title="3">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GetRcCodeList %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()

        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                err = fmt.Errorf(remark)

                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov6" title="2">defer f.PanicHandler(tx, &amp;err)

        respApp, err = f.Store().GetRcCodeList(appCtx, tx)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "respApp": respApp,
                        "error":   err,
                }, nil, err.Error())
                err = fmt.Errorf(remark)

                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov1" title="1">f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")
        return</span>
}
</pre>
		
		<pre class="file" id="file7" style="display: none">package app

import (
        "context"
        "database/sql"
        "fmt"
        "fundtx/data"
        "fundtx/datastore"
        "fundtx/pkg/errors"
        "fundtx/pkg/logging/utils"
        "strconv"
        "strings"

        "github.com/sirupsen/logrus"
        "go.opentelemetry.io/otel/attribute"
        otel_code "go.opentelemetry.io/otel/codes"
)

func (f *service) PostTrxRevByUidkey(ctx context.Context, params data.PostTrxRevByUidkeyServiceRequest) (response data.PostTrxRevByUidkeyResp, err error) <span class="cov10" title="62">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("PostTrxRevByUidkey %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        params.UserInput = strings.ToUpper(params.UserInput)

        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                err = fmt.Errorf(remark)

                response.RespCode = "02"
                response.RespMsg = remark

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov9" title="61">defer f.PanicHandler(tx, &amp;err)

        if params.Uidkey == "" </span><span class="cov1" title="1">{
                remark := "uidkey harus diisi"
                f.log.Warn(logrus.Fields{"params.Uidkey": params.Uidkey}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                response.RespCode = "02"
                response.RespMsg = remark
                return
        }</span>

        <span class="cov9" title="60">if params.UidkeyRev == "" </span><span class="cov1" title="1">{
                remark := "uidkey_rev harus diisi"
                f.log.Warn(logrus.Fields{"params.UidkeyRev": params.UidkeyRev}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                response.RespCode = "02"
                response.RespMsg = remark
                return
        }</span>

        <span class="cov9" title="59">if params.ActionTypeRev == "" </span><span class="cov1" title="1">{
                remark := "action_type_rev harus diisi"
                f.log.Warn(logrus.Fields{"params.ActionTypeRev": params.ActionTypeRev}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                response.RespCode = "02"
                response.RespMsg = remark
                return
        }</span>

        <span class="cov9" title="58">if params.TrxTypeRev == "" </span><span class="cov1" title="1">{
                remark := "trx_type_rev harus diisi"
                f.log.Warn(logrus.Fields{"params.TrxTypeRev": params.TrxTypeRev}, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                response.RespCode = "02"
                response.RespMsg = remark
                return
        }</span>

        /*
                cek TrxTypeRev :
                - jika FUNDTM / TMFUND / CASHTM, uidkey diberikan prefix "FUND-". Tujuannya agar insert ke table infouid di service funding dan tm bisa masuk
        */
        <span class="cov9" title="57">if utils.Contains([]interface{}{"TMFUND", "FUNDTM", "CASHTM"}, params.TrxTypeRev) </span><span class="cov8" title="33">{
                params.Uidkey = "FUND-" + params.Uidkey
        }</span>

        <span class="cov9" title="57">uidkeycek := datastore.ReqGetInfoUid{
                Uidkey:        params.Uidkey,
                ActionTypeCek: "POST_TRX_REV_BY_UIDKEY",
        }
        resUID, err := f.Store().GetInfoUid(appCtx, tx, uidkeycek)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "resUID": resUID,
                        "error":  err,
                        "params": uidkeycek,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                response.RespCode = "02"
                response.RespMsg = remark
                return
        }</span>

        <span class="cov9" title="56">var infoUid datastore.InfoUid
        if resUID != infoUid </span><span class="cov1" title="1">{
                remark := "Transaksi reversal sudah diproses"
                f.log.Warn(logrus.Fields{"resUID": resUID}, nil, remark)
                err = fmt.Errorf(remark)

                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                response.RespCode = "00"
                response.RespMsg = remark
                response.IdTransaksi = resUID.Keyint.Int64
                return
        }</span>

        <span class="cov9" title="55">if err == sql.ErrNoRows </span><span class="cov9" title="55">{
                err = nil
        }</span>

        /*
                - jika TrxTypeRev == FUND. contohnya transaksi skn rtgs non tunai.
                        - ambil id_transaksi di table infouid. uidkey yang dicari tidak perlu ditambahkan apapun
                        - lakukan reversal transaksi by id_transaksi
                - jika TrxTypeRev == CASHFUND. contohnya transaksi setor tunai.
                        1.         - ambil id_transaksi di table infouid. uidkey yang dicari pakai kombinasi CASH- + uidkey
                                - lakukan reversal transaksi by id_transaksi
                        2.         - ambil id_transaksi di table infouid. uidkey yang dicari pakai kombinasi FUND- + uidkey
                                - lakukan reversal transaksi by id_transaksi
                - jika TrxTypeRev == CASHTM. contohnya transaksi setor tunai.
                        - ambil id_transaksi di table infouid. uidkey yang dicari pakai kombinasi CASH- + uidkey
                        - lakukan reversal transaksi by id_transaksi
                - jika TrxTypeRev == FUNDTM. contohnya transaksi setor tunai.
                        - ambil id_transaksi di table infouid. uidkey yang dicari pakai kombinasi FUND- + uidkey
                        - lakukan reversal transaksi by id_transaksi
                - jika TrxTypeRev == TMFUND. contohnya transaksi setor tunai.
                        - ambil id_transaksi di table infouid. uidkey yang dicari pakai kombinasi FUND- + uidkey
                        - lakukan reversal transaksi by id_transaksi
        */

        // lakukan reversal trx cash
        <span class="cov9" title="55">var RespRevTrx1 data.RespAutoRevTrx
        if utils.Contains([]interface{}{"CASHFUND", "CASHTM"}, params.TrxTypeRev) </span><span class="cov8" title="27">{
                uidkeyRevCek := datastore.ReqGetInfoUid{
                        Uidkey:        fmt.Sprintf("CASH-%v", params.UidkeyRev),
                        ActionTypeCek: params.ActionTypeRev,
                }
                resUIDRev := datastore.InfoUid{}
                resUIDRev, err = f.Store().GetInfoUidForRev(appCtx, tx, uidkeyRevCek)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "result": resUIDRev,
                                "error":  err,
                                "params": uidkeyRevCek,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return response, err
                }</span>

                <span class="cov8" title="26">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := fmt.Sprintf("uidkey_rev %v action_type_rev %v tidak ditemukan", params.UidkeyRev, params.ActionTypeRev)
                        f.log.Warn(logrus.Fields{"resUIDRev": resUIDRev}, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov8" title="25">IdTransaksiRev := resUIDRev.Keyint.Int64
                if IdTransaksiRev == 0 </span><span class="cov2" title="2">{
                        remark := fmt.Sprintf("id_transaksi untuk uidkey_rev %v action_type_rev %v tidak ditemukan", params.UidkeyRev, params.ActionTypeRev)
                        f.log.Warn(logrus.Fields{"resUIDRev": resUIDRev, "Keyint": IdTransaksiRev}, nil, remark)
                        f.Store().Rollback(tx)

                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="23">var TrxByIdTrx datastore.Transaksi
                TrxByIdTrx, err = f.Store().GetTrxByIdTrx(appCtx, tx, IdTransaksiRev)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "TrxByIdTrx": TrxByIdTrx,
                                "error":      err,
                                "params":     IdTransaksiRev,
                        }, nil, err.Error())
                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="22">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := fmt.Sprintf("id_transaksi %v tidak terdaftar di data transaksi", IdTransaksiRev)
                        f.log.Warn(logrus.Fields{
                                "TrxByIdTrx": TrxByIdTrx,
                                "error":      err,
                                "params":     IdTransaksiRev,
                        }, nil, remark)
                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="21">if TrxByIdTrx.IsReversed.String == "T" </span><span class="cov3" title="3">{
                        var ReverseTransaction datastore.ReverseTransactionView
                        ReverseTransaction, err = f.Store().GetRevTrxByIdTrx(appCtx, tx, IdTransaksiRev)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "ReverseTransaction": ReverseTransaction,
                                        "error":              err,
                                        "params":             IdTransaksiRev,
                                }, nil, err.Error())

                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov2" title="2">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("id_transaksi %v tidak terdaftar di data reversetransaction", IdTransaksiRev)
                                f.log.Warn(logrus.Fields{
                                        "TrxByIdTrx": TrxByIdTrx,
                                        "error":      err,
                                        "params":     IdTransaksiRev,
                                }, nil, remark)
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">remark := "Transaksi Sudah Pernah Direversal"
                        err = fmt.Errorf(remark)

                        f.log.Warn(logrus.Fields{
                                "IsReversed":     TrxByIdTrx.IsReversed.String,
                                "IdTransaksiRev": IdTransaksiRev,
                        }, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        response.IdTransaksi = ReverseTransaction.ReverseId.Int64

                        return</span>
                }

                <span class="cov7" title="18">if TrxByIdTrx.IsReverseAllowed.String == "F" </span><span class="cov1" title="1">{
                        remark := fmt.Sprintf("id_transaksi %v tidak boleh direversal", IdTransaksiRev)
                        f.log.Warn(logrus.Fields{
                                "TrxByIdTrx":       TrxByIdTrx,
                                "error":            err,
                                "IsReverseAllowed": TrxByIdTrx.IsReverseAllowed.String,
                        }, nil, remark)
                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="17">var GetTrxDetail []datastore.GetDetailTrxRes
                GetDetailTrxReq := datastore.GetDetailTrxReq{
                        IdTransaksi: IdTransaksiRev,
                }
                GetTrxDetail, err = f.Store().GetTrxDetailRev(appCtx, tx, GetDetailTrxReq)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "GetTrxDetail": GetTrxDetail,
                                "error":        err,
                                "params":       GetDetailTrxReq,
                        }, nil, err.Error())

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="16">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := fmt.Sprintf("id_transaksi %v tidak terdaftar di data detiltransaksi", IdTransaksiRev)
                        f.log.Warn(logrus.Fields{
                                "GetTrxDetail": GetTrxDetail,
                                "error":        err,
                                "params":       GetDetailTrxReq,
                        }, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov6" title="15">DataTrx := data.DataTrx{
                        IdTransaksi:         IdTransaksiRev,
                        NomorReferensi:      fmt.Sprintf("%s_rev", TrxByIdTrx.NomorReferensi.String),
                        Keterangan:          fmt.Sprintf("Reversal %s", TrxByIdTrx.Keterangan.String),
                        JenisAplikasi:       TrxByIdTrx.JenisAplikasi.String,
                        KodeValutaTransaksi: TrxByIdTrx.KodeValutaTransaksi.String,
                        KursManual:          TrxByIdTrx.KursManual.Float64,
                        NilaiTransaksi:      TrxByIdTrx.NilaiTransaksi.Float64,
                        KodeCabangTransaksi: TrxByIdTrx.KodeCabangTransaksi.String,
                        IsSudahDijurnal:     "F",
                        KodeTransaksi:       "REV",
                        UserInput:           params.UserInput,
                        UserOtorisasi:       params.UserOtorisasi,
                        Biaya:               TrxByIdTrx.Biaya.Float64,
                        IsReverseAllowed:    "F",
                }

                ListDetilTrx := []datastore.DetilTrx{}
                for _, dt := range GetTrxDetail </span><span class="cov0" title="0">{
                        DetilTrxDb := datastore.DetilTrx{
                                JenisDetilTransaksi: dt.JenisDetilTransaksi.String,
                                NomorRekening:       dt.NomorRekening.String,
                                JenisMutasi:         map[string]string{"D": "C", "C": "D"}[dt.JenisMutasi.String],
                                NilaiMutasi:         dt.NilaiMutasi.Float64,
                                KodeCabang:          dt.KodeCabang.String,
                                Keterangan:          fmt.Sprintf("Reversal %s", dt.Keterangan.String),
                                NilaiKursManual:     dt.NilaiKursManual.Float64,
                                NilaiEkuivalen:      dt.NilaiEkuivalen.Float64,
                                NomorReferensi:      fmt.Sprintf("%s_rev", dt.NomorReferensi.String),
                                FlagProses:          "F",
                                KodeJurnal:          dt.KodeJurnal.String,
                                KodeValutaRak:       dt.KodeValutaRak.String,
                        }
                        ListDetilTrx = append(ListDetilTrx, DetilTrxDb)
                }</span>

                <span class="cov6" title="15">PostTrx := data.PostTrx{
                        DataTrx:  DataTrx,
                        DetilTrx: ListDetilTrx,
                }
                RespRevTrx1, err = f.Utils().GenericTrxRev(appCtx, tx, PostTrx)
                if (err != nil &amp;&amp; err != sql.ErrNoRows) || RespRevTrx1.Status == "02" </span><span class="cov1" title="1">{
                        remark := RespRevTrx1.Msg
                        f.log.Error(logrus.Fields{
                                "err":            err,
                                "RespAutoRevTrx": RespRevTrx1,
                                "Status":         RespRevTrx1.Status,
                                "Msg":            RespRevTrx1.Msg,
                        }, nil, remark)

                        err = fmt.Errorf(remark)

                        //f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        return
                }</span>

                <span class="cov6" title="14">InfoTransaksiDetail := datastore.InfoTransaksiDetail{}
                InfoTransaksiDetail, err = f.Store().GetInfotransaksi(appCtx, tx, IdTransaksiRev)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "InfoTransaksiDetail": InfoTransaksiDetail,
                                "error":               err,
                                "params":              IdTransaksiRev,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov6" title="13">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                        err = nil
                }</span>

                <span class="cov6" title="13">idTransaksi := RespRevTrx1.Data.IdTransaksiCashRev

                if (InfoTransaksiDetail != datastore.InfoTransaksiDetail{}) </span><span class="cov6" title="13">{
                        infoTransaksi := datastore.InsertInfoTransaksi{
                                IdTransaksi:            idTransaksi,
                                NomorRekeningDebet:     InfoTransaksiDetail.NomorRekeningKredit.String,
                                NamaRekeningDebet:      InfoTransaksiDetail.NamaRekeningKredit.String,
                                NomorRekeningKredit:    InfoTransaksiDetail.NomorRekeningDebet.String,
                                NamaRekeningKredit:     InfoTransaksiDetail.NamaRekeningDebet.String,
                                IsTunai:                InfoTransaksiDetail.IsTunai.String,
                                NominalTransaksi:       float64(InfoTransaksiDetail.NominalTransaksi.Float64),
                                NominalBiaya:           float64(InfoTransaksiDetail.NominalBiaya.Float64),
                                AccountBiaya:           InfoTransaksiDetail.AccountBiaya.String,
                                NomorRekeningTransaksi: InfoTransaksiDetail.NomorRekeningPair.String,
                                NamaRekeningTransaksi:  InfoTransaksiDetail.NamaRekeningPair.String,
                                NomorRekeningPair:      InfoTransaksiDetail.NomorRekeningTransaksi.String,
                                NamaRekeningPair:       InfoTransaksiDetail.NamaRekeningTransaksi.String,
                                SumberBiaya:            InfoTransaksiDetail.SumberBiaya.String,
                                JenisMutasiTransaksi:   map[string]string{"D": "K", "K": "D"}[InfoTransaksiDetail.JenisMutasiTransaksi.String],
                                JenisMutasiPair:        map[string]string{"D": "K", "K": "D"}[InfoTransaksiDetail.JenisMutasiPair.String],
                                NominalTunaiFisik:      InfoTransaksiDetail.NominalTunaiFisik.Float64,
                                IsTunaiFisik:           InfoTransaksiDetail.IsTunaiFisik.String,
                        }

                        err = f.Store().InsertInfoTransaksi(appCtx, tx, infoTransaksi)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error":  err,
                                        "params": infoTransaksi,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>
                }
                <span class="cov6" title="12">if TrxByIdTrx.KodeTransaksi.String == "AKK" </span><span class="cov4" title="5">{
                        var DetailDtk1 []datastore.GetDetailTrxRes
                        DetailDtk1, err = f.Store().GetTrxDetailDtk(appCtx, tx, idTransaksi, "D")
                        if err != nil </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("id_transaksi %v tidak terdaftar di detiltransaksi", idTransaksi)
                                f.log.Error(logrus.Fields{
                                        "result":       DetailDtk1,
                                        "error":        err,
                                        "id_transaksi": idTransaksi,
                                        "jenis_mutasi": "C",
                                }, nil, err.Error())
                                f.Store().Rollback(tx)

                                err = fmt.Errorf(remark)
                                if err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                        err = errors.SystemError.Database
                                }</span>

                                <span class="cov1" title="1">appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return</span>
                        }

                        <span class="cov4" title="4">var DetailDtk []datastore.GetDetailTrxRes
                        DetailDtk, err = f.Store().GetTrxDetailDtk(appCtx, tx, IdTransaksiRev, "C")
                        if err != nil </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("id_transaksi %v tidak terdaftar di detiltransaksi", IdTransaksiRev)
                                f.log.Error(logrus.Fields{
                                        "result":       DetailDtk,
                                        "error":        err,
                                        "id_transaksi": IdTransaksiRev,
                                        "jenis_mutasi": "C",
                                }, nil, err.Error())
                                f.Store().Rollback(tx)

                                err = fmt.Errorf(remark)
                                if err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                        err = errors.SystemError.Database
                                }</span>

                                <span class="cov1" title="1">appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return</span>
                        }

                        <span class="cov3" title="3">var DenomDetailList []datastore.DenominasitransaksikasDetail
                        DenomDetailList, err = f.Store().GetDenominasitransaksikas(appCtx, tx, DetailDtk[0].IdDetilTransaksi.Int64)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("id_detil_transaksi %v tidak terdaftar di denominasitransaksikas", DetailDtk[0].IdDetilTransaksi.Int64)
                                f.log.Error(logrus.Fields{
                                        "result":             DenomDetailList,
                                        "error":              err,
                                        "id_detil_transaksi": DetailDtk[0].IdDetilTransaksi.Int64,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)

                                err = fmt.Errorf(remark)
                                if err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                        err = errors.SystemError.Database
                                }</span>

                                <span class="cov1" title="1">appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return</span>
                        }

                        <span class="cov2" title="2">for _, denomData := range DenomDetailList </span><span class="cov2" title="2">{
                                f.log.Info(logrus.Fields{}, denomData, "Do Update List Denominasi")
                                UpdateDenominasiRekening := datastore.UpdateDenominasiRekening{
                                        JenisMutasi:        "C",
                                        IdDenominasiValuta: denomData.IdDenominasiValuta.Int64,
                                        NomorRekening:      DetailDtk[0].NomorRekening.String,
                                        JumlahDenominasi:   int64(denomData.JumlahDenominasi.Int64),
                                }

                                err = f.Store().UpdateDenominasiRekening(appCtx, tx, UpdateDenominasiRekening)
                                if err != nil </span><span class="cov1" title="1">{
                                        f.log.Error(logrus.Fields{
                                                "error":  err,
                                                "params": UpdateDenominasiRekening,
                                        }, nil, err.Error())
                                        err = errors.SystemError.Database
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        f.Store().Rollback(tx)
                                        response.RespCode = "02"
                                        response.RespMsg = err.Error()
                                        return
                                }</span>

                                <span class="cov1" title="1">InsertDenominasitransaksikas := datastore.InsertDenominasitransaksikas{
                                        IdDenominasiValuta:  denomData.IdDenominasiValuta.Int64,
                                        IdDetilTransaksi:    DetailDtk1[0].IdDetilTransaksi.Int64,
                                        JumlahDenominasi:    int64(denomData.JumlahDenominasi.Int64),
                                        JumlahDenominasiTle: denomData.JumlahDenominasiTle.Int64,
                                }
                                err = f.Store().InsertDenominasitransaksikas(appCtx, tx, InsertDenominasitransaksikas)
                                if err != nil </span><span class="cov1" title="1">{
                                        f.log.Error(logrus.Fields{
                                                "error":  err,
                                                "params": InsertDenominasitransaksikas,
                                        }, nil, err.Error())
                                        err = errors.SystemError.Database
                                        f.Store().Rollback(tx)
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        response.RespCode = "02"
                                        response.RespMsg = err.Error()
                                        fmt.Println(response)
                                        return
                                }</span>

                        }
                }

                <span class="cov5" title="7">if TrxByIdTrx.KodeTransaksi.String == "SKK" </span><span class="cov5" title="7">{
                        var DetailDtk1 []datastore.GetDetailTrxRes
                        DetailDtk1, err = f.Store().GetTrxDetailDtk(appCtx, tx, idTransaksi, "C")
                        if err != nil </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("id_transaksi %v tidak terdaftar di detiltransaksi", idTransaksi)
                                f.log.Error(logrus.Fields{
                                        "result":       DetailDtk1,
                                        "error":        err,
                                        "id_transaksi": idTransaksi,
                                        "jenis_mutasi": "C",
                                }, nil, err.Error())
                                f.Store().Rollback(tx)

                                err = fmt.Errorf(remark)
                                if err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                        err = errors.SystemError.Database
                                }</span>

                                <span class="cov1" title="1">appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return</span>
                        }

                        <span class="cov4" title="6">var DetailDtk []datastore.GetDetailTrxRes
                        DetailDtk, err = f.Store().GetTrxDetailDtk(appCtx, tx, IdTransaksiRev, "D")
                        if err != nil </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("id_transaksi %v tidak terdaftar di detiltransaksi", IdTransaksiRev)
                                f.log.Error(logrus.Fields{
                                        "result":       DetailDtk,
                                        "error":        err,
                                        "id_transaksi": IdTransaksiRev,
                                        "jenis_mutasi": "D",
                                }, nil, err.Error())
                                f.Store().Rollback(tx)

                                err = fmt.Errorf(remark)
                                if err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                        err = errors.SystemError.Database
                                }</span>

                                <span class="cov1" title="1">appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return</span>
                        }

                        <span class="cov4" title="5">var DenomDetailList []datastore.DenominasitransaksikasDetail
                        DenomDetailList, err = f.Store().GetDenominasitransaksikas(appCtx, tx, DetailDtk[0].IdDetilTransaksi.Int64)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("id_detil_transaksi %v tidak terdaftar di denominasitransaksikas", DetailDtk[0].IdDetilTransaksi.Int64)
                                f.log.Error(logrus.Fields{
                                        "result":             DenomDetailList,
                                        "error":              err,
                                        "id_detil_transaksi": DetailDtk[0].IdDetilTransaksi.Int64,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)

                                err = fmt.Errorf(remark)
                                if err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                        err = errors.SystemError.Database
                                }</span>

                                <span class="cov1" title="1">appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return</span>
                        }

                        <span class="cov4" title="4">for _, denomData := range DenomDetailList </span><span class="cov4" title="4">{
                                f.log.Info(logrus.Fields{}, denomData, "Do Update List Denominasi")
                                detilDenomReq := datastore.GetDetilDenominasiRekening{
                                        IdDenominasiValuta: denomData.IdDenominasiValuta.Int64,
                                        NomorRekening:      DetailDtk[0].NomorRekening.String,
                                }
                                var DetilDenom datastore.DenominasiKas
                                DetilDenom, err = f.Store().GetDetilDenominasiKas(appCtx, tx, detilDenomReq)
                                if err != nil </span><span class="cov1" title="1">{
                                        f.log.Error(logrus.Fields{
                                                "error":  err,
                                                "params": detilDenomReq,
                                        }, nil, err.Error())
                                        err = errors.SystemError.Database
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        f.Store().Rollback(tx)

                                        response.RespCode = "02"
                                        response.RespMsg = err.Error()
                                        return
                                }</span>

                                <span class="cov3" title="3">NilaiDenominasiFC := f.CurrencyFormatStr(DetilDenom.NilaiDenominasi, "D", 2, "Rp")
                                if int64(denomData.JumlahDenominasi.Int64) &gt; DetilDenom.JumlahDenominasi </span><span class="cov1" title="1">{
                                        remark := fmt.Sprintf("Jumlah Denominasi %v tidak cukup, jumlah saat ini %d", NilaiDenominasiFC, DetilDenom.JumlahDenominasi)
                                        err = fmt.Errorf(remark)
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        f.Store().Rollback(tx)

                                        response.RespCode = "02"
                                        response.RespMsg = err.Error()
                                        return
                                }</span>

                                <span class="cov2" title="2">UpdateDenominasiRekening := datastore.UpdateDenominasiRekening{
                                        JenisMutasi:        "D",
                                        IdDenominasiValuta: denomData.IdDenominasiValuta.Int64,
                                        NomorRekening:      DetailDtk[0].NomorRekening.String,
                                        JumlahDenominasi:   int64(denomData.JumlahDenominasi.Int64),
                                }

                                err = f.Store().UpdateDenominasiRekening(appCtx, tx, UpdateDenominasiRekening)
                                if err != nil </span><span class="cov1" title="1">{
                                        f.log.Error(logrus.Fields{
                                                "error":  err,
                                                "params": UpdateDenominasiRekening,
                                        }, nil, err.Error())
                                        err = errors.SystemError.Database
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        f.Store().Rollback(tx)

                                        response.RespCode = "02"
                                        response.RespMsg = err.Error()
                                        return
                                }</span>

                                <span class="cov1" title="1">InsertDenominasitransaksikas := datastore.InsertDenominasitransaksikas{
                                        IdDenominasiValuta:  denomData.IdDenominasiValuta.Int64,
                                        IdDetilTransaksi:    DetailDtk1[0].IdDetilTransaksi.Int64,
                                        JumlahDenominasi:    int64(denomData.JumlahDenominasi.Int64),
                                        JumlahDenominasiTle: denomData.JumlahDenominasiTle.Int64,
                                }
                                err = f.Store().InsertDenominasitransaksikas(appCtx, tx, InsertDenominasitransaksikas)
                                if err != nil </span><span class="cov1" title="1">{
                                        f.log.Error(logrus.Fields{
                                                "error":  err,
                                                "params": InsertDenominasitransaksikas,
                                        }, nil, err.Error())
                                        err = errors.SystemError.Database
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        f.Store().Rollback(tx)

                                        response.RespCode = "02"
                                        response.RespMsg = err.Error()
                                        return
                                }</span>

                        }
                }
        }

        <span class="cov8" title="28">var UidkeyRev string
        if params.TrxTypeRev == "FUND" </span><span class="cov7" title="23">{
                UidkeyRev = params.UidkeyRev
        }</span>

        <span class="cov8" title="28">if utils.Contains([]interface{}{"TMFUND", "FUNDTM", "CASHFUND"}, params.TrxTypeRev) </span><span class="cov4" title="5">{
                UidkeyRev = fmt.Sprintf("FUND-%v", params.UidkeyRev)
        }</span>

        // lakukan reversal trx fund
        <span class="cov8" title="28">var RespRevTrx2 data.RespAutoRevTrx
        if utils.Contains([]interface{}{"TMFUND", "FUNDTM", "CASHFUND", "FUND"}, params.TrxTypeRev) </span><span class="cov8" title="28">{
                uidkeyRevCek := datastore.ReqGetInfoUid{
                        Uidkey:        UidkeyRev,
                        ActionTypeCek: params.ActionTypeRev,
                }
                resUIDRev := datastore.InfoUid{}
                resUIDRev, err = f.Store().GetInfoUidForRev(appCtx, tx, uidkeyRevCek)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov2" title="2">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "result": resUIDRev,
                                "error":  err,
                                "params": uidkeyRevCek,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov8" title="26">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := fmt.Sprintf("uidkey_rev %v action_type_rev %v tidak ditemukan", params.UidkeyRev, params.ActionTypeRev)
                        f.log.Warn(logrus.Fields{"resUIDRev": resUIDRev}, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov8" title="25">IdTransaksiRev := resUIDRev.Keyint.Int64
                if IdTransaksiRev == 0 </span><span class="cov0" title="0">{
                        remark := fmt.Sprintf("id_transaksi untuk uidkey_rev %v action_type_rev %v tidak ditemukan", params.UidkeyRev, params.ActionTypeRev)
                        f.log.Warn(logrus.Fields{"resUIDRev": resUIDRev, "Keyint": IdTransaksiRev}, nil, remark)

                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov8" title="25">var TrxByIdTrx datastore.Transaksi
                TrxByIdTrx, err = f.Store().GetTrxByIdTrx(appCtx, tx, IdTransaksiRev)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "TrxByIdTrx": TrxByIdTrx,
                                "error":      err,
                                "params":     IdTransaksiRev,
                        }, nil, err.Error())

                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="24">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := fmt.Sprintf("id_transaksi %v tidak terdaftar di data transaksi", IdTransaksiRev)
                        f.log.Warn(logrus.Fields{
                                "TrxByIdTrx": TrxByIdTrx,
                                "error":      err,
                                "params":     IdTransaksiRev,
                        }, nil, remark)
                        f.Store().Rollback(tx)

                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="24">if TrxByIdTrx.IsReversed.String == "T" </span><span class="cov1" title="1">{
                        var ReverseTransaction datastore.ReverseTransactionView
                        ReverseTransaction, err = f.Store().GetRevTrxByIdTrx(appCtx, tx, IdTransaksiRev)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "ReverseTransaction": ReverseTransaction,
                                        "error":              err,
                                        "params":             IdTransaksiRev,
                                }, nil, err.Error())

                                err = fmt.Errorf(remark)

                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := fmt.Sprintf("id_transaksi %v tidak terdaftar di data reversetransaction", IdTransaksiRev)
                                f.log.Warn(logrus.Fields{
                                        "TrxByIdTrx": TrxByIdTrx,
                                        "error":      err,
                                        "params":     IdTransaksiRev,
                                }, nil, remark)
                                err = fmt.Errorf(remark)

                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">remark := "Transaksi Sudah Pernah Direversal"
                        f.log.Warn(logrus.Fields{
                                "IsReversed":     TrxByIdTrx.IsReversed.String,
                                "IdTransaksiRev": IdTransaksiRev,
                        }, nil, remark)
                        f.Store().Rollback(tx)

                        err = fmt.Errorf(remark)

                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        response.IdTransaksi = ReverseTransaction.ReverseId.Int64

                        return</span>
                }

                <span class="cov7" title="23">if TrxByIdTrx.IsReverseAllowed.String == "F" </span><span class="cov1" title="1">{
                        remark := fmt.Sprintf("id_transaksi %v tidak boleh direversal", IdTransaksiRev)
                        f.log.Warn(logrus.Fields{
                                "TrxByIdTrx":       TrxByIdTrx,
                                "error":            err,
                                "IsReverseAllowed": TrxByIdTrx.IsReverseAllowed.String,
                        }, nil, remark)
                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="22">GetDetailTrxReq := datastore.GetDetailTrxReq{
                        IdTransaksi: IdTransaksiRev,
                }
                var GetTrxDetail []datastore.GetDetailTrxRes
                GetTrxDetail, err = f.Store().GetTrxDetailRev(appCtx, tx, GetDetailTrxReq)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "GetTrxDetail": GetTrxDetail,
                                "error":        err,
                                "params":       GetDetailTrxReq,
                        }, nil, err.Error())
                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="21">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := fmt.Sprintf("id_transaksi %v tidak terdaftar di data detiltransaksi", IdTransaksiRev)
                        f.log.Warn(logrus.Fields{
                                "GetTrxDetail": GetTrxDetail,
                                "error":        err,
                                "params":       GetDetailTrxReq,
                        }, nil, remark)
                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="20">DataTrx := data.DataTrx{
                        IdTransaksi:         IdTransaksiRev,
                        NomorReferensi:      fmt.Sprintf("%s_rev", TrxByIdTrx.NomorReferensi.String),
                        Keterangan:          fmt.Sprintf("Reversal %s", TrxByIdTrx.Keterangan.String),
                        JenisAplikasi:       TrxByIdTrx.JenisAplikasi.String,
                        KodeValutaTransaksi: TrxByIdTrx.KodeValutaTransaksi.String,
                        KursManual:          TrxByIdTrx.KursManual.Float64,
                        NilaiTransaksi:      TrxByIdTrx.NilaiTransaksi.Float64,
                        KodeCabangTransaksi: TrxByIdTrx.KodeCabangTransaksi.String,
                        IsSudahDijurnal:     "F",
                        KodeTransaksi:       "REV",
                        UserInput:           params.UserInput,
                        UserOtorisasi:       params.UserOtorisasi,
                        Biaya:               TrxByIdTrx.Biaya.Float64,
                        IsReverseAllowed:    "F",
                        IsBolehStatusTutup:  true,
                }

                ListDetilTrx := []datastore.DetilTrx{}
                var ListNomorSeriWarkat []string
                for _, dt := range GetTrxDetail </span><span class="cov7" title="20">{
                        DetilTrxDb := datastore.DetilTrx{
                                JenisDetilTransaksi: dt.JenisDetilTransaksi.String,
                                NomorRekening:       dt.NomorRekening.String,
                                JenisMutasi:         map[string]string{"D": "C", "C": "D"}[dt.JenisMutasi.String],
                                NilaiMutasi:         dt.NilaiMutasi.Float64,
                                KodeCabang:          dt.KodeCabang.String,
                                Keterangan:          fmt.Sprintf("Reversal %s", dt.Keterangan.String),
                                NilaiKursManual:     dt.NilaiKursManual.Float64,
                                NilaiEkuivalen:      dt.NilaiEkuivalen.Float64,
                                NomorReferensi:      fmt.Sprintf("%s_rev", dt.NomorReferensi.String),
                                FlagProses:          "F",
                                KodeJurnal:          dt.KodeJurnal.String,
                                KodeValutaRak:       dt.KodeValutaRak.String,
                                FlagCode:            dt.FlagCode.String,
                        }
                        ListDetilTrx = append(ListDetilTrx, DetilTrxDb)

                        if dt.NomorSeriWarkat.String != "" </span><span class="cov5" title="7">{
                                ListNomorSeriWarkat = append(ListNomorSeriWarkat, dt.NomorSeriWarkat.String)
                        }</span>
                }

                <span class="cov7" title="20">PostTrx := data.PostTrx{
                        DataTrx:  DataTrx,
                        DetilTrx: ListDetilTrx,
                }
                RespRevTrx2, err = f.Utils().GenericTrxRev(appCtx, tx, PostTrx)
                if (err != nil &amp;&amp; err != sql.ErrNoRows) || RespRevTrx2.Status == "02" </span><span class="cov1" title="1">{
                        remark := RespRevTrx2.Msg
                        f.log.Error(logrus.Fields{
                                "err":    err,
                                "result": fmt.Sprintf("%+v", RespRevTrx2),
                                "Status": RespRevTrx2.Status,
                                "Msg":    RespRevTrx2.Msg,
                        }, nil, remark)
                        //f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="19">InfoTransaksiDetail := datastore.InfoTransaksiDetail{}
                InfoTransaksiDetail, err = f.Store().GetInfotransaksi(appCtx, tx, IdTransaksiRev)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov2" title="2">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "InfoTransaksiDetail": InfoTransaksiDetail,
                                "error":               err,
                                "params":              IdTransaksiRev,
                        }, nil, err.Error())
                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        response.RespCode = "02"
                        response.RespMsg = remark
                        return
                }</span>

                <span class="cov7" title="17">if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                        err = nil
                }</span>

                <span class="cov7" title="17">idTransaksi := RespRevTrx2.Data.IdTransaksiFundRev

                if (InfoTransaksiDetail != datastore.InfoTransaksiDetail{}) </span><span class="cov7" title="17">{
                        infoTransaksi := datastore.InsertInfoTransaksi{
                                IdTransaksi:             idTransaksi,
                                NomorRekeningDebet:      InfoTransaksiDetail.NomorRekeningKredit.String,
                                NamaRekeningDebet:       InfoTransaksiDetail.NamaRekeningKredit.String,
                                NomorRekeningKredit:     InfoTransaksiDetail.NomorRekeningDebet.String,
                                NamaRekeningKredit:      InfoTransaksiDetail.NamaRekeningDebet.String,
                                IsTunai:                 InfoTransaksiDetail.IsTunai.String,
                                NominalTransaksi:        float64(InfoTransaksiDetail.NominalTransaksi.Float64),
                                NominalBiaya:            float64(InfoTransaksiDetail.NominalBiaya.Float64),
                                AccountBiaya:            InfoTransaksiDetail.AccountBiaya.String,
                                NomorRekeningTransaksi:  InfoTransaksiDetail.NomorRekeningPair.String,
                                NamaRekeningTransaksi:   InfoTransaksiDetail.NamaRekeningPair.String,
                                NomorRekeningPair:       InfoTransaksiDetail.NomorRekeningTransaksi.String,
                                NamaRekeningPair:        InfoTransaksiDetail.NamaRekeningTransaksi.String,
                                SumberBiaya:             InfoTransaksiDetail.SumberBiaya.String,
                                JenisMutasiTransaksi:    map[string]string{"D": "K", "K": "D"}[InfoTransaksiDetail.JenisMutasiTransaksi.String],
                                JenisMutasiPair:         map[string]string{"D": "K", "K": "D"}[InfoTransaksiDetail.JenisMutasiPair.String],
                                NominalTunaiFisik:       InfoTransaksiDetail.NominalTunaiFisik.Float64,
                                IsTunaiFisik:            InfoTransaksiDetail.IsTunaiFisik.String,
                                IdNotadebitoutwardgroup: InfoTransaksiDetail.IdNotadebitoutwardgroup.Int64,
                        }

                        err = f.Store().InsertInfoTransaksi(appCtx, tx, infoTransaksi)
                        if err != nil </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error":  err,
                                        "params": infoTransaksi,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>
                }

                <span class="cov7" title="17">if TrxByIdTrx.KodeTransaksi.String == "SDN" || TrxByIdTrx.KodeTransaksi.String == "TDN" </span><span class="cov3" title="3">{
                        err = f.Store().UpdateStatusNotadebitoutwardgroup(appCtx, tx, InfoTransaksiDetail.IdNotadebitoutwardgroup.Int64, "D")
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "err": err,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov2" title="2">err = f.Store().UpdateStatusNotadebitoutward(appCtx, tx, InfoTransaksiDetail.IdNotadebitoutwardgroup.Int64, "D")
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "err": err,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">err = f.Store().UpdateSaldoFloatRekenigLiabilitas(appCtx, tx, InfoTransaksiDetail.NomorRekeningKredit.String)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error":          err,
                                        "nomor rekening": InfoTransaksiDetail.NomorRekeningKredit.String,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>
                }

                <span class="cov6" title="14">if TrxByIdTrx.KodeTransaksi.String == "IDN" </span><span class="cov2" title="2">{
                        var TrxDetailITK datastore.Dtkliringtarikan
                        TrxDetailITK, err = f.Store().GetDKTByIdTrx(appCtx, tx, IdTransaksiRev)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "TrxDetailITK": TrxDetailITK,
                                        "error":        err,
                                        "params":       IdTransaksiRev,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">err = f.Store().DeleteInfotarikankliringByIDTrx(appCtx, tx, TrxDetailITK.IdDetilTransaksi.Int64)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "err": err,
                                }, nil, remark)
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>
                }

                <span class="cov6" title="12">if TrxByIdTrx.KodeTransaksi.String == "TSDN" </span><span class="cov4" title="4">{
                        var DtkliringoutwardDetail datastore.DtkliringoutwardDetail
                        DtkliringoutwardDetail, err = f.Store().GetDKOByIdTrx(appCtx, tx, IdTransaksiRev)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "DtkliringoutwardDetail": DtkliringoutwardDetail,
                                        "error":                  err,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov3" title="3">UpdateNotaDebitOutwardByIdb := datastore.UpdateNotaDebitOutward{
                                IdNotaDebitOutWard: DtkliringoutwardDetail.IdNotadebitoutward.Int64,
                                Status:             "S",
                        }
                        err = f.Store().UpdateStatusNotadebitoutwardIdb(appCtx, tx, UpdateNotaDebitOutwardByIdb)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error":  err,
                                        "params": UpdateNotaDebitOutwardByIdb,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov2" title="2">err = f.Store().UpdateSaldoFloatRekenigLiabilitas(appCtx, tx, DtkliringoutwardDetail.NomorRekening.String)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error":          err,
                                        "nomor rekening": DtkliringoutwardDetail.NomorRekening.String,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">var ListDetailTrx []datastore.GetDetailTrxRes
                        ListDetailTrx, err = f.Store().GetListTrxDetailByParams(appCtx, tx, datastore.DetilTrx{
                                IdTransaksi: idTransaksi,
                                FlagCode:    "T",
                        })
                        if err != nil </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error": err,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">err = f.Store().InsertDTKliringOutward(appCtx, tx, datastore.Dtkliringoutward{
                                IdDetilTransaksi:   ListDetailTrx[0].IdDetilTransaksi.Int64,
                                IdNotadebitoutward: DtkliringoutwardDetail.IdNotadebitoutward.Int64,
                        })
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error": err,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>
                }

                <span class="cov5" title="8">if utils.Contains([]interface{}{"PB", "IDN", "TT", "SKN", "RTGS"}, TrxByIdTrx.KodeTransaksi.String) </span><span class="cov3" title="3">{
                        for _, lw := range ListNomorSeriWarkat </span><span class="cov3" title="3">{
                                err = f.Store().ReverseStatusWarkatCair(appCtx, tx, lw)
                                if err != nil </span><span class="cov1" title="1">{
                                        remark := "there was a problem, please contact customer support (DB01)"
                                        f.log.Error(logrus.Fields{
                                                "err": err,
                                        }, nil, remark)
                                        f.Store().Rollback(tx)
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        response.RespCode = "02"
                                        response.RespMsg = remark
                                        return
                                }</span>

                                <span class="cov2" title="2">Warkat := datastore.DsChequeBySerialNum{}
                                Warkat, err = f.Store().GetChequeBySerialNum(appCtx, tx, lw)
                                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                        remark := "there was a problem, please contact customer support (DB01)"
                                        f.log.Error(logrus.Fields{
                                                "result": fmt.Sprintf("%+v", Warkat),
                                                "error":  err,
                                                "params": lw,
                                        }, nil, err.Error())
                                        f.Store().Rollback(tx)
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        response.RespCode = "02"
                                        response.RespMsg = remark
                                        return
                                }</span>

                                <span class="cov1" title="1">err = f.Store().UpdateLembarTerpakaiCairReverse(appCtx, tx, Warkat.IdBukuwarkat.Int64)
                                if err != nil </span><span class="cov1" title="1">{
                                        remark := "there was a problem, please contact customer support (DB01)"
                                        f.log.Error(logrus.Fields{
                                                "err":          err,
                                                "IdBukuwarkat": Warkat.IdBukuwarkat.Int64,
                                        }, nil, remark)
                                        f.Store().Rollback(tx)
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        response.RespCode = "02"
                                        response.RespMsg = remark
                                        return
                                }</span>
                        }
                }

                <span class="cov4" title="5">if TrxByIdTrx.KodeTransaksi.String == "TTR" </span><span class="cov4" title="4">{
                        var InfoPenutupanRekening datastore.InfoPenutupanRekeningView
                        InfoPenutupanRekening, err = f.Store().GetInfoTTRByIdTrx(appCtx, tx, IdTransaksiRev)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "InfoPenutupanRekening": InfoPenutupanRekening,
                                        "error":                 err,
                                        "params":                IdTransaksiRev,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov3" title="3">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("id_transaksi %v tidak ditemukan di infopenutupanrekening", IdTransaksiRev)
                                f.log.Warn(logrus.Fields{
                                        "TrxByIdTrx": TrxByIdTrx,
                                        "error":      err,
                                        "params":     IdTransaksiRev,
                                }, nil, remark)
                                err = fmt.Errorf(remark)

                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                response.RespCode = "02"
                                response.RespMsg = remark
                                return
                        }</span>

                        <span class="cov2" title="2">if InfoPenutupanRekening.Nomor_rekening.String != "" </span><span class="cov2" title="2">{
                                err = f.Store().UpdateStatusRekeningTransaksi(appCtx, tx, InfoPenutupanRekening.Nomor_rekening.String, 1)
                                if err != nil </span><span class="cov1" title="1">{
                                        remark := "there was a problem, please contact customer support (DB01)"
                                        f.log.Error(logrus.Fields{
                                                "err": err,
                                        }, nil, remark)
                                        f.Store().Rollback(tx)
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        response.RespCode = "02"
                                        response.RespMsg = remark
                                        return
                                }</span>

                                <span class="cov1" title="1">err = f.Store().DelInfoTTR(appCtx, tx, InfoPenutupanRekening.Nomor_rekening.String)
                                if err != nil </span><span class="cov1" title="1">{
                                        remark := "there was a problem, please contact customer support (DB01)"
                                        f.log.Error(logrus.Fields{
                                                "err": err,
                                        }, nil, remark)
                                        f.Store().Rollback(tx)
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        response.RespCode = "02"
                                        response.RespMsg = remark
                                        return
                                }</span>

                                <span class="cov0" title="0">UpdateRekLiabBatalTTR := datastore.UpdateRekLiabBatalTTR{
                                        IsSedangDitutup: "T",
                                        NomorRekening:   InfoPenutupanRekening.Nomor_rekening.String,
                                }
                                err = f.Store().UpdateRekLiabBatalTTR(appCtx, tx, UpdateRekLiabBatalTTR)
                                if err != nil </span><span class="cov0" title="0">{
                                        remark := "there was a problem, please contact customer support (DB01)"
                                        f.log.Error(logrus.Fields{
                                                "err": err,
                                        }, nil, remark)
                                        f.Store().Rollback(tx)
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        response.RespCode = "02"
                                        response.RespMsg = remark
                                        return
                                }</span>
                        }
                }
        }

        <span class="cov1" title="1">InfoUidReq := datastore.InfoUidReq{
                Uidkey:     params.Uidkey,
                ActionType: "POST_TRX_REV_BY_UIDKEY",
                UserInput:  params.UserInput,
                UserOtor:   params.UserOtorisasi,
                Keterangan: "Transaksi reversal by uidkey",
                Info1:      params.UidkeyRev,
                Info2:      strconv.FormatInt(RespRevTrx1.Data.IdTransaksiFundRev, 10),
                KodeCabang: params.KodeCabangInput,
                Keyint:     RespRevTrx2.Data.IdTransaksiFundRev,
        }
        err = f.Store().InsertInfoUid(appCtx, tx, InfoUidReq)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov1" title="1">f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        response.RespCode = "00"
        response.RespMsg = "Transaksi reversal berhasil"
        response.IdTransaksi = RespRevTrx2.Data.IdTransaksiFundRev
        err = nil

        appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}
</pre>
		
		<pre class="file" id="file8" style="display: none">package app

import (
        "context"
        "database/sql"
        "fmt"
        "fundtx/data"

        "runtime"
        "strings"

        "github.com/jmoiron/sqlx"
        "go.opentelemetry.io/otel/attribute"
        otel_code "go.opentelemetry.io/otel/codes"

        "fundtx/datastore"
        "fundtx/pkg/errors"
        "fundtx/pkg/logging/utils"

        "github.com/jinzhu/copier"
        "github.com/sirupsen/logrus"
        "google.golang.org/grpc/codes"
        "google.golang.org/grpc/status"
)

func (f *service) GET_TRX_LIST(ctx context.Context, reqPayload datastore.GetListTrxReq) (getlisttrx []datastore.GetListTrxRes, respCode string, respMsg string, err error) <span class="cov2" title="3">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GET_TRX_LIST %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()

        _, span := f.tracer.Start(ctx, fmt.Sprintf("GET_TRX_LIST-APP %s ", "start"))
        defer span.End()

        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(
                        logrus.Fields{"error": err}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov2" title="2">defer f.PanicHandler(tx, &amp;err)

        getlisttrx, err = f.Store().GetTrxList(appCtx, tx, reqPayload)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                err = status.Error(codes.OK, err.Error())
                return
        }</span>

        <span class="cov1" title="1">respCode = "00"
        respMsg = "Berhasil"
        f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}

func (f *service) GET_TRX_DETAIL(ctx context.Context, reqPayload datastore.GetDetailTrxReq) (getdetailtrx []datastore.GetDetailTrxRes, respCode string, respMsg string, err error) <span class="cov2" title="3">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GET_TRX_DETAIL %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov2" title="2">defer f.PanicHandler(tx, &amp;err)

        getdetailtrx, err = f.Store().GetTrxDetail(appCtx, tx, reqPayload)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                err = status.Error(codes.OK, err.Error())
                return
        }</span>

        <span class="cov1" title="1">respCode = "00"
        respMsg = "Berhasil"
        f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}

func (f *service) PostTrxOverbooking(ctx context.Context, params data.ReqTrxOverbooking) (RespTrxOverbooking data.RespTrxOverbooking, err error) <span class="cov6" title="17">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("PostTrxOverbooking %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        params.UserInput = strings.ToUpper(params.UserInput)

        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                err = fmt.Errorf(remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = remark

                return
        }</span>

        <span class="cov6" title="16">defer f.PanicHandler(tx, &amp;err)

        if params.NomorReferensi == "" </span><span class="cov1" title="1">{
                remark := "Field nomor_referensi harus diisi"
                f.log.Warn(logrus.Fields{"nomor_referensi": params.NomorReferensi}, nil, remark)
                err = fmt.Errorf(remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = remark

                return
        }</span>

        <span class="cov5" title="15">ActionType := "POST_TRX_OVERBOOKING"
        uidkeycek := datastore.ReqGetInfoUid{
                Uidkey:        params.Uidkey,
                ActionTypeCek: ActionType,
        }
        resUID, err := f.Store().GetInfoUid(appCtx, tx, uidkeycek)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "resUID": resUID,
                        "error":  err,
                        "params": uidkeycek,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = remark

                return
        }</span>

        <span class="cov5" title="14">var infoUid datastore.InfoUid
        if resUID != infoUid </span><span class="cov1" title="1">{
                remark := "Transaksi sudah diproses"
                f.log.Warn(logrus.Fields{"resUID": resUID}, nil, remark)
                RespTrxOverbooking.Data.IdTransaksi = resUID.Keyint.Int64

                err = fmt.Errorf(remark)

                RespTrxOverbooking.Data.Uidkey = params.Uidkey
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "00"
                RespTrxOverbooking.Msg = remark

                return
        }</span>

        <span class="cov5" title="13">if !utils.Contains([]interface{}{"T", "R", "N"}, params.SumberBiaya) </span><span class="cov1" title="1">{
                err = fmt.Errorf("field sumber_biaya tidak valid")
                f.log.Warn(logrus.Fields{"error": err, "params": params.SumberBiaya}, nil, err.Error())

                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = err.Error()

                return
        }</span>

        <span class="cov5" title="12">if !utils.Contains([]interface{}{"A", "B", "C"}, params.JenisAplikasi) </span><span class="cov1" title="1">{
                err = fmt.Errorf("field jenis_aplikasi tidak valid")
                f.log.Warn(logrus.Fields{"error": err, "params": params.JenisAplikasi}, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = err.Error()

                return
        }</span>

        <span class="cov5" title="11">teller, err := f.Store().GetTellerDetail(appCtx, tx, params.UserInput, params.KodeCabangTransaksi, params.KodeValutaTransaksi)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "result": fmt.Sprintf("%+v", teller),
                        "error":  err,
                        "params": map[string]interface{}{
                                "UserInput":           params.UserInput,
                                "KodeCabangTransaksi": params.KodeCabangTransaksi,
                                "KodeValutaTransaksi": params.KodeValutaTransaksi,
                        },
                }, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = remark

                return
        }</span>

        <span class="cov5" title="10">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                err = fmt.Errorf("rekening teller untuk user %v cabang %v kode valuta %v tidak ditemukan", params.UserInput, params.KodeCabangTransaksi, params.KodeValutaTransaksi)
                f.log.Warn(logrus.Fields{
                        "result": fmt.Sprintf("%+v", teller),
                        "error":  err,
                        "params": map[string]interface{}{
                                "UserInput":           params.UserInput,
                                "KodeCabangTransaksi": params.KodeCabangTransaksi,
                                "KodeValutaTransaksi": params.KodeValutaTransaksi,
                        },
                }, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = err.Error()
                return
        }</span>

        <span class="cov4" title="9">resPOD, err := f.Store().GetPod(appCtx, tx)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "err":    err,
                        "resPOD": resPOD,
                }, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = remark
                return
        }</span>

        <span class="cov4" title="8">tanggalPod, err := utils.FormatDate(resPOD.Today)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (IS02)"
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = remark
                return
        }</span>

        <span class="cov4" title="8">rekTrxDebet, err := f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningDebet)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "result": rekTrxDebet,
                        "error":  err,
                        "params": params.NomorRekeningDebet,
                }, nil, err.Error())
                err = errors.SystemError.Database
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = err.Error()
                return
        }</span>

        <span class="cov4" title="8">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                err = fmt.Errorf(fmt.Sprintf("rekening %v tidak terdaftar", params.NomorRekeningDebet))
                f.log.Warn(logrus.Fields{"err": err}, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = err.Error()
                return
        }</span>

        <span class="cov4" title="7">rekTrxCredit, err := f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekeningKredit)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "result": rekTrxCredit,
                        "error":  err,
                        "params": params.NomorRekeningKredit,
                }, nil, err.Error())
                err = errors.SystemError.Database
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = err.Error()
                return
        }</span>

        <span class="cov4" title="7">if err == sql.ErrNoRows </span><span class="cov2" title="3">{
                err = fmt.Errorf(fmt.Sprintf("rekening %v tidak terdaftar", params.NomorRekeningKredit))
                f.log.Warn(logrus.Fields{"err": err}, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = err.Error()
                return
        }</span>

        <span class="cov3" title="4">if params.JenisAplikasi == "C" || params.JenisAplikasi == "B" </span><span class="cov2" title="3">{
                NotaDebetInternalDetail := datastore.NotaDebetInternalDetail{}
                WarkatReq := datastore.WarkatReq{
                        NomorRekening: params.NomorRekeningDebet,
                        JenisWarkat:   params.JenisAplikasi,
                        NomorSeri:     params.NomorReferensi,
                }
                NotaDebetInternalDetail, err = f.Store().GetWarkatDetail(appCtx, tx, WarkatReq)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                        f.log.Error(logrus.Fields{
                                "error":  err,
                                "params": params,
                        }, nil, err.Error())
                        err = errors.SystemError.Database
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrxOverbooking.Status = "02"
                        RespTrxOverbooking.Msg = err.Error()

                        return
                }</span>

                <span class="cov2" title="3">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                        err = fmt.Errorf(fmt.Sprintf("nomor seri %v tidak valid", params.NomorReferensi))
                        f.log.Warn(logrus.Fields{"error": err}, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrxOverbooking.Status = "02"
                        RespTrxOverbooking.Msg = err.Error()
                        return
                }</span>

                <span class="cov2" title="2">if NotaDebetInternalDetail.StatusWarkat.String == "C" </span><span class="cov1" title="1">{
                        remark := fmt.Sprintf("status warkat %v sudah cair", params.NomorReferensi)
                        f.log.Warn(logrus.Fields{"StatusWarkat": NotaDebetInternalDetail.StatusWarkat}, nil, remark)

                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrxOverbooking.Status = "02"
                        RespTrxOverbooking.Msg = remark

                        return
                }</span>

                <span class="cov1" title="1">if !(NotaDebetInternalDetail.StatusWarkat.String == "A" || NotaDebetInternalDetail.StatusWarkat.String == "P") </span><span class="cov0" title="0">{
                        remark := fmt.Sprintf("status warkat %v %v", params.NomorReferensi, NotaDebetInternalDetail.StatusWarkatDesc.String)
                        f.log.Warn(logrus.Fields{"StatusWarkat": NotaDebetInternalDetail.StatusWarkat}, nil, remark)

                        err = fmt.Errorf(remark)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrxOverbooking.Status = "02"
                        RespTrxOverbooking.Msg = remark

                        return
                }</span>

                <span class="cov1" title="1">updateStatusWarkat := datastore.UpdateStatusWarkatCair{
                        JenisWarkat:        params.JenisAplikasi,
                        NomorRekening:      params.NomorRekeningDebet,
                        NomorSeri:          params.NomorReferensi,
                        StatusWarkat:       "C",
                        TanggalPakaiWarkat: tanggalPod,
                        UserPengubah:       params.UserInput,
                }
                err = f.Store().UpdateStatusWarkatCair(appCtx, tx, updateStatusWarkat)
                if err != nil </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "err": err,
                        }, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrxOverbooking.Status = "02"
                        RespTrxOverbooking.Msg = remark
                        return
                }</span>

                <span class="cov1" title="1">err = f.Store().UpdateLembarTerpakaiCair(appCtx, tx, NotaDebetInternalDetail.IdBukuwarkat.Int64)
                if err != nil </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "err":          err,
                                "IdBukuwarkat": NotaDebetInternalDetail.IdBukuwarkat.Int64,
                        }, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrxOverbooking.Status = "02"
                        RespTrxOverbooking.Msg = remark
                        return
                }</span>
        }

        <span class="cov2" title="2">ListDetilTrx := []datastore.DetilTrx{}

        keterangan := fmt.Sprintf("Pindah buku dari Rek. %v an. %v ke Rek. %v an. %v Sebesar %v", params.NomorRekeningDebet, rekTrxDebet.NamaRekening.String, params.NomorRekeningKredit, rekTrxCredit.NamaRekening.String, params.NilaiTransaksi)
        if params.Keterangan != "" </span><span class="cov0" title="0">{
                keterangan = params.Keterangan
        }</span>

        <span class="cov2" title="2">listDetilTrxAutoSave, err := f.Utils().AutosaveCheck(appCtx, tx, data.AutosaveCheck{
                NomorRekening:       params.NomorRekeningDebet,
                NilaiTransaksi:      float64(params.NilaiTransaksi + params.Biaya),
                KodeCabangTransaksi: params.KodeCabangTransaksi,
                NomorReferensi:      params.NomorReferensi,
        })
        if err != nil </span><span class="cov0" title="0">{
                remark := err.Error()
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                //f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = remark
                return
        }</span>
        <span class="cov2" title="2">ListDetilTrx = append(ListDetilTrx, listDetilTrxAutoSave...)

        DataTrx := data.DataTrx{
                NomorReferensi:      params.NomorReferensi,
                Keterangan:          keterangan,
                JenisAplikasi:       params.JenisAplikasi,
                KodeValutaTransaksi: params.KodeValutaTransaksi,
                KursManual:          1,
                NilaiTransaksi:      float64(params.NilaiTransaksi),
                Biaya:               params.Biaya,
                KodeCabangTransaksi: params.KodeCabangTransaksi,
                IsSudahDijurnal:     "F",
                KodeTransaksi:       "PB",
                UserInput:           params.UserInput,
                UserOtorisasi:       params.UserOtorisasi,
                IsReverseAllowed:    "T",
        }

        NomorSeriWarkat := map[bool]string{true: params.NomorReferensi, false: ""}[(params.JenisAplikasi == "C" || params.JenisAplikasi == "B")]

        DetilTrxDb := datastore.DetilTrx{
                JenisDetilTransaksi: "002",
                NomorRekening:       params.NomorRekeningDebet,
                JenisMutasi:         "D",
                NilaiMutasi:         float64(params.NilaiTransaksi),
                KodeCabang:          rekTrxDebet.KodeCabang.String,
                Keterangan:          keterangan,
                NilaiKursManual:     1,
                NilaiEkuivalen:      float64(params.NilaiTransaksi),
                NomorReferensi:      params.NomorReferensi,
                FlagProses:          "F",
                KodeJurnal:          "11",
                KodeValutaRak:       params.KodeValutaTransaksi,
                NomorSeriWarkat:     NomorSeriWarkat,
        }
        ListDetilTrx = append(ListDetilTrx, DetilTrxDb)

        DetilTrxCr := datastore.DetilTrx{
                JenisDetilTransaksi: "002",
                NomorRekening:       params.NomorRekeningKredit,
                JenisMutasi:         "C",
                NilaiMutasi:         float64(params.NilaiTransaksi),
                KodeCabang:          rekTrxCredit.KodeCabang.String,
                Keterangan:          keterangan,
                NilaiKursManual:     1,
                NilaiEkuivalen:      float64(params.NilaiTransaksi),
                NomorReferensi:      params.NomorReferensi,
                FlagProses:          "F",
                KodeJurnal:          "11",
                KodeValutaRak:       params.KodeValutaTransaksi,
        }
        ListDetilTrx = append(ListDetilTrx, DetilTrxCr)

        if params.Biaya &gt; 0 &amp;&amp; params.SumberBiaya == "R" </span><span class="cov0" title="0">{
                DetilTrxDb = datastore.DetilTrx{
                        JenisDetilTransaksi: "002",
                        NomorRekening:       params.NomorRekeningDebet,
                        JenisMutasi:         "D",
                        NilaiMutasi:         params.Biaya,
                        KodeCabang:          rekTrxDebet.KodeCabang.String,
                        Keterangan:          "Biaya pindah buku",
                        NilaiKursManual:     1,
                        NilaiEkuivalen:      params.Biaya,
                        NomorReferensi:      params.NomorReferensi,
                        FlagProses:          "F",
                        KodeJurnal:          "11",
                        KodeValutaRak:       params.KodeValutaTransaksi,
                }
                ListDetilTrx = append(ListDetilTrx, DetilTrxDb)

                DetilTrxCr = datastore.DetilTrx{
                        JenisDetilTransaksi: "006",
                        NomorRekening:       "PDP_BYLAY",
                        JenisMutasi:         "C",
                        NilaiMutasi:         params.Biaya,
                        KodeCabang:          params.KodeCabangTransaksi,
                        Keterangan:          "Biaya pindah buku",
                        NilaiKursManual:     1,
                        NilaiEkuivalen:      params.Biaya,
                        NomorReferensi:      params.NomorReferensi,
                        FlagProses:          "F",
                        KodeJurnal:          "11",
                        KodeValutaRak:       params.KodeValutaTransaksi,
                }
                ListDetilTrx = append(ListDetilTrx, DetilTrxCr)
        }</span>

        <span class="cov2" title="2">if params.Biaya &gt; 0 &amp;&amp; params.SumberBiaya == "T" </span><span class="cov0" title="0">{
                DetilTrxDb = datastore.DetilTrx{
                        JenisDetilTransaksi: "004",
                        NomorRekening:       teller.NomorRekening.String,
                        JenisMutasi:         "D",
                        NilaiMutasi:         params.Biaya,
                        KodeCabang:          params.KodeCabangTransaksi,
                        Keterangan:          "Biaya pindah buku",
                        NilaiKursManual:     1,
                        NilaiEkuivalen:      params.Biaya,
                        NomorReferensi:      params.NomorReferensi,
                        FlagProses:          "F",
                        KodeJurnal:          "11",
                        KodeValutaRak:       params.KodeValutaTransaksi,
                }
                ListDetilTrx = append(ListDetilTrx, DetilTrxDb)

                DetilTrxCr = datastore.DetilTrx{
                        JenisDetilTransaksi: "006",
                        NomorRekening:       "PDP_BYLAY",
                        JenisMutasi:         "C",
                        NilaiMutasi:         params.Biaya,
                        KodeCabang:          params.KodeCabangTransaksi,
                        Keterangan:          "Biaya pindah buku",
                        NilaiKursManual:     1,
                        NilaiEkuivalen:      params.Biaya,
                        NomorReferensi:      params.NomorReferensi,
                        FlagProses:          "F",
                        KodeJurnal:          "11",
                        KodeValutaRak:       params.KodeValutaTransaksi,
                }
                ListDetilTrx = append(ListDetilTrx, DetilTrxCr)
        }</span>

        <span class="cov2" title="2">PostTrx := data.PostTrx{
                DataTrx:  DataTrx,
                DetilTrx: ListDetilTrx,
        }

        RespTrx, err := f.Utils().GenericTrx(appCtx, tx, PostTrx)
        if (err != nil &amp;&amp; err != sql.ErrNoRows) || RespTrx.Status == "02" </span><span class="cov0" title="0">{
                remark := RespTrx.Msg
                f.log.Error(logrus.Fields{
                        "err":     err,
                        "RespTrx": RespTrx,
                        "Status":  RespTrx.Status,
                        "Msg":     RespTrx.Msg,
                }, nil, remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = remark
                return
        }</span>

        <span class="cov2" title="2">idTransaksi := RespTrx.Data.IdTransaksiFund
        infoTransaksi := datastore.InsertInfoTransaksi{
                IdTransaksi:            idTransaksi,
                NomorRekeningDebet:     params.NomorRekeningDebet,
                NomorRekeningKredit:    params.NomorRekeningKredit,
                NamaRekeningDebet:      rekTrxDebet.NamaRekening.String,
                NamaRekeningKredit:     rekTrxCredit.NamaRekening.String,
                IsTunai:                "F",
                NominalTransaksi:       float64(params.NilaiTransaksi),
                NominalBiaya:           float64(params.Biaya),
                NomorRekeningTransaksi: params.NomorRekeningDebet,
                NamaRekeningTransaksi:  rekTrxDebet.NamaRekening.String,
                NomorRekeningPair:      params.NomorRekeningKredit,
                NamaRekeningPair:       rekTrxCredit.NamaRekening.String,
                JenisMutasiTransaksi:   "D",
                JenisMutasiPair:        "K",
                NominalTunaiFisik:      float64(params.NilaiTransaksi),
                IsTunaiFisik:           "F",
                SumberBiaya:            params.SumberBiaya,
        }

        err = f.Store().InsertInfoTransaksi(appCtx, tx, infoTransaksi)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "error":  err,
                        "params": infoTransaksi,
                }, nil, err.Error())

                err = errors.SystemError.Database
                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = remark
                return
        }</span>

        <span class="cov2" title="2">InfoUidReq := datastore.InfoUidReq{
                Uidkey:     params.Uidkey,
                ActionType: ActionType,
                UserInput:  params.UserInput,
                UserOtor:   params.UserOtorisasi,
                Keterangan: "Transaksi pindah buku",
                Info1:      params.NomorRekeningDebet,
                KodeCabang: params.KodeCabangTransaksi,
                Keyint:     RespTrx.Data.IdTransaksiFund,
        }
        err = f.Store().InsertInfoUid(appCtx, tx, InfoUidReq)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrxOverbooking.Status = "02"
                RespTrxOverbooking.Msg = remark
                return
        }</span>

        <span class="cov2" title="2">f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        RespTrxOverbooking.Status = "00"
        RespTrxOverbooking.Msg = "Transaksi Berhasil"
        RespTrxOverbooking.Data.IdTransaksi = RespTrx.Data.IdTransaksiFund
        RespTrxOverbooking.Data.Uidkey = params.Uidkey

        return</span>
}

func (f *service) GET_TRX_BY_NOREK(ctx context.Context, params data.ReqTrxByNorek) (RespData data.ResTrxByNorek, respCode string, respMsg string, err error) <span class="cov5" title="10">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GET_TRX_BY_NOREK %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(
                        logrus.Fields{"error": err}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov4" title="9">defer f.PanicHandler(tx, &amp;err)

        if params.NomorRekening == "" </span><span class="cov1" title="1">{
                remark := "nomor rekening harus di isi"
                f.log.Warn(
                        logrus.Fields{"nomor_rekening": params.NomorRekening}, nil, remark,
                )
                f.Store().Rollback(tx)
                err = fmt.Errorf(remark)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov4" title="8">if params.TanggalAkhir == "" || params.TanggalAwal == "" </span><span class="cov1" title="1">{
                err = fmt.Errorf("TANGGAL_EMPTY")
                remark := "Field Tanggal Awal dan Tanggal Akhir harus diisi."
                f.log.Warn(
                        logrus.Fields{
                                "nomor_awal":  params.TanggalAwal,
                                "nomor_akhir": params.TanggalAkhir,
                        }, nil, remark,
                )
                f.Store().Rollback(tx)

                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov4" title="7">tanggalAwal, err := utils.FormatDate(params.TanggalAwal)
        if err != nil </span><span class="cov1" title="1">{
                remark := fmt.Sprintf("Format tanggal awal (%v) tidak sesuai. Silahkan isi tanggal awal dengan format yyyy-mm-dd", params.TanggalAwal)
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                err = fmt.Errorf(remark)

                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov4" title="6">tanggalAkhir, err := utils.FormatDate(params.TanggalAkhir)
        if err != nil </span><span class="cov1" title="1">{
                remark := fmt.Sprintf("Format tanggal akhir (%v) tidak sesuai. Silahkan isi tanggal akhir dengan format yyyy-mm-dd", params.TanggalAkhir)
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                err = fmt.Errorf(remark)

                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov3" title="5">if tanggalAwal.After(tanggalAkhir) </span><span class="cov1" title="1">{
                err = fmt.Errorf("DATE_ERROR")
                remark := "Tanggal awal tidak boleh lebih besar dari akhir"
                f.log.Warn(
                        logrus.Fields{
                                "tanggal_awal":  params.TanggalAwal,
                                "tanggal_akhir": params.TanggalAkhir,
                        }, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        // dateRange := tanggalAkhir.Sub(tanggalAwal)
        // maxAllowedRange := 30 * 24 * time.Hour

        // if dateRange &gt; maxAllowedRange {
        //         err = fmt.Errorf("DATE_RANGE_ERROR")
        //         remark := "Jarak tanggal awal dan tanggal akhir maksimal 30 hari"
        //         f.log.Warn(logrus.Fields{
        //                 "err":             err,
        //                 "dateRange":       dateRange,
        //                 "maxAllowedRange": maxAllowedRange,
        //         }, nil, remark)
        //         f.Store().Rollback(tx)

        //         respCode = "02"
        //         respMsg = remark
        //         return
        // }

        <span class="cov3" title="4">resPOD, err := f.Store().GetPod(appCtx, tx)
        if err != nil </span><span class="cov1" title="1">{
                remark := "tanggal POD tidak ditemukan di system, silahkan hubungi customer support"
                f.log.Error(logrus.Fields{
                        "err":    err,
                        "resPOD": resPOD,
                }, nil, remark)
                err = fmt.Errorf(remark)

                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark

                return
        }</span>

        <span class="cov2" title="3">tanggalPod, err := utils.FormatDate(resPOD.Today)
        if err != nil </span><span class="cov0" title="0">{
                remark := fmt.Sprintf("Format tanggal POD (%v) tidak sesuai. Format seharusnya yyyy-mm-dd", resPOD.Today)
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                err = fmt.Errorf(remark)

                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov2" title="3">if tanggalAwal.After(tanggalPod) || tanggalAkhir.After(tanggalPod) </span><span class="cov2" title="2">{
                remark := fmt.Sprintf("tanggal awal dan tanggal akhir tidak boleh melebihi tanggal POD (%v)", resPOD.Today)
                f.log.Warn(
                        logrus.Fields{
                                "tanggal_awal":  params.TanggalAwal,
                                "tanggal_akhir": params.TanggalAkhir,
                                "tanggal_pod":   resPOD.Today,
                        }, nil, remark,
                )
                err = fmt.Errorf(remark)

                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                err = fmt.Errorf(remark)

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov1" title="1">tanggalAwalSaldo := tanggalAwal.AddDate(0, 0, -1)
        formattedtanggalAwalSaldo := tanggalAwalSaldo.Format(utils.DATE_FORMAT)

        Saldo, err := f.Store().GetSaldoByDate(appCtx, tx, params.NomorRekening, formattedtanggalAwalSaldo)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov1" title="1">RespData.SaldoAwal = Saldo

        // ambil dari history
        if tanggalAwal.Before(tanggalPod) </span><span class="cov1" title="1">{
                var reqParams datastore.GetHistTrxListByNorek
                err = copier.Copy(&amp;reqParams, params)
                if err != nil </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (IS01)"
                        f.log.Error(logrus.Fields{
                                "error":            err,
                                "source copy":      params,
                                "destination copy": reqParams,
                        }, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        err = fmt.Errorf(remark)

                        respCode = "02"
                        respMsg = remark
                        return
                }</span>

                <span class="cov1" title="1">var ListHisTrx []datastore.ListHistTrxByNorek
                ListHisTrx, err = f.Store().GetHistTrxListByNorek(appCtx, tx, reqParams)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{"err": err}, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        respCode = "02"
                        respMsg = remark
                        err = status.Error(codes.OK, err.Error())
                        return
                }</span>

                <span class="cov1" title="1">for idx, dt := range ListHisTrx </span><span class="cov0" title="0">{
                        if dt.JenisMutasi.String == "D" </span><span class="cov0" title="0">{
                                Saldo -= dt.NilaiMutasi.Float64
                                Saldo = utils.RoundFloat(Saldo, 2)
                        }</span> else<span class="cov0" title="0"> {
                                Saldo += dt.NilaiMutasi.Float64
                                Saldo = utils.RoundFloat(Saldo, 2)
                        }</span>
                        <span class="cov0" title="0">ListHisTrx[idx].Saldo = sql.NullFloat64{Float64: Saldo, Valid: true}</span>
                }

                <span class="cov1" title="1">var ListHistTrxByNorek []datastore.ListTrxByNorek
                err = copier.Copy(&amp;ListHistTrxByNorek, ListHisTrx)
                if err != nil </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (IS01)"
                        f.log.Error(logrus.Fields{
                                "error":            err,
                                "source copy":      ListHisTrx,
                                "destination copy": ListHistTrxByNorek,
                        }, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        respCode = "02"
                        respMsg = remark
                        err = fmt.Errorf(remark)
                        return
                }</span>
                <span class="cov1" title="1">RespData.ListTrx = append(RespData.ListTrx, ListHistTrxByNorek...)</span>
        }

        // ambil dari transaksi hari ini
        <span class="cov1" title="1">if (tanggalAwal == tanggalPod) || (tanggalAkhir == tanggalPod) || tanggalPod.Before(tanggalAkhir) </span><span class="cov0" title="0">{
                reqParams := datastore.GetTrxListByNorek{
                        NomorRekening: params.NomorRekening,
                }

                var ListTrxToday []datastore.ListTrxByNorek
                ListTrxToday, err = f.Store().GetTrxListByNorek(appCtx, tx, reqParams)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{"err": err}, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        respCode = "02"
                        respMsg = remark
                        err = status.Error(codes.OK, err.Error())
                        return
                }</span>

                <span class="cov0" title="0">for idx, dt := range ListTrxToday </span><span class="cov0" title="0">{
                        if dt.JenisMutasi.String == "D" </span><span class="cov0" title="0">{
                                Saldo -= dt.NilaiMutasi.Float64
                                Saldo = utils.RoundFloat(Saldo, 2)
                        }</span> else<span class="cov0" title="0"> {
                                Saldo += dt.NilaiMutasi.Float64
                                Saldo = utils.RoundFloat(Saldo, 2)
                        }</span>
                        <span class="cov0" title="0">ListTrxToday[idx].Saldo = sql.NullFloat64{Float64: Saldo, Valid: true}</span>
                }

                <span class="cov0" title="0">var ListTrxByNorek []datastore.ListTrxByNorek
                err = copier.Copy(&amp;ListTrxByNorek, ListTrxToday)
                if err != nil </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (IS01)"
                        f.log.Error(logrus.Fields{
                                "error":            err,
                                "source copy":      ListTrxToday,
                                "destination copy": ListTrxByNorek,
                        }, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        respCode = "02"
                        respMsg = remark
                        err = fmt.Errorf(remark)
                        return
                }</span>
                <span class="cov0" title="0">RespData.ListTrx = append(RespData.ListTrx, ListTrxByNorek...)</span>
        }

        <span class="cov1" title="1">respCode = "00"
        respMsg = "Berhasil"
        f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}

func (f *service) GET_TRX_DETAIL_BY_UIDKEY(ctx context.Context, reqPayload datastore.GetDetailTrxUidReq) (getdetailtrx []datastore.GetDetailTrxUidRes, respCode string, respMsg string, err error) <span class="cov2" title="3">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GET_TRX_DETAIL_BY_UIDKEY %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov2" title="2">defer f.PanicHandler(tx, &amp;err)

        getdetailtrx, err = f.Store().GetTrxDetailByUidkey(appCtx, tx, reqPayload)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                err = status.Error(codes.OK, err.Error())
                return
        }</span>

        <span class="cov1" title="1">respCode = "00"
        respMsg = "Berhasil"
        f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}

func (f *service) GET_HIST_TRX_DETAIL_BY_UIDKEY(ctx context.Context, reqPayload datastore.GetDetailTrxUidReq) (getdetailtrx []datastore.GetDetailTrxUidRes, respCode string, respMsg string, err error) <span class="cov2" title="3">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GET_HIST_TRX_DETAIL_BY_UIDKEY %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov2" title="2">defer f.PanicHandler(tx, &amp;err)

        getdetailtrx, err = f.Store().GetHistTrxDetailByUidkey(appCtx, tx, reqPayload)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                err = status.Error(codes.OK, err.Error())
                return
        }</span>

        <span class="cov1" title="1">respCode = "00"
        respMsg = "Berhasil"
        f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}

func (f *service) POST_BEA_BIAYA(ctx context.Context, params data.PostTrxBeaBiaya) (result data.RespTrx, err error) <span class="cov4" title="7">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("POST_BEA_BIAYA %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()

        params.UserInput = strings.ToUpper(params.UserInput)

        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                err = errors.SystemError.InitDatabaseTransaction
                f.log.Error(logrus.Fields{"error": err}, nil, err.Error())

                result.Status = *utils.ECD
                result.Msg = err.Error()
                return
        }</span>

        <span class="cov4" title="6">defer f.TransactionStatusHandler(tx, &amp;err)

        if params.NomorReferensi == "" </span><span class="cov1" title="1">{
                err = fmt.Errorf("field nomor_referensi harus diisi")
                f.log.Warn(logrus.Fields{"nomor_referensi": params.NomorReferensi}, nil, err.Error())

                result.Status = *utils.ECD
                result.Msg = err.Error()

                return
        }</span>

        <span class="cov3" title="5">actionType := "POST_BEA_BIAYA"
        uidkeycek := datastore.ReqGetInfoUid{
                Uidkey:        params.Uidkey,
                ActionTypeCek: actionType,
        }
        resUID, err := f.Store().GetInfoUid(appCtx, tx, uidkeycek)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "resUID": resUID,
                        "error":  err,
                        "params": uidkeycek,
                }, nil, err.Error())
                err = errors.SystemError.Database

                result.Status = *utils.ECD
                result.Msg = err.Error()
                return
        }</span>

        <span class="cov3" title="5">var infoUid datastore.InfoUid
        if resUID != infoUid </span><span class="cov1" title="1">{
                err = fmt.Errorf("transaksi sudah diproses")
                f.log.Warn(logrus.Fields{"resUID": resUID}, nil, err.Error())

                result.Status = utils.SUCCESS_CODE
                result.Msg = err.Error()
                result.Data.IdTransaksiFund = resUID.Keyint.Int64
                return
        }</span>

        //Ganti dengan validasi norek
        <span class="cov3" title="4">rekNasabahTrx, err := f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekening)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "result": rekNasabahTrx,
                        "error":  err,
                        "params": params,
                }, nil, err.Error())
                //f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                result.Status = "02"
                result.Msg = remark
                return
        }</span>

        <span class="cov3" title="4">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := fmt.Sprintf("Rekening %v tidak valid", params.NomorRekening)
                f.log.Warn(logrus.Fields{"NomorRekening": params.NomorRekening}, nil, remark)
                err = fmt.Errorf(remark)

                //f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                result.Status = "02"
                result.Msg = remark

                return
        }</span>

        <span class="cov2" title="3">if rekNasabahTrx.StatusRekening.Int32 != 1 </span><span class="cov1" title="1">{
                remark := fmt.Sprintf("Rekening %v tidak aktif", params.NomorRekening)
                f.log.Warn(logrus.Fields{"StatusRekening": rekNasabahTrx.StatusRekening.Int32}, nil, remark)
                err = fmt.Errorf(remark)

                //f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                result.Status = "02"
                result.Msg = remark

                return
        }</span>

        <span class="cov2" title="2">if !utils.Contains([]interface{}{"T", "G"}, rekNasabahTrx.JenisRekeningLiabilitas.String) </span><span class="cov1" title="1">{
                remark := fmt.Sprintf("Rekening %v bukan tabungan atau giro", params.NomorRekening)
                f.log.Warn(logrus.Fields{"JenisRekeningLiabilitas": rekNasabahTrx.JenisRekeningLiabilitas.String}, nil, remark)
                err = fmt.Errorf(remark)

                //f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                result.Status = "02"
                result.Msg = remark
                return
        }</span>

        <span class="cov1" title="1">listDetilTrx := []datastore.DetilTrx{}
        NilaiTransaksiFC := f.CurrencyFormatStr(params.NilaiTransaksi, "D", 2, "Rp")
        keterangan := fmt.Sprintf("Transaksi Bea Biaya Rekening %v, Nominal %v", rekNasabahTrx.NomorRekening.String, NilaiTransaksiFC)
        if params.Keterangan != "" </span><span class="cov0" title="0">{
                keterangan = params.Keterangan
        }</span>

        <span class="cov1" title="1">RekeningMeterai := fmt.Sprintf("1442202-%v-%v", params.KodeCabangTransaksi, params.KodeValutaTransaksi)

        dataTrx := data.DataTrx{
                NomorReferensi:      params.NomorReferensi,
                Keterangan:          keterangan,
                JenisAplikasi:       "A",
                KodeValutaTransaksi: params.KodeValutaTransaksi,
                KursManual:          1,
                NilaiTransaksi:      float64(params.NilaiTransaksi),
                KodeCabangTransaksi: params.KodeCabangTransaksi,
                IsSudahDijurnal:     "F",
                KodeTransaksi:       "BMBD",
                UserInput:           params.UserInput,
                UserOtorisasi:       params.UserOtorisasi,
        }

        detilTrxDebit := datastore.DetilTrx{
                JenisDetilTransaksi: "002",
                NomorRekening:       rekNasabahTrx.NomorRekening.String,
                JenisMutasi:         "D",
                NilaiMutasi:         float64(params.NilaiTransaksi),
                KodeCabang:          params.KodeCabangTransaksi,
                Keterangan:          fmt.Sprintf("Kredit ke %v Nominal %v", RekeningMeterai, NilaiTransaksiFC),
                NilaiKursManual:     1,
                NilaiEkuivalen:      float64(params.NilaiTransaksi),
                NomorReferensi:      params.NomorReferensi,
                FlagProses:          "F",
                KodeJurnal:          "11",
        }
        listDetilTrx = append(listDetilTrx, detilTrxDebit)

        detilTrxCredit := datastore.DetilTrx{
                JenisDetilTransaksi: "001",
                NomorRekening:       RekeningMeterai,
                JenisMutasi:         "C",
                NilaiMutasi:         float64(params.NilaiTransaksi),
                KodeCabang:          params.KodeCabangTransaksi,
                Keterangan:          fmt.Sprintf("Terima dari %v Nominal %v", rekNasabahTrx.NomorRekening.String, NilaiTransaksiFC),
                NilaiKursManual:     1,
                NilaiEkuivalen:      float64(params.NilaiTransaksi),
                NomorReferensi:      params.NomorReferensi,
                FlagProses:          "F",
                KodeJurnal:          "11",
        }
        listDetilTrx = append(listDetilTrx, detilTrxCredit)

        postTrx := data.PostTrx{
                DataTrx:  dataTrx,
                DetilTrx: listDetilTrx,
        }

        respTrx, err := f.Utils().GenericTrx(appCtx, tx, postTrx)
        if (err != nil &amp;&amp; err != sql.ErrNoRows) || respTrx.Status == "02" </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "err":     err,
                        "RespTrx": respTrx,
                        "Status":  respTrx.Status,
                        "Msg":     respTrx.Msg,
                }, nil, err.Error())

                result.Status = *utils.ECD
                result.Msg = err.Error()
                return
        }</span>

        <span class="cov1" title="1">idTransaksi := respTrx.Data.IdTransaksiFund
        infoTransaksi := datastore.InsertInfoTransaksi{
                IdTransaksi:            idTransaksi,
                NomorRekeningDebet:     rekNasabahTrx.NomorRekening.String,
                NomorRekeningKredit:    RekeningMeterai,
                NamaRekeningDebet:      rekNasabahTrx.NamaRekening.String,
                NamaRekeningKredit:     "Persediaan Benda Pos dan Materai",
                IsTunai:                "T",
                NominalTransaksi:       float64(params.NilaiTransaksi),
                NominalBiaya:           0.0,
                NomorRekeningTransaksi: rekNasabahTrx.NomorRekening.String,
                NamaRekeningTransaksi:  rekNasabahTrx.NamaRekening.String,
                NomorRekeningPair:      RekeningMeterai,
                NamaRekeningPair:       "Persediaan Benda Pos dan Materai",
                JenisMutasiTransaksi:   "D",
                JenisMutasiPair:        "K",
                CounterCetakValidasi:   "1",
                NominalTunaiFisik:      float64(params.NilaiTransaksi),
        }

        err = f.Store().InsertInfoTransaksi(appCtx, tx, infoTransaksi)
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "error":  err,
                        "params": infoTransaksi,
                }, nil, err.Error())
                err = errors.SystemError.Database

                result.Status = *utils.ECD
                result.Msg = err.Error()
                return
        }</span>

        <span class="cov1" title="1">InfoUidReq := datastore.InfoUidReq{
                ActionType: actionType,
                Uidkey:     params.Uidkey,
                UserInput:  params.UserInput,
                UserOtor:   params.UserOtorisasi,
                Keterangan: params.Keterangan,
                Info1:      rekNasabahTrx.NomorRekening.String,
                KodeCabang: params.KodeCabangTransaksi,
                Keyint:     respTrx.Data.IdTransaksiFund,
        }
        err = f.Store().InsertInfoUid(appCtx, tx, InfoUidReq)
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, err.Error())
                err = errors.SystemError.Database

                result.Status = *utils.ECD
                result.Msg = err.Error()
                return
        }</span>

        <span class="cov1" title="1">result.Status = utils.SUCCESS_CODE
        result.Msg = "Transaksi berhasil"
        result.Data.IdTransaksiFund = respTrx.Data.IdTransaksiFund
        return</span>
}

func (f *service) POST_BEA_BIAYA_CABANG(ctx context.Context, params data.PostTrxBeaBiayaCabang) (result data.RespTrx, err error) <span class="cov3" title="4">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("POST_BEA_BIAYA_CABANG %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()

        params.UserInput = strings.ToUpper(params.UserInput)

        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                err = errors.SystemError.InitDatabaseTransaction
                f.log.Error(logrus.Fields{"error": err}, nil, err.Error())

                result.Status = *utils.ECD
                result.Msg = err.Error()
                return
        }</span>

        <span class="cov2" title="3">defer f.TransactionStatusHandler(tx, &amp;err)

        if params.NomorReferensi == "" </span><span class="cov1" title="1">{
                err = fmt.Errorf("field nomor_referensi harus diisi")
                f.log.Warn(logrus.Fields{"nomor_referensi": params.NomorReferensi}, nil, err.Error())

                result.Status = *utils.ECD
                result.Msg = err.Error()

                return
        }</span>

        <span class="cov2" title="2">actionType := "POST_BEA_BIAYA"
        uidkeycek := datastore.ReqGetInfoUid{
                Uidkey:        params.Uidkey,
                ActionTypeCek: actionType,
        }
        resUID, err := f.Store().GetInfoUid(appCtx, tx, uidkeycek)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "resUID": resUID,
                        "error":  err,
                        "params": uidkeycek,
                }, nil, err.Error())
                err = errors.SystemError.Database

                result.Status = *utils.ECD
                result.Msg = err.Error()
                return
        }</span>

        <span class="cov2" title="2">var infoUid datastore.InfoUid
        if resUID != infoUid </span><span class="cov1" title="1">{
                err = fmt.Errorf("transaksi sudah diproses")
                f.log.Warn(logrus.Fields{"resUID": resUID}, nil, err.Error())

                result.Status = utils.SUCCESS_CODE
                result.Msg = err.Error()
                result.Data.IdTransaksiFund = resUID.Keyint.Int64
                return
        }</span>

        <span class="cov1" title="1">listDetilTrx := []datastore.DetilTrx{}
        NilaiTransaksiFC := f.CurrencyFormatStr(params.NilaiTransaksi, "D", 2, "Rp")
        keterangan := fmt.Sprintf("Transaksi Bea Biaya Cabang %v, Nominal %v", params.KodeCabangTransaksi, NilaiTransaksiFC)
        if params.Keterangan != "" </span><span class="cov0" title="0">{
                keterangan = params.Keterangan
        }</span>

        <span class="cov1" title="1">RekeningBebanMeterai := fmt.Sprintf("6551203-%v-%v", params.KodeCabangTransaksi, params.KodeValutaTransaksi)
        RekeningMeterai := fmt.Sprintf("1442202-%v-%v", params.KodeCabangTransaksi, params.KodeValutaTransaksi)

        dataTrx := data.DataTrx{
                NomorReferensi:      params.NomorReferensi,
                Keterangan:          keterangan,
                JenisAplikasi:       "A",
                KodeValutaTransaksi: params.KodeValutaTransaksi,
                KursManual:          1,
                NilaiTransaksi:      float64(params.NilaiTransaksi),
                KodeCabangTransaksi: params.KodeCabangTransaksi,
                IsSudahDijurnal:     "F",
                KodeTransaksi:       "BMBD",
                UserInput:           params.UserInput,
                UserOtorisasi:       params.UserOtorisasi,
        }

        detilTrxDebit := datastore.DetilTrx{
                JenisDetilTransaksi: "001",
                NomorRekening:       RekeningBebanMeterai,
                JenisMutasi:         "D",
                NilaiMutasi:         float64(params.NilaiTransaksi),
                KodeCabang:          params.KodeCabangTransaksi,
                Keterangan:          fmt.Sprintf("Kredit ke %v Nominal %v", RekeningMeterai, NilaiTransaksiFC),
                NilaiKursManual:     1,
                NilaiEkuivalen:      float64(params.NilaiTransaksi),
                NomorReferensi:      params.NomorReferensi,
                FlagProses:          "F",
                KodeJurnal:          "11",
        }
        listDetilTrx = append(listDetilTrx, detilTrxDebit)

        detilTrxCredit := datastore.DetilTrx{
                JenisDetilTransaksi: "001",
                NomorRekening:       RekeningMeterai,
                JenisMutasi:         "C",
                NilaiMutasi:         float64(params.NilaiTransaksi),
                KodeCabang:          params.KodeCabangTransaksi,
                Keterangan:          fmt.Sprintf("Terima dari %v Nominal %v", RekeningBebanMeterai, NilaiTransaksiFC),
                NilaiKursManual:     1,
                NilaiEkuivalen:      float64(params.NilaiTransaksi),
                NomorReferensi:      params.NomorReferensi,
                FlagProses:          "F",
                KodeJurnal:          "11",
        }
        listDetilTrx = append(listDetilTrx, detilTrxCredit)

        postTrx := data.PostTrx{
                DataTrx:  dataTrx,
                DetilTrx: listDetilTrx,
        }

        respTrx, err := f.Utils().GenericTrx(appCtx, tx, postTrx)
        if (err != nil &amp;&amp; err != sql.ErrNoRows) || respTrx.Status == "02" </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "err":     err,
                        "RespTrx": respTrx,
                        "Status":  respTrx.Status,
                        "Msg":     respTrx.Msg,
                }, nil, err.Error())

                result.Status = *utils.ECD
                result.Msg = err.Error()
                return
        }</span>

        <span class="cov1" title="1">idTransaksi := respTrx.Data.IdTransaksiFund
        infoTransaksi := datastore.InsertInfoTransaksi{
                IdTransaksi:            idTransaksi,
                NomorRekeningDebet:     RekeningBebanMeterai,
                NomorRekeningKredit:    RekeningMeterai,
                NamaRekeningDebet:      "Beban Benda Pos &amp; Meterai",
                NamaRekeningKredit:     "Persediaan Benda Pos &amp; Materai",
                IsTunai:                "T",
                NominalTransaksi:       float64(params.NilaiTransaksi),
                NominalBiaya:           0.0,
                NomorRekeningTransaksi: RekeningBebanMeterai,
                NamaRekeningTransaksi:  "Beban Benda Pos &amp; Meterai",
                NomorRekeningPair:      RekeningMeterai,
                NamaRekeningPair:       "Persediaan Benda Pos &amp; Materai",
                JenisMutasiTransaksi:   "D",
                JenisMutasiPair:        "K",
                CounterCetakValidasi:   "1",
                NominalTunaiFisik:      float64(params.NilaiTransaksi),
        }

        err = f.Store().InsertInfoTransaksi(appCtx, tx, infoTransaksi)
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "error":  err,
                        "params": infoTransaksi,
                }, nil, err.Error())
                err = errors.SystemError.Database

                result.Status = *utils.ECD
                result.Msg = err.Error()
                return
        }</span>

        <span class="cov1" title="1">InfoUidReq := datastore.InfoUidReq{
                ActionType: actionType,
                Uidkey:     params.Uidkey,
                UserInput:  params.UserInput,
                UserOtor:   params.UserOtorisasi,
                Keterangan: params.Keterangan,
                Info1:      RekeningBebanMeterai,
                KodeCabang: params.KodeCabangTransaksi,
                Keyint:     respTrx.Data.IdTransaksiFund,
        }
        err = f.Store().InsertInfoUid(appCtx, tx, InfoUidReq)
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, err.Error())
                err = errors.SystemError.Database

                result.Status = *utils.ECD
                result.Msg = err.Error()
                return
        }</span>

        <span class="cov1" title="1">result.Status = utils.SUCCESS_CODE
        result.Msg = "Transaksi berhasil"
        result.Data.IdTransaksiFund = respTrx.Data.IdTransaksiFund
        return</span>
}

// defer in app to handle panic &amp; commit/rollback db connection
func (f *service) TransactionStatusHandler(tx *sqlx.Tx, err *error) <span class="cov4" title="9">{
        // check panic
        if r := recover(); r != nil </span><span class="cov0" title="0">{
                f.Store().Rollback(tx)
                // Get the file and line information
                _, file, line, ok := runtime.Caller(2)
                if ok </span><span class="cov0" title="0">{
                        f.log.Error(logrus.Fields{"panic": r}, nil, fmt.Sprintf("Panic occurred at %s:%d\n", file, line))
                }</span>

                <span class="cov0" title="0">f.log.Error(logrus.Fields{"panic": r}, nil, "PANIC! process failed. Rollback occured.")
                f.log.Info(logrus.Fields{}, nil, "DB CONNECTION CLOSED")

                *err = fmt.Errorf("an unexpected error has occurred. Please contact technical team (PANIC)")
                return</span>
        }

        <span class="cov4" title="9">if *err != nil </span><span class="cov4" title="7">{
                f.Store().Rollback(tx)
                f.log.Error(logrus.Fields{"error": (*err).Error()}, nil, "process failed. Rollback occured.")
                f.log.Info(logrus.Fields{}, nil, "DB CONNECTION CLOSED")
                return
        }</span> else<span class="cov2" title="2"> {
                f.Store().Commit(tx)
                f.log.Info(logrus.Fields{}, nil, "process success. Commit occured.")
                f.log.Info(logrus.Fields{}, nil, "DB CONNECTION CLOSED")
                return
        }</span>

}

func (f *service) PanicHandler(tx *sqlx.Tx, err *error) <span class="cov10" title="144">{
        // f.Store().Rollback(tx)
        // f.log.Error(logrus.Fields{"error": (*err).Error()}, nil, "process failed. Rollback occured.")
        if r := recover(); r != nil </span><span class="cov0" title="0">{
                f.Store().Rollback(tx)
                // Get the file and line information
                _, file, line, ok := runtime.Caller(2)
                if ok </span><span class="cov0" title="0">{
                        f.log.Error(logrus.Fields{"panic": r}, nil, fmt.Sprintf("Panic occurred at %s:%d\n", file, line))
                }</span>

                <span class="cov0" title="0">f.log.Error(logrus.Fields{"panic": r}, nil, "PANIC! process failed. Rollback occured.")
                f.log.Info(logrus.Fields{}, nil, "DB CONNECTION CLOSED")

                *err = fmt.Errorf("an unexpected error has occurred. Please contact technical team (PANIC)")
                return</span>
        }
}
</pre>
		
		<pre class="file" id="file9" style="display: none">package app

import (
        "context"
        "database/sql"
        "fmt"
        "fundtx/data"
        "fundtx/datastore"

        "math"
        "strconv"
        "strings"
        "time"

        "fundtx/pkg/errors"
        "fundtx/pkg/logging/utils"

        "github.com/jmoiron/sqlx"
        "github.com/sirupsen/logrus"
        "go.opentelemetry.io/otel/attribute"
        otel_code "go.opentelemetry.io/otel/codes"
)

func sum(numbers []int) int <span class="cov0" title="0">{
        total := 0
        for _, n := range numbers </span><span class="cov0" title="0">{
                total += n
        }</span>
        <span class="cov0" title="0">return total</span>
}

func digitsOf(sNumber string) []int <span class="cov0" title="0">{
        digs := make([]int, 0, len(sNumber))
        for _, d := range sNumber </span><span class="cov0" title="0">{
                if digit, err := strconv.Atoi(string(d)); err == nil </span><span class="cov0" title="0">{
                        digs = append(digs, digit)
                }</span>
        }
        <span class="cov0" title="0">return digs</span>
}

func (f *service) CurrencyFormatStr(dValue float64, formatType string, floatPrecision int, currencySymbol string) string <span class="cov9" title="17">{
        pemisahRibuan := ","
        pemisahDesimal := "."
        var sNominalBulat, sNominalDesimal, currFormat string

        if formatType == "I" </span><span class="cov0" title="0">{
                sNominal := strconv.Itoa(int(dValue))
                sNominalBulat = sNominal
                sNominalDesimal = ""
        }</span> else<span class="cov9" title="17"> if formatType == "D" </span><span class="cov9" title="17">{
                sNominal := strconv.FormatFloat(dValue, 'f', floatPrecision, 64)
                lsNominal := strings.Split(sNominal, ".")
                sNominalBulat = lsNominal[0]
                sNominalDesimal = lsNominal[1]
        }</span> else<span class="cov0" title="0"> {
                panic("Undefined format type.")</span>
        }

        <span class="cov9" title="17">lenNom := len(sNominalBulat)
        iterRibuan := lenNom / 3
        iterRibuanSisa := lenNom - (iterRibuan * 3)
        currFormat = sNominalBulat[:iterRibuanSisa]

        for i := 0; i &lt; int(iterRibuan); i++ </span><span class="cov8" title="14">{
                if currFormat != "" </span><span class="cov7" title="9">{
                        currFormat += pemisahRibuan
                }</span>
                <span class="cov8" title="14">currFormat += sNominalBulat[iterRibuanSisa+(i*3) : iterRibuanSisa+((i+1)*3)]</span>
        }

        <span class="cov9" title="17">if formatType == "D" </span><span class="cov9" title="17">{
                currFormat += pemisahDesimal + sNominalDesimal
                if floatPrecision &gt; 0 </span><span class="cov9" title="17">{
                        currFormat += strings.Repeat("0", floatPrecision-len(sNominalDesimal))
                }</span>
        }

        <span class="cov9" title="17">return currFormat</span>
}

func (f *service) GenericTrx(ctx context.Context, tx *sqlx.Tx, params data.PostTrx) (RespTrx data.RespTrx, err error) <span class="cov9" title="18">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GenericTrx %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        TransaksiID, err := f.Store().GetTransaksiID(appCtx, tx)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"error": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov9" title="17">nomorSeri, err := utils.GetNomorSeri(TransaksiID.IdTransaksi)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (IS05)"
                f.log.Error(logrus.Fields{"error": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov9" title="17">PodValue, err := f.Store().GetPod(appCtx, tx)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov8" title="16">podDt, err := utils.FormatDate(PodValue.Today)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (IS02)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov8" title="16">y := podDt.Year()
        m := podDt.Month()
        idCode := fmt.Sprintf("%s.%d.%02d", params.DataTrx.KodeTransaksi, y, m)
        CustomIdgenReq := datastore.CustomIdgen{
                Idname: "Journal",
                Idcode: idCode,
                Locked: "F",
        }
        CustomIdgen, err := f.Store().GetCustomIdgen(appCtx, tx, CustomIdgenReq)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "CustomIdgen": CustomIdgen,
                        "error":       err,
                        "params":      CustomIdgenReq,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov8" title="16">var journalNo string
        if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                err = f.Store().InsertCustomIdgen(appCtx, tx, CustomIdgenReq)
                if err != nil </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "error": err,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrx.Status = "02"
                        RespTrx.Msg = remark
                        return
                }</span>
                <span class="cov0" title="0">journalNo = fmt.Sprintf("%s.%07d", idCode, 1)</span>
        }

        <span class="cov8" title="16">if CustomIdgen.LastIdGen != 0 </span><span class="cov0" title="0">{
                journalNo = fmt.Sprintf("%s.%07d", idCode, CustomIdgen.LastIdGen)
        }</span>

        <span class="cov8" title="16">InputDataTransaksi := datastore.InputDataTransaksi{
                IdTransaksi:         TransaksiID.IdTransaksi,
                NomorReferensi:      params.DataTrx.NomorReferensi,
                Keterangan:          params.DataTrx.Keterangan,
                JenisAplikasi:       params.DataTrx.JenisAplikasi,
                KodeValutaTransaksi: params.DataTrx.KodeValutaTransaksi,
                KursManual:          params.DataTrx.KursManual,
                NilaiTransaksi:      params.DataTrx.NilaiTransaksi,
                NilaiEkuivalen:      params.DataTrx.NilaiTransaksi * params.DataTrx.KursManual,
                KodeCabangTransaksi: params.DataTrx.KodeCabangTransaksi,
                IsSudahDijurnal:     params.DataTrx.IsSudahDijurnal,
                KodeTransaksi:       params.DataTrx.KodeTransaksi,
                StatusOtorisasi:     1,
                NomorSeri:           nomorSeri,
                JournalNo:           journalNo,
                NomorCounter:        0,
                UserInput:           params.DataTrx.UserInput,
                UserOtorisasi:       params.DataTrx.UserOtorisasi,
                TanggalTransaksi:    podDt,
                TanggalOtorisasi:    podDt,
                Biaya:               params.DataTrx.Biaya,
                TerminalInput:       "",
                TerminalOtorisasi:   "",
                Channelname:         params.DataTrx.Channelname,
                IsReverseAllowed:    params.DataTrx.IsReverseAllowed,
        }

        err = f.Store().PostTransaksi(appCtx, tx, InputDataTransaksi)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov8" title="16">for _, dt := range params.DetilTrx </span><span class="cov8" title="16">{
                var GALAT = -0.001
                var Amount = 0.00
                ASSTMNE := map[string]interface{}{
                        "D": 1,
                        "C": -1,
                }

                LIABMNE := map[string]interface{}{
                        "D": -1,
                        "C": 1,
                }

                MNEMONICS := map[string]interface{}{
                        "001": ASSTMNE,
                        "002": LIABMNE,
                        "003": ASSTMNE,
                        "004": ASSTMNE,
                        "006": ASSTMNE,
                }

                Amount = float64(MNEMONICS[dt.JenisDetilTransaksi].(map[string]interface{})[dt.JenisMutasi].(int)) * dt.NilaiMutasi
                NomorRekening := dt.NomorRekening
                KodeAccount := ""
                KodeCabang := ""
                KodeValuta := ""
                KodeJDT := ""
                JenisTransaksiLiabilitas := ""

                if dt.JenisDetilTransaksi == "004" </span><span class="cov6" title="6">{
                        var RekKasTrx datastore.RekKasTrx
                        RekKasTrx, err = f.Store().ValidasiRekKasTrx(appCtx, tx, dt.NomorRekening)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "RekKasTrx": RekKasTrx,
                                        "error":     err,
                                        "params":    dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov5" title="5">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Nomor rekening kas %s tidak valid. Silahkan hubungi customer suport", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov4" title="4">if RekKasTrx.StatusRekening.Int32 == 3 </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Status rekening %s sudah tutup. Rekening dengan status tutup tidak boleh melakukan transaksi", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov4" title="3">if (RekKasTrx.SaldoEfektif.Float64 + Amount) &lt; GALAT </span><span class="cov1" title="1">{
                                SaldoEfektif1 := f.CurrencyFormatStr(float64(RekKasTrx.SaldoEfektif.Float64), "D", 2, "Rp")
                                NilaiMutasi1 := f.CurrencyFormatStr(float64(dt.NilaiMutasi), "D", 2, "Rp")
                                remark := fmt.Sprintf("Saldo efektif rekening %v tidak cukup untuk transaksi %v sebesar %v. Saldo efektif saat ini %v", dt.NomorRekening, dt.Keterangan, NilaiMutasi1, SaldoEfektif1)
                                f.log.Warn(logrus.Fields{
                                        "SaldoEfektif": RekKasTrx.SaldoEfektif.Float64,
                                        "Amount":       Amount,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov2" title="2">err = f.Store().TrxForUpdate(appCtx, tx, dt.NomorRekening)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error":  err,
                                        "params": dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">err = f.Store().UpdateSaldoRekeningTransaksi(appCtx, tx, dt.NomorRekening, Amount)
                        if err != nil </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "err": err,
                                }, nil, remark)
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">KodeAccount = RekKasTrx.KodeAccount.String
                        KodeCabang = RekKasTrx.KodeCabang.String
                        KodeValuta = RekKasTrx.KodeValuta.String
                        KodeJDT = "K"</span>

                } else<span class="cov7" title="10"> if dt.JenisDetilTransaksi == "001" </span><span class="cov4" title="4">{
                        var RekGLTrx datastore.RekGLTrx
                        RekGLTrx, err = f.Store().ValidasiRekGLTrx(appCtx, tx, dt.NomorRekening)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "RekGLTrx": RekGLTrx,
                                        "error":    err,
                                        "params":   dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>
                        <span class="cov4" title="4">fmt.Println(RekGLTrx)
                        if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Nomor rekening GL %s tidak valid. Silahkan hubungi customer suport", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        // if (RekGLTrx.BalanceSign.Float64 == 1) || (RekGLTrx.BalanceSign.Float64 == 1.00) {
                        //         Amount = float64(LIABMNE[dt.JenisMutasi].(int)) * dt.NilaiMutasi
                        // }

                        <span class="cov4" title="3">if (RekGLTrx.TrxPermitType.String == "0") &amp;&amp; (params.DataTrx.KodeTransaksi != "TTR") </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Rekening GL %s tidak diperbolehkan bertransaksi untuk kode transaksi %s", dt.NomorRekening, params.DataTrx.KodeTransaksi)
                                f.log.Warn(logrus.Fields{
                                        "TrxPermitType": RekGLTrx.TrxPermitType.String,
                                        "KodeTransaksi": params.DataTrx.KodeTransaksi,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov2" title="2">if (RekGLTrx.TrxPermitType.String == "1") &amp;&amp; (params.DataTrx.KodeCabangTransaksi != RekGLTrx.KodeCabang.String) </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Rekening GL %s tidak boleh bertransaksi antar cabang", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "TrxPermitType": RekGLTrx.TrxPermitType.String,
                                        "KodeTransaksi": params.DataTrx.KodeTransaksi,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        // if RekGLTrx.NormalBalanceType.String != "N" {
                        //         var BalanceToday datastore.BalanceToday
                        //         BalanceToday, err = f.Store().GetBalanceToday(appCtx, tx, PodValue.Today, RekGLTrx.AccountinstanceId.Int64)
                        //         if err != nil &amp;&amp; err != sql.ErrNoRows {
                        //                 remark := "there was a problem, please contact customer support (DB01)"
                        //                 f.log.Error(logrus.Fields{
                        //                         "BalanceToday": BalanceToday,
                        //                         "error":        err,
                        //                         "params1":      PodValue.Today,
                        //                         "params2":      RekGLTrx.AccountinstanceId.Int64,
                        //                 }, nil, err.Error())
                        //                 f.Store().Rollback(tx)

                        //                 RespTrx.Status = "02"
                        //                 RespTrx.Msg = remark
                        //                 return
                        //         }

                        //         CurrentBalance := RekGLTrx.Balance.Float64 + BalanceToday.TotalToday.Float64

                        //         if ((CurrentBalance + Amount) &lt; GALAT) &amp;&amp; (((RekGLTrx.BalanceSign.Float64 == 1 || RekGLTrx.BalanceSign.Float64 == 1.00) &amp;&amp; RekGLTrx.NormalBalanceType.String == "K") || ((RekGLTrx.BalanceSign.Float64 == -1 || RekGLTrx.BalanceSign.Float64 == -1.00) &amp;&amp; RekGLTrx.NormalBalanceType.String == "D")) {
                        //                 remark := fmt.Sprintf("Saldo rekening %s Tidak Cukup. Saldo saat ini %f", dt.NomorRekening, CurrentBalance)
                        //                 f.log.Error(logrus.Fields{
                        //                         "CurrentBalance":    CurrentBalance,
                        //                         "Amount":            Amount,
                        //                         "BalanceSign":       RekGLTrx.BalanceSign.Float64,
                        //                         "NormalBalanceType": RekGLTrx.NormalBalanceType.String,
                        //                 }, nil, "log info")
                        //                 f.Store().Rollback(tx)
                        //                 RespTrx.Status = "02"
                        //                 RespTrx.Msg = remark
                        //                 return
                        //         }

                        //         if ((CurrentBalance + Amount) &gt; math.Abs(GALAT)) &amp;&amp; (((RekGLTrx.BalanceSign.Float64 == 1 || RekGLTrx.BalanceSign.Float64 == 1.00) &amp;&amp; RekGLTrx.NormalBalanceType.String == "D") || ((RekGLTrx.BalanceSign.Float64 == -1 || RekGLTrx.BalanceSign.Float64 == -1.00) &amp;&amp; RekGLTrx.NormalBalanceType.String == "K")) {
                        //                 remark := fmt.Sprintf("Saldo rekening %s Tidak Cukup. Saldo saat ini %f", dt.NomorRekening, CurrentBalance)
                        //                 f.log.Error(logrus.Fields{
                        //                         "CurrentBalance":    CurrentBalance,
                        //                         "Amount":            Amount,
                        //                         "BalanceSign":       RekGLTrx.BalanceSign.Float64,
                        //                         "NormalBalanceType": RekGLTrx.NormalBalanceType.String,
                        //                 }, nil, "log info")
                        //                 f.Store().Rollback(tx)

                        //                 RespTrx.Status = "02"
                        //                 RespTrx.Msg = remark
                        //                 return
                        //         }
                        // }

                        <span class="cov1" title="1">KodeAccount = RekGLTrx.KodeAccount.String
                        KodeCabang = RekGLTrx.KodeCabang.String
                        KodeValuta = RekGLTrx.KodeValuta.String</span>

                } else<span class="cov6" title="6"> if dt.JenisDetilTransaksi == "006" </span><span class="cov2" title="2">{
                        var RekKodeInterfaceTrx datastore.RekKodeInterfaceTrx
                        RekKodeInterfaceTrx, err = f.Store().ValidasiRekKodeInterfaceTrx(appCtx, tx, dt.KodeCabang, dt.NomorRekening)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "RekKodeInterfaceTrx": RekKodeInterfaceTrx,
                                        "error":               err,
                                        "params1":             dt.KodeCabang,
                                        "params2":             dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Nomor rekening %s tidak valid. Silahkan hubungi customer support", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov0" title="0">NomorRekening = RekKodeInterfaceTrx.NomorRekening.String
                        KodeAccount = RekKodeInterfaceTrx.KodeAccount.String
                        KodeCabang = RekKodeInterfaceTrx.KodeCabang.String
                        KodeValuta = RekKodeInterfaceTrx.KodeValuta.String</span>
                } else<span class="cov4" title="4"> if dt.JenisDetilTransaksi == "002" </span><span class="cov4" title="4">{
                        JenisTransaksiLiabilitas = "C"
                        var RekLiabTrx datastore.RekLiabTrx
                        RekLiabTrx, err = f.Store().ValidasiRekLiabTrx(appCtx, tx, dt.NomorRekening)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "RekLiabTrx": RekLiabTrx,
                                        "error":      err,
                                        "params1":    dt.KodeCabang,
                                        "params2":    dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov4" title="3">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Nomor rekening %s tidak valid. Silahkan hubungi customer support", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov2" title="2">if RekLiabTrx.StatusRekening.Int32 == 3 </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Status rekening %s sudah tutup. Rekening dengan status tutup tidak boleh melakukan transaksi", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov1" title="1">if (dt.JenisMutasi == "D") &amp;&amp; ((RekLiabTrx.SaldoEfektif.Float64 + Amount) &lt; GALAT) &amp;&amp; (params.DataTrx.KodeTransaksi != "TTR") </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Saldo efektif rekening %v tidak cukup untuk transaksi debet.", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "SaldoEfektif": RekLiabTrx.SaldoEfektif.Float64,
                                        "Amount":       Amount,
                                        "GALAT":        GALAT,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov0" title="0">err = f.Store().TrxForUpdate(appCtx, tx, dt.NomorRekening)
                        if err != nil </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error":  err,
                                        "params": dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov0" title="0">err = f.Store().UpdateSaldoRekeningTransaksi(appCtx, tx, dt.NomorRekening, Amount)
                        if err != nil </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "err": err,
                                }, nil, remark)
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov0" title="0">KodeAccount = RekLiabTrx.KodeAccount.String
                        KodeCabang = RekLiabTrx.KodeCabang.String
                        KodeValuta = RekLiabTrx.KodeValuta.String
                        KodeJDT = "L"</span>

                } else<span class="cov0" title="0"> {
                        err = fmt.Errorf("JenisDetilTransaksi %s tidak valid. Silahkan hubungi customer suport", dt.JenisDetilTransaksi)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrx.Status = "02"
                        RespTrx.Msg = err.Error()

                        return
                }</span>

                // IsCR := ""
                // if params.DataTrx.KodeTransaksi == "SKN" || params.DataTrx.KodeTransaksi == "RTGS" {
                //         IsCR = "T"
                // }

                <span class="cov2" title="2">InputDetilTransaksi := datastore.InputDataTransaksiDetail{
                        TanggalTransaksi:         podDt,
                        JenisMutasi:              dt.JenisMutasi,
                        NilaiMutasi:              dt.NilaiMutasi,
                        Keterangan:               dt.Keterangan,
                        KodeCabang:               KodeCabang,
                        KodeValuta:               KodeValuta,
                        JenisDetilTransaksi:      KodeJDT,
                        NilaiKursManual:          dt.NilaiKursManual,
                        SaldoAwal:                0.0,
                        NilaiEkuivalen:           dt.NilaiEkuivalen,
                        NomorReferensi:           dt.NomorReferensi,
                        KodeJurnal:               dt.KodeJurnal,
                        IdTransaksi:              TransaksiID.IdTransaksi,
                        KodeAccount:              KodeAccount,
                        KodeValutaRak:            dt.KodeValutaRak,
                        NomorRekening:            NomorRekening,
                        JenisTransaksiLiabilitas: JenisTransaksiLiabilitas,
                        IdParameterTransaksi:     "",
                        FlagProses:               dt.FlagProses,
                        Sequence:                 1,
                        Isbillertransaction:      "F",
                        HidePassbook:             "F",
                        HideStatement:            "F",
                        HideGentrans:             "F",
                        NominalBiaya:             0.00,
                        IsCreateRemittance:       dt.IsCreateRemittance,
                        KodeTxClass:              dt.KodeTxClass,
                        NomorSeriWarkat:          dt.NomorSeriWarkat,
                        FlagCode:                 dt.FlagCode,
                        KodeRc:                   dt.KodeRc,
                }

                var IdTransaksiDetailData int64
                if dt.IdDetilTransaksi == 0 </span><span class="cov0" title="0">{
                        IdTransaksiDetailData, err = f.Store().GetTransaksiDetailID(appCtx, tx)
                        if err != nil </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{"error": err}, nil, remark)
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>
                } else<span class="cov2" title="2"> {
                        IdTransaksiDetailData = dt.IdDetilTransaksi
                }</span>

                <span class="cov2" title="2">InputDetilTransaksi.IdDetailTransaksi = IdTransaksiDetailData
                err = f.Store().PostDetailTrx2(appCtx, tx, InputDetilTransaksi)
                if err != nil </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "err": err,
                        }, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrx.Status = "02"
                        RespTrx.Msg = remark
                        return
                }</span>

                <span class="cov2" title="2">if dt.JenisDetilTransaksi == "004" </span><span class="cov1" title="1">{
                        InsertTransaksiTransitKas := datastore.InsertTransaksiTransitKas{
                                IdDetilTransaksi: IdTransaksiDetailData,
                        }
                        err = f.Store().InsertTransaksiTransitKas(appCtx, tx, InsertTransaksiTransitKas)
                        if err != nil </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "err": err,
                                }, nil, remark)
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                }
        }

        <span class="cov2" title="2">RespTrx.Data.IdTransaksiFund = TransaksiID.IdTransaksi

        err = f.Store().InsertPendingTrxJournal(appCtx, tx, TransaksiID.IdTransaksi)
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "error": err,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = err.Error()
                return
        }</span>

        <span class="cov2" title="2">journalReq := data.CreateJournalReq{
                IdTransaksi: TransaksiID.IdTransaksi,
                Date:        PodValue.Today,
        }
        err = f.CreateJournal(ctx, tx, journalReq)
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "error": err,
                }, nil, err.Error())
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = err.Error()
                return
        }</span>
        <span class="cov2" title="2">appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}

func (f *service) GenericTrxRev(ctx context.Context, tx *sqlx.Tx, params data.PostTrx) (RespTrx data.RespAutoRevTrx, err error) <span class="cov10" title="23">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("GenericTrxRev %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        TransaksiID, err := f.Store().GetTransaksiID(appCtx, tx)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"error": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov9" title="22">nomorSeri, err := utils.GetNomorSeri(TransaksiID.IdTransaksi)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (IS05)"
                f.log.Error(logrus.Fields{"error": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov9" title="22">PodValue, err := f.Store().GetPod(appCtx, tx)
        if err != nil </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov9" title="21">podDt, err := utils.FormatDate(PodValue.Today)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (IS02)"
                f.log.Error(logrus.Fields{"err": err}, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov9" title="21">y := podDt.Year()
        m := podDt.Month()
        idCode := fmt.Sprintf("%s.%d.%02d", params.DataTrx.KodeTransaksi, y, m)
        CustomIdgenReq := datastore.CustomIdgen{
                Idname: "Journal",
                Idcode: idCode,
                Locked: "F",
        }
        CustomIdgen, err := f.Store().GetCustomIdgen(appCtx, tx, CustomIdgenReq)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                err = fmt.Errorf(remark)
                f.log.Error(logrus.Fields{
                        "CustomIdgen": CustomIdgen,
                        "error":       err,
                        "params":      CustomIdgenReq,
                }, nil, err.Error())
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov9" title="21">var journalNo string
        if err == sql.ErrNoRows </span><span class="cov0" title="0">{
                err = f.Store().InsertCustomIdgen(appCtx, tx, CustomIdgenReq)
                if err != nil </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "error": err,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrx.Status = "02"
                        RespTrx.Msg = remark
                        return
                }</span>
                <span class="cov0" title="0">journalNo = fmt.Sprintf("%s.%07d", idCode, 1)</span>
        }

        <span class="cov9" title="21">if CustomIdgen.LastIdGen != 0 </span><span class="cov9" title="17">{
                journalNo = fmt.Sprintf("%s.%07d", idCode, CustomIdgen.LastIdGen)
        }</span>

        <span class="cov9" title="21">InputDataTransaksi := datastore.InputDataTransaksi{
                IdTransaksi:         TransaksiID.IdTransaksi,
                NomorReferensi:      params.DataTrx.NomorReferensi,
                Keterangan:          params.DataTrx.Keterangan,
                JenisAplikasi:       params.DataTrx.JenisAplikasi,
                KodeValutaTransaksi: params.DataTrx.KodeValutaTransaksi,
                KursManual:          params.DataTrx.KursManual,
                NilaiTransaksi:      params.DataTrx.NilaiTransaksi,
                NilaiEkuivalen:      params.DataTrx.NilaiTransaksi * params.DataTrx.KursManual,
                KodeCabangTransaksi: params.DataTrx.KodeCabangTransaksi,
                IsSudahDijurnal:     params.DataTrx.IsSudahDijurnal,
                KodeTransaksi:       params.DataTrx.KodeTransaksi,
                StatusOtorisasi:     1,
                NomorSeri:           nomorSeri,
                JournalNo:           journalNo,
                NomorCounter:        0,
                UserInput:           params.DataTrx.UserInput,
                UserOtorisasi:       params.DataTrx.UserOtorisasi,
                TanggalTransaksi:    podDt,
                TanggalOtorisasi:    podDt,
                Biaya:               params.DataTrx.Biaya,
                TerminalInput:       "",
                TerminalOtorisasi:   "",
                Channelname:         params.DataTrx.Channelname,
                IsReverseAllowed:    params.DataTrx.IsReverseAllowed,
        }

        err = f.Store().PostTransaksi(appCtx, tx, InputDataTransaksi)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov9" title="21">for _, dt := range params.DetilTrx </span><span class="cov9" title="21">{
                var GALAT = -0.001
                var Amount = 0.00
                ASSTMNE := map[string]interface{}{
                        "D": 1,
                        "C": -1,
                }

                LIABMNE := map[string]interface{}{
                        "D": -1,
                        "C": 1,
                }

                MNEMONICS := map[string]interface{}{
                        "G": ASSTMNE,
                        "C": LIABMNE,
                        "K": ASSTMNE,
                }

                var RekeningTransaksi datastore.RekeningTransaksi
                RekeningTransaksi, err = f.Store().GetRekeningTransaksi(appCtx, tx, dt.NomorRekening)
                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "RekeningTransaksi": RekeningTransaksi,
                                "error":             err,
                                "params":            dt.NomorRekening,
                        }, nil, err.Error())
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrx.Status = "02"
                        RespTrx.Msg = remark
                        return
                }</span>

                <span class="cov9" title="21">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := fmt.Sprintf("Nomor rekening %s tidak terdaftar di rekeningtransaksi", dt.NomorRekening)
                        f.log.Warn(logrus.Fields{
                                "err": err,
                        }, nil, "log info")
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        err = fmt.Errorf(remark)

                        RespTrx.Status = "02"
                        RespTrx.Msg = remark

                        return
                }</span>

                <span class="cov9" title="20">JenisRekeningTransaksi := RekeningTransaksi.JenisRekeningTransaksi.String

                Amount = float64(MNEMONICS[RekeningTransaksi.JenisRekeningTransaksi.String].(map[string]interface{})[dt.JenisMutasi].(int)) * dt.NilaiMutasi
                NomorRekening := dt.NomorRekening
                KodeAccount := ""
                KodeCabang := ""
                KodeValuta := ""
                KodeJDT := ""
                JenisTransaksiLiabilitas := ""

                if JenisRekeningTransaksi == "K" </span><span class="cov6" title="6">{
                        var RekKasTrx datastore.RekKasTrx
                        RekKasTrx, err = f.Store().ValidasiRekKasTrx(appCtx, tx, dt.NomorRekening)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "RekKasTrx": RekKasTrx,
                                        "error":     err,
                                        "params":    dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov5" title="5">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Nomor rekening kas %s tidak valid. Silahkan hubungi customer suport", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov4" title="4">if RekKasTrx.StatusRekening.Int32 == 3 </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Status rekening %s sudah tutup. Rekening dengan status tutup tidak boleh melakukan transaksi", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov4" title="3">if (RekKasTrx.SaldoEfektif.Float64 + Amount) &lt; GALAT </span><span class="cov1" title="1">{
                                SaldoEfektif1 := f.CurrencyFormatStr(float64(RekKasTrx.SaldoEfektif.Float64), "D", 2, "Rp")
                                NilaiMutasi1 := f.CurrencyFormatStr(float64(dt.NilaiMutasi), "D", 2, "Rp")
                                remark := fmt.Sprintf("Saldo efektif rekening %v tidak cukup untuk transaksi %v sebesar %v. Saldo efektif saat ini %v", dt.NomorRekening, dt.Keterangan, NilaiMutasi1, SaldoEfektif1)
                                f.log.Warn(logrus.Fields{
                                        "SaldoEfektif": RekKasTrx.SaldoEfektif.Float64,
                                        "Amount":       Amount,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov2" title="2">err = f.Store().TrxForUpdate(appCtx, tx, dt.NomorRekening)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error":  err,
                                        "params": dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">err = f.Store().UpdateSaldoRekeningTransaksi(appCtx, tx, dt.NomorRekening, Amount)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "err": err,
                                }, nil, remark)
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov0" title="0">KodeAccount = RekKasTrx.KodeAccount.String
                        KodeCabang = RekKasTrx.KodeCabang.String
                        KodeValuta = RekKasTrx.KodeValuta.String
                        KodeJDT = "K"</span>

                } else<span class="cov8" title="14"> if JenisRekeningTransaksi == "G" </span><span class="cov6" title="8">{
                        var RekGLTrx datastore.RekGLTrx
                        RekGLTrx, err = f.Store().ValidasiRekGLTrx(appCtx, tx, dt.NomorRekening)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "RekGLTrx": RekGLTrx,
                                        "error":    err,
                                        "params":   dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov6" title="8">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Nomor rekening GL %s tidak valid. Silahkan hubungi customer suport", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov6" title="7">if (RekGLTrx.BalanceSign.Float64 == 1) || (RekGLTrx.BalanceSign.Float64 == 1.00) </span><span class="cov4" title="4">{
                                Amount = float64(LIABMNE[dt.JenisMutasi].(int)) * dt.NilaiMutasi
                        }</span>

                        <span class="cov6" title="7">if (RekGLTrx.TrxPermitType.String == "0") &amp;&amp; (params.DataTrx.KodeTransaksi != "TTR") </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Rekening GL %s tidak diperbolehkan bertransaksi untuk kode transaksi %s", dt.NomorRekening, params.DataTrx.KodeTransaksi)
                                f.log.Warn(logrus.Fields{
                                        "TrxPermitType": RekGLTrx.TrxPermitType.String,
                                        "KodeTransaksi": params.DataTrx.KodeTransaksi,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov6" title="6">if (RekGLTrx.TrxPermitType.String == "1") &amp;&amp; (params.DataTrx.KodeCabangTransaksi != RekGLTrx.KodeCabang.String) </span><span class="cov2" title="2">{
                                remark := fmt.Sprintf("Rekening GL %s tidak boleh bertransaksi antar cabang", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "TrxPermitType": RekGLTrx.TrxPermitType.String,
                                        "KodeTransaksi": params.DataTrx.KodeTransaksi,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov4" title="4">if RekGLTrx.NormalBalanceType.String != "N" </span><span class="cov4" title="3">{
                                var BalanceToday datastore.BalanceToday
                                BalanceToday, err = f.Store().GetBalanceToday(appCtx, tx, PodValue.Today, RekGLTrx.AccountinstanceId.Int64)
                                if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov2" title="2">{
                                        remark := "there was a problem, please contact customer support (DB01)"
                                        f.log.Error(logrus.Fields{
                                                "BalanceToday": BalanceToday,
                                                "error":        err,
                                                "params1":      PodValue.Today,
                                                "params2":      RekGLTrx.AccountinstanceId.Int64,
                                        }, nil, err.Error())
                                        f.Store().Rollback(tx)
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        RespTrx.Status = "02"
                                        RespTrx.Msg = remark
                                        return
                                }</span>

                                <span class="cov1" title="1">CurrentBalance := RekGLTrx.Balance.Float64 + BalanceToday.TotalToday.Float64

                                if ((CurrentBalance + Amount) &lt; GALAT) &amp;&amp; (((RekGLTrx.BalanceSign.Float64 == 1 || RekGLTrx.BalanceSign.Float64 == 1.00) &amp;&amp; RekGLTrx.NormalBalanceType.String == "K") || ((RekGLTrx.BalanceSign.Float64 == -1 || RekGLTrx.BalanceSign.Float64 == -1.00) &amp;&amp; RekGLTrx.NormalBalanceType.String == "D")) </span><span class="cov1" title="1">{
                                        CurrentBalance1 := f.CurrencyFormatStr(float64(CurrentBalance), "D", 2, "Rp")
                                        NilaiMutasi1 := f.CurrencyFormatStr(float64(dt.NilaiMutasi), "D", 2, "Rp")
                                        remark := fmt.Sprintf("Saldo rekening %v tidak cukup untuk transaksi %v sebesar %v. Saldo saat ini %v", dt.NomorRekening, dt.Keterangan, NilaiMutasi1, CurrentBalance1)
                                        f.log.Error(logrus.Fields{
                                                "CurrentBalance":    CurrentBalance,
                                                "Amount":            Amount,
                                                "BalanceSign":       RekGLTrx.BalanceSign.Float64,
                                                "NormalBalanceType": RekGLTrx.NormalBalanceType.String,
                                        }, nil, "log info")
                                        f.Store().Rollback(tx)

                                        err = fmt.Errorf(remark)
                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        RespTrx.Status = "02"
                                        RespTrx.Msg = remark
                                        return
                                }</span>

                                <span class="cov0" title="0">if ((CurrentBalance + Amount) &gt; math.Abs(GALAT)) &amp;&amp; (((RekGLTrx.BalanceSign.Float64 == 1 || RekGLTrx.BalanceSign.Float64 == 1.00) &amp;&amp; RekGLTrx.NormalBalanceType.String == "D") || ((RekGLTrx.BalanceSign.Float64 == -1 || RekGLTrx.BalanceSign.Float64 == -1.00) &amp;&amp; RekGLTrx.NormalBalanceType.String == "K")) </span><span class="cov0" title="0">{
                                        remark := fmt.Sprintf("Saldo rekening %s Tidak Cukup", dt.NomorRekening)
                                        f.log.Error(logrus.Fields{
                                                "CurrentBalance":    CurrentBalance,
                                                "Amount":            Amount,
                                                "BalanceSign":       RekGLTrx.BalanceSign.Float64,
                                                "NormalBalanceType": RekGLTrx.NormalBalanceType.String,
                                        }, nil, "log info")
                                        f.Store().Rollback(tx)

                                        err = fmt.Errorf(remark)

                                        appSpan.RecordError(err)
                                        appSpan.SetStatus(otel_code.Error, err.Error())

                                        RespTrx.Status = "02"
                                        RespTrx.Msg = remark
                                        return
                                }</span>
                        }

                        <span class="cov1" title="1">KodeAccount = RekGLTrx.KodeAccount.String
                        KodeCabang = RekGLTrx.KodeCabang.String
                        KodeValuta = RekGLTrx.KodeValuta.String</span>

                } else<span class="cov6" title="6"> if JenisRekeningTransaksi == "C" </span><span class="cov6" title="6">{
                        JenisTransaksiLiabilitas = "C"
                        var RekLiabTrx datastore.RekLiabTrx
                        RekLiabTrx, err = f.Store().ValidasiRekLiabTrx(appCtx, tx, dt.NomorRekening)
                        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "RekLiabTrx": RekLiabTrx,
                                        "error":      err,
                                        "params1":    dt.KodeCabang,
                                        "params2":    dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov5" title="5">if err == sql.ErrNoRows </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Nomor rekening liabilitas %s tidak valid. Silahkan hubungi customer suport", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov4" title="4">if RekLiabTrx.StatusRekening.Int32 == 3 &amp;&amp; !params.DataTrx.IsBolehStatusTutup </span><span class="cov1" title="1">{
                                remark := fmt.Sprintf("Status rekening %s sudah tutup. Rekening dengan status tutup tidak boleh melakukan transaksi", dt.NomorRekening)
                                f.log.Warn(logrus.Fields{
                                        "err": err,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov4" title="3">if (dt.JenisMutasi == "D") &amp;&amp; ((RekLiabTrx.SaldoEfektif.Float64 + Amount) &lt; GALAT) &amp;&amp; (params.DataTrx.KodeTransaksi != "TTR") </span><span class="cov1" title="1">{
                                SaldoEfektif1 := f.CurrencyFormatStr(float64(RekLiabTrx.SaldoEfektif.Float64), "D", 2, "Rp")
                                NilaiMutasi1 := f.CurrencyFormatStr(float64(dt.NilaiMutasi), "D", 2, "Rp")
                                remark := fmt.Sprintf("Saldo efektif rekening %v tidak cukup untuk transaksi debet %v sebesar %v. Saldo efektif saat ini %v", dt.NomorRekening, dt.Keterangan, NilaiMutasi1, SaldoEfektif1)
                                f.log.Warn(logrus.Fields{
                                        "SaldoEfektif": RekLiabTrx.SaldoEfektif.Float64,
                                        "Amount":       Amount,
                                        "GALAT":        GALAT,
                                }, nil, "log info")
                                f.Store().Rollback(tx)
                                err = fmt.Errorf(remark)

                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark

                                return
                        }</span>

                        <span class="cov2" title="2">err = f.Store().TrxForUpdate(appCtx, tx, dt.NomorRekening)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "error":  err,
                                        "params": dt.NomorRekening,
                                }, nil, err.Error())
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov1" title="1">err = f.Store().UpdateSaldoRekeningTransaksi(appCtx, tx, dt.NomorRekening, Amount)
                        if err != nil </span><span class="cov1" title="1">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "err": err,
                                }, nil, remark)
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                        <span class="cov0" title="0">KodeAccount = RekLiabTrx.KodeAccount.String
                        KodeCabang = RekLiabTrx.KodeCabang.String
                        KodeValuta = RekLiabTrx.KodeValuta.String
                        KodeJDT = "L"</span>

                } else<span class="cov0" title="0"> {
                        err = fmt.Errorf("JenisRekeningTransaksi %s tidak valid. Silahkan hubungi customer suport", JenisRekeningTransaksi)

                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrx.Status = "02"
                        RespTrx.Msg = err.Error()

                        return
                }</span>

                <span class="cov1" title="1">IsCR := ""
                if params.DataTrx.KodeTransaksi == "SKN" || params.DataTrx.KodeTransaksi == "RTGS" </span><span class="cov0" title="0">{
                        IsCR = "T"
                }</span>

                <span class="cov1" title="1">InputDetilTransaksi := datastore.InputDataTransaksiDetail{
                        TanggalTransaksi:         podDt,
                        JenisMutasi:              dt.JenisMutasi,
                        NilaiMutasi:              dt.NilaiMutasi,
                        Keterangan:               dt.Keterangan,
                        KodeCabang:               KodeCabang,
                        KodeValuta:               KodeValuta,
                        JenisDetilTransaksi:      KodeJDT,
                        NilaiKursManual:          dt.NilaiKursManual,
                        SaldoAwal:                0.0,
                        NilaiEkuivalen:           dt.NilaiEkuivalen,
                        NomorReferensi:           dt.NomorReferensi,
                        KodeJurnal:               dt.KodeJurnal,
                        IdTransaksi:              TransaksiID.IdTransaksi,
                        KodeAccount:              KodeAccount,
                        NomorRekening:            NomorRekening,
                        JenisTransaksiLiabilitas: JenisTransaksiLiabilitas,
                        IdParameterTransaksi:     "",
                        FlagProses:               dt.FlagProses,
                        Sequence:                 1,
                        Isbillertransaction:      "F",
                        HidePassbook:             "F",
                        HideStatement:            "F",
                        HideGentrans:             "F",
                        NominalBiaya:             0.00,
                        IsCreateRemittance:       IsCR,
                        KodeValutaRak:            dt.KodeValutaRak,
                        KodeTxClass:              dt.KodeTxClass,
                        NomorSeriWarkat:          dt.NomorSeriWarkat,
                        FlagCode:                 dt.FlagCode,
                }

                var IdTransaksiDetailData int64
                if dt.IdDetilTransaksi == 0 </span><span class="cov0" title="0">{
                        IdTransaksiDetailData, err = f.Store().GetTransaksiDetailID(appCtx, tx)
                        if err != nil </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{"error": err}, nil, remark)
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>
                } else<span class="cov1" title="1"> {
                        IdTransaksiDetailData = dt.IdDetilTransaksi
                }</span>

                <span class="cov1" title="1">InputDetilTransaksi.IdDetailTransaksi = IdTransaksiDetailData
                err = f.Store().PostDetailTrx2(appCtx, tx, InputDetilTransaksi)
                if err != nil </span><span class="cov0" title="0">{
                        remark := "there was a problem, please contact customer support (DB01)"
                        f.log.Error(logrus.Fields{
                                "err": err,
                        }, nil, remark)
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        RespTrx.Status = "02"
                        RespTrx.Msg = remark
                        return
                }</span>

                <span class="cov1" title="1">if JenisRekeningTransaksi == "K" </span><span class="cov0" title="0">{
                        InsertTransaksiTransitKas := datastore.InsertTransaksiTransitKas{
                                IdDetilTransaksi: IdTransaksiDetailData,
                        }
                        err = f.Store().InsertTransaksiTransitKas(appCtx, tx, InsertTransaksiTransitKas)
                        if err != nil </span><span class="cov0" title="0">{
                                remark := "there was a problem, please contact customer support (DB01)"
                                f.log.Error(logrus.Fields{
                                        "err": err,
                                }, nil, remark)
                                f.Store().Rollback(tx)
                                appSpan.RecordError(err)
                                appSpan.SetStatus(otel_code.Error, err.Error())

                                RespTrx.Status = "02"
                                RespTrx.Msg = remark
                                return
                        }</span>

                }
        }

        <span class="cov1" title="1">err = f.Store().UpdateIsReversedTransaksi(appCtx, tx, params.DataTrx.IdTransaksi)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov1" title="1">ReverseTransactionInsert := datastore.ReverseTransactionInsert{
                IdTransaksi:    params.DataTrx.IdTransaksi,
                TanggalReverse: time.Now(),
                UserReverse:    params.DataTrx.UserInput,
                ReverseId:      TransaksiID.IdTransaksi,
        }
        err = f.Store().InsertReverseTransaction(appCtx, tx, ReverseTransactionInsert)
        if err != nil </span><span class="cov0" title="0">{
                remark := "there was a problem, please contact customer support (DB01)"
                f.log.Error(logrus.Fields{
                        "err": err,
                }, nil, remark)
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = remark
                return
        }</span>

        <span class="cov1" title="1">err = f.Store().InsertPendingTrxJournal(appCtx, tx, TransaksiID.IdTransaksi)
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "error": err,
                }, nil, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = err.Error()
                return
        }</span>

        <span class="cov1" title="1">journalReq := data.CreateJournalReq{
                IdTransaksi: TransaksiID.IdTransaksi,
                Date:        PodValue.Today,
        }
        err = f.CreateJournal(ctx, tx, journalReq)
        if err != nil </span><span class="cov0" title="0">{
                f.log.Error(logrus.Fields{
                        "error": err,
                }, nil, err.Error())

                RespTrx.Status = "02"
                RespTrx.Msg = err.Error()
                return
        }</span>

        <span class="cov1" title="1">RespTrx.Data.IdTransaksiFundRev = TransaksiID.IdTransaksi

        return</span>
}

func (f *service) REMITTANCE_RTGS_DATA_GENERATOR(ctx context.Context, reqPayload data.RTGSDataGeneratorReq) (respCode string, respMsg string, err error) <span class="cov8" title="16">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("REMITTANCE_RTGS_DATA_GENERATOR %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        tx, err := f.Store().Begin()
        if err != nil </span><span class="cov1" title="1">{
                remark := "failed to begin transaction"
                f.log.Error(
                        logrus.Fields{"error": err}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                respCode = "02"
                respMsg = remark
                return
        }</span>

        <span class="cov8" title="15">if reqPayload.IdDetilTransaksi == 0 </span><span class="cov1" title="1">{
                respCode = "02"
                respMsg = "id_detil_transaksi harus di isi"
                remark := "The request payload 'id_detil_transaksi' is an empty string"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov8" title="14">dbVariable := make(map[string]interface{})

        dbVariable["id_detil_transaksi"] = reqPayload.IdDetilTransaksi
        dbVariable["id_detil_transaksi2"] = reqPayload.IdDetilTransaksi
        dbVariable["no_referensi"] = reqPayload.ReferenceNo
        dbVariable["deskripsi"] = reqPayload.Deskripsi

        parameterGlobalSandiBI, err := f.Store().GetGlobalParam(appCtx, tx, "SANDI_BI")
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to get parameter global SANDI-BI"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>
        <span class="cov8" title="13">dbVariable["sandi_bi"] = parameterGlobalSandiBI.NilaiParameterString

        rtgsMembercode, err := f.Store().GetGlobalParam(appCtx, tx, "RTGS_MEMBERCODE")
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to get parameter global RTGS_MEMBERCODE"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>
        <span class="cov8" title="12">dbVariable["rtgs_membercode"] = rtgsMembercode.NilaiParameterString

        rtgsTrn, err := f.Store().GetGlobalParam(appCtx, tx, "RTGS_TRN")
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to get parameter global RTGS_TRN"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>
        <span class="cov7" title="11">dbVariable["rtgs_trn"] = rtgsTrn.NilaiParameterString

        rtgsMemberinfo, err := f.Store().GetGlobalParam(appCtx, tx, "RTGS_MEMBERINFO")
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to get parameter global RTGS_MEMBERINFO"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>
        <span class="cov7" title="10">dbVariable["rtgs_memberinfo"] = rtgsMemberinfo.NilaiParameterString

        rtgsAccNo, err := f.Store().GetGlobalParam(appCtx, tx, "RTGS_ACC_NO")
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to get parameter global RTGS_ACC_NO"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>
        <span class="cov7" title="9">dbVariable["rtgs_acc_no"] = rtgsAccNo.NilaiParameterString

        rtgsAccName, err := f.Store().GetGlobalParam(appCtx, tx, "RTGS_ACC_NAME")
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to get parameter global RTGS_ACC_NAME"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>
        <span class="cov6" title="8">dbVariable["rtgs_acc_name"] = rtgsAccName.NilaiParameterString

        //Start DB Call Sequence
        err = f.Store().CreateRemittanceCandidate(appCtx, tx, reqPayload.IdDetilTransaksi)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to execute CreateRemittanceCandidate"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov6" title="7">err = f.Store().CreateRTStatusHistory(appCtx, tx, reqPayload.IdDetilTransaksi)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to execute CreateRTStatusHistory"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov6" title="6">InsertRTTransaction := datastore.InsertRTTransaction{
                IdDetil:        reqPayload.IdDetilTransaksi,
                RtgsMembercode: rtgsMembercode.NilaiParameterString.String,
                RtgsTrn:        rtgsTrn.NilaiParameterString.String,
                NoReferensi:    reqPayload.ReferenceNo,
        }
        err = f.Store().CreateRTTransaction(appCtx, tx, InsertRTTransaction)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to execute CreateRTTransaction"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov5" title="5">err = f.Store().MergeRTTransaction(appCtx, tx, reqPayload.IdDetilTransaksi)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to execute MergeRTTransaction"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov4" title="4">err = f.Store().CreateRTTransferDetail(appCtx, tx, reqPayload.IdDetilTransaksi)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to execute CreateRTTransferDetail"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov4" title="3">InsertRTSingleTransfer := datastore.InsertRTSingleTransfer{
                IdDetilTransaksi: reqPayload.IdDetilTransaksi,
                RtgsMemberinfo:   rtgsMemberinfo.NilaiParameterString.String,
                RtgsAccNo:        rtgsAccNo.NilaiParameterString.String,
                RtgsAccName:      rtgsAccName.NilaiParameterString.String,
        }
        err = f.Store().CreateRTSingleTransfer(appCtx, tx, InsertRTSingleTransfer)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to execute CreateRTSingleTransfer"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov2" title="2">err = f.Store().MergeRTSingleTransfer(appCtx, tx, reqPayload.IdDetilTransaksi)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to execute MergeRTSingleTransfer"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov1" title="1">err = f.Store().CreateRemittanceTransaction(appCtx, tx, reqPayload.IdDetilTransaksi)
        if err != nil &amp;&amp; err != sql.ErrNoRows </span><span class="cov1" title="1">{
                remark := "there was a problem, please contact customer support (DB01)"
                respCode = "02"
                respMsg = "Failed to execute CreateRemittanceTransaction"
                err = fmt.Errorf(fmt.Sprintf("Payload error, reason: %v", remark))
                f.log.Error(
                        logrus.Fields{"err": err.Error()}, nil, remark,
                )
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())
                return
        }</span>

        <span class="cov0" title="0">respCode = "00"
        respMsg = "Berhasil"
        f.Store().Commit(tx)
        appSpan.SetStatus(otel_code.Ok, "app successes")

        return</span>
}

func (f *service) AutosaveCheck(ctx context.Context, tx *sqlx.Tx, params data.AutosaveCheck) (ListDetilTrx []datastore.DetilTrx, err error) <span class="cov4" title="4">{
        appCtx, appSpan := f.tracer.Start(ctx, fmt.Sprintf("AutosaveCheck %s ", "start"))
        appSpan.SetAttributes(attribute.String("app.layer", "app"))
        defer appSpan.End()
        // get rekening nasabah
        rekNasabahTrxs, err := f.Store().GetRekeningLiab(appCtx, tx, params.NomorRekening)
        if err != nil </span><span class="cov1" title="1">{
                f.log.Error(logrus.Fields{
                        "result": rekNasabahTrxs,
                        "error":  err,
                        "params": params.NomorRekening,
                }, nil, err.Error())
                err = errors.SystemError.Database
                f.Store().Rollback(tx)
                appSpan.RecordError(err)
                appSpan.SetStatus(otel_code.Error, err.Error())

                return
        }</span>

        <span class="cov4" title="3">if rekNasabahTrxs.SaldoEfektif.Valid &amp;&amp; rekNasabahTrxs.SaldoEfektif.Float64 &lt; float64(params.NilaiTransaksi) </span><span class="cov4" title="3">{
                selisih := float64(params.NilaiTransaksi) - rekNasabahTrxs.SaldoEfektif.Float64

                // mengambil rekening layanan
                RekLay, errs := f.Store().GetRekeningLayanan(appCtx, tx, params.NomorRekening)
                if errs != nil &amp;&amp; errs != sql.ErrNoRows </span><span class="cov0" title="0">{
                        f.log.Error(logrus.Fields{
                                "result": rekNasabahTrxs,
                                "error":  errs,
                                "params": params.NomorRekening,
                        }, nil, errs.Error())

                        err = errors.SystemError.Database
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())
                        return
                }</span>

                // jika tidak memiliki rekening layanan
                <span class="cov4" title="3">if errs == sql.ErrNoRows </span><span class="cov1" title="1">{
                        remark := "Saldo efektif tidak mencukupi"
                        f.log.Warn(logrus.Fields{"SaldoEfektif": rekNasabahTrxs.SaldoEfektif}, nil, remark)
                        f.Store().Rollback(tx)
                        err = errors.TrxChannelError.UnsufficientBalance
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        return
                }</span>

                //  get saldo rekening layanan
                <span class="cov2" title="2">rekLayNasabahTrxs, errs := f.Store().GetRekeningLiab(appCtx, tx, RekLay.NomorRekeningLayanan)
                if errs != nil </span><span class="cov0" title="0">{
                        f.log.Error(logrus.Fields{
                                "result": rekLayNasabahTrxs,
                                "error":  errs,
                                "params": RekLay.NomorRekeningLayanan,
                        }, nil, errs.Error())
                        err = errors.SystemError.Database
                        f.Store().Rollback(tx)
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        return
                }</span>

                // pengecekan jika saldo cukup
                <span class="cov2" title="2">if rekLayNasabahTrxs.SaldoEfektif.Valid &amp;&amp; rekLayNasabahTrxs.SaldoEfektif.Float64 &lt; selisih </span><span class="cov1" title="1">{
                        remark := "Saldo efektif tidak mencukupi"
                        f.log.Warn(logrus.Fields{"SaldoEfektif": rekLayNasabahTrxs.SaldoEfektif}, nil, remark)
                        f.Store().Rollback(tx)
                        err = errors.TrxChannelError.UnsufficientBalance
                        appSpan.RecordError(err)
                        appSpan.SetStatus(otel_code.Error, err.Error())

                        return
                }</span>

                // insert to transaksi
                <span class="cov1" title="1">keteranganAutoSave := fmt.Sprintf("Auto Save dari rekening %s ke rekening %s", RekLay.NomorRekeningLayanan, RekLay.NomorRekeningTujuan)

                // detil transaksi db
                detilTrxDebitLayanan := datastore.DetilTrx{
                        JenisDetilTransaksi: "002",
                        NomorRekening:       RekLay.NomorRekeningLayanan,
                        JenisMutasi:         "D",
                        NilaiMutasi:         float64(selisih),
                        KodeCabang:          rekLayNasabahTrxs.KodeCabang.String,
                        Keterangan:          keteranganAutoSave,
                        NilaiKursManual:     1,
                        NilaiEkuivalen:      float64(selisih),
                        NomorReferensi:      params.NomorReferensi,
                        FlagProses:          "F",
                        KodeJurnal:          "11",
                }
                ListDetilTrx = append(ListDetilTrx, detilTrxDebitLayanan)

                // detil transaksi cr
                detilTrxKreditLayanan := datastore.DetilTrx{
                        JenisDetilTransaksi: "002",
                        NomorRekening:       params.NomorRekening,
                        JenisMutasi:         "C",
                        NilaiMutasi:         float64(selisih),
                        KodeCabang:          rekLayNasabahTrxs.KodeCabang.String,
                        Keterangan:          keteranganAutoSave,
                        NilaiKursManual:     1,
                        NilaiEkuivalen:      float64(selisih),
                        NomorReferensi:      params.NomorReferensi,
                        FlagProses:          "F",
                        KodeJurnal:          "11",
                }
                ListDetilTrx = append(ListDetilTrx, detilTrxKreditLayanan)</span>

        }
        <span class="cov1" title="1">return</span>
}
</pre>
		
		<pre class="file" id="file10" style="display: none">package app

import (
        "fmt"
        "os"

        "github.com/sirupsen/logrus"
)

func (f *service) removeFile(directory string) <span class="cov0" title="0">{
        var err error

        if f.fileExist(directory) </span><span class="cov0" title="0">{
                err = os.Remove(directory)
                if err != nil </span><span class="cov0" title="0">{
                        f.log.Error(logrus.Fields{"error": err.Error(), "params": directory}, nil, err.Error())
                        return
                }</span>

                <span class="cov0" title="0">f.log.Info(logrus.Fields{"filepath": directory}, nil, fmt.Sprintf("Generated file removed: %s", directory))</span>
        }

}

func (f *service) fileExist(directory string) bool <span class="cov0" title="0">{
        info, err := os.Stat(directory)

        if os.IsNotExist(err) </span><span class="cov0" title="0">{
                return false
        }</span>

        <span class="cov0" title="0">return !info.IsDir()</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
